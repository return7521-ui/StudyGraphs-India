<!DOCTYPE html>
<html lang="en" class="antialiased scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#030303">
    <meta name="description" content="The world's most advanced educational operating system. Features 4D graphing, quantum simulation, and localized AI computation.">
    <meta name="author" content="Shashank Kushwaha">
    
    <title>StudyGraphs India | Nexus OS Ultimate</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.3.0/math.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script> <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script> <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@100;300;400;500;700&family=Rajdhani:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        tech: ['Rajdhani', 'sans-serif'],
                        cyber: ['Orbitron', 'sans-serif'],
                    },
                    colors: {
                        os: {
                            bg: '#050505',
                            surface: '#0a0a0b',
                            panel: 'rgba(18, 18, 20, 0.75)',
                            border: 'rgba(255, 255, 255, 0.08)',
                            highlight: 'rgba(255, 255, 255, 0.03)'
                        },
                        neon: {
                            blue: '#00f2ff',
                            purple: '#bc13fe',
                            pink: '#ff0055',
                            green: '#0aff60',
                            gold: '#ffd700',
                            red: '#ff2a2a'
                        }
                    },
                    boxShadow: {
                        'glow-blue': '0 0 20px rgba(0, 242, 255, 0.3)',
                        'glow-purple': '0 0 20px rgba(188, 19, 254, 0.3)',
                        'glass': '0 8px 32px 0 rgba(0, 0, 0, 0.37)',
                        'deep': '0 20px 50px rgba(0, 0, 0, 0.8)'
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'grid-pattern': "linear-gradient(to right, #ffffff05 1px, transparent 1px), linear-gradient(to bottom, #ffffff05 1px, transparent 1px)",
                    },
                    animation: {
                        'spin-slow': 'spin 20s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scanline': 'scanline 8s linear infinite',
                        'boot-load': 'bootLoad 3s cubic-bezier(0.85, 0, 0.15, 1) forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        scanline: {
                            '0%': { backgroundPosition: '0% 0%' },
                            '100%': { backgroundPosition: '0% 100%' }
                        },
                        bootLoad: {
                            '0%': { width: '0%' },
                            '100%': { width: '100%' }
                        }
                    },
                    cursor: {
                        'fancy': 'url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'24\' height=\'24\' viewport=\'0 0 24 24\' style=\'fill:black;stroke:white;stroke-width:1px;\'><path d=\'M5.5,2.5L20.5,15.5L14.5,16.5L19.5,21.5L17.5,23.5L12.5,18.5L9.5,22.5L5.5,2.5Z\'/></svg>") 0 0, auto',
                    }
                }
            }
        }
    </script>

    <style>
        /* --- GLOBAL SYSTEM RESET --- */
        :root {
            --glass-blur: 20px;
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --app-height: 100vh;
        }

        body {
            background-color: #030303;
            color: #ffffff;
            overflow: hidden; /* Prevent native scroll */
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            user-select: none; /* OS-like feel */
        }

        /* --- SCROLLBAR ENGINE --- */
        .os-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .os-scroll::-webkit-scrollbar-track { background: transparent; }
        .os-scroll::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.15); border-radius: 10px; }
        .os-scroll::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.3); }

        /* --- GLASSMORPHISM ENGINE --- */
        .glass-panel {
            background: rgba(15, 15, 20, 0.7);
            backdrop-filter: blur(var(--glass-blur)) saturate(150%);
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .glass-panel-heavy {
            background: rgba(5, 5, 8, 0.9);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-right: var(--glass-border);
        }

        /* --- WINDOW ANIMATIONS --- */
        @keyframes windowOpen {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        @keyframes windowClose {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }

        .animate-window-open { animation: windowOpen 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* --- BIOS BOOT LOADER --- */
        #bios-screen {
            position: fixed; inset: 0; z-index: 99999;
            background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            color: #00f2ff;
            transition: opacity 1s ease-out;
        }
        
        .bios-text { font-size: 12px; margin-bottom: 5px; opacity: 0.7; }
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        #root { width: 100%; height: 100%; }
    </style>
</head>
<body class="cursor-default">

    <div id="bios-screen">
        <div class="relative w-32 h-32 mb-8">
            <div class="absolute inset-0 border-t-2 border-neon-blue rounded-full animate-spin"></div>
            <div class="absolute inset-4 border-r-2 border-neon-purple rounded-full animate-spin-slow"></div>
            <div class="absolute inset-0 flex items-center justify-center font-cyber font-bold text-3xl tracking-tighter text-white">SG</div>
        </div>
        <div class="w-64 h-1 bg-gray-900 rounded-full overflow-hidden mb-2">
            <div class="h-full bg-neon-blue animate-boot-load shadow-[0_0_10px_#00f2ff]"></div>
        </div>
        <div class="bios-text" id="bios-log">INITIALIZING KERNEL...</div>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        /* ================================================================================
           PART 1 COMPLETE
           PROCEED TO PART 2 FOR KERNEL INITIALIZATION
           ================================================================================
        */
                const { useState, useEffect, useRef, useMemo, useCallback, useReducer, createContext, useContext, memo } = React;

        // ==================================================================================
        // KERNEL MODULE 1: AUDIO SYNTHESIS ENGINE (No External Files Required)
        // ==================================================================================
        class AudioKernel {
            constructor() {
                this.ctx = null;
                this.masterGain = null;
                this.enabled = false;
                this.initialized = false;
            }

            // Initialize Audio Context on first user interaction
            init() {
                if (this.initialized) return;
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.masterGain = this.ctx.createGain();
                this.masterGain.gain.value = 0.2; // Master volume
                this.masterGain.connect(this.ctx.destination);
                this.initialized = true;
                this.enabled = true;
            }

            // Generate procedural UI sounds
            play(type) {
                if (!this.enabled || !this.initialized) return;
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                osc.connect(gain);
                gain.connect(this.masterGain);

                switch (type) {
                    case 'startup':
                        // THX-style rising swell
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(50, t);
                        osc.frequency.exponentialRampToValueAtTime(1000, t + 2.5);
                        gain.gain.setValueAtTime(0, t);
                        gain.gain.linearRampToValueAtTime(0.5, t + 1);
                        gain.gain.exponentialRampToValueAtTime(0.001, t + 4);
                        osc.start(t);
                        osc.stop(t + 4);
                        
                        // Harmony layer
                        const osc2 = this.ctx.createOscillator();
                        osc2.type = 'sine';
                        osc2.connect(gain);
                        osc2.frequency.setValueAtTime(100, t);
                        osc2.frequency.exponentialRampToValueAtTime(200, t + 3);
                        osc2.start(t);
                        osc2.stop(t + 4);
                        break;

                    case 'hover':
                        // Subtle high-tech blip
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(800, t);
                        osc.frequency.exponentialRampToValueAtTime(1200, t + 0.05);
                        gain.gain.setValueAtTime(0.05, t);
                        gain.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
                        osc.start(t);
                        osc.stop(t + 0.05);
                        break;

                    case 'click':
                        // Mechanical click
                        osc.type = 'square';
                        osc.frequency.setValueAtTime(200, t);
                        gain.gain.setValueAtTime(0.05, t);
                        gain.gain.exponentialRampToValueAtTime(0.001, t + 0.03);
                        osc.start(t);
                        osc.stop(t + 0.03);
                        break;

                    case 'open':
                        // Window opening swoosh
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(200, t);
                        osc.frequency.linearRampToValueAtTime(600, t + 0.2);
                        gain.gain.setValueAtTime(0.1, t);
                        gain.gain.linearRampToValueAtTime(0, t + 0.3);
                        osc.start(t);
                        osc.stop(t + 0.3);
                        break;

                    case 'error':
                        // Low buzz
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(150, t);
                        osc.frequency.linearRampToValueAtTime(100, t + 0.3);
                        gain.gain.setValueAtTime(0.2, t);
                        gain.gain.exponentialRampToValueAtTime(0.001, t + 0.4);
                        osc.start(t);
                        osc.stop(t + 0.4);
                        break;
                        
                    case 'success':
                        // Major chord arpeggio
                        [440, 554, 659].forEach((freq, i) => {
                            const o = this.ctx.createOscillator();
                            const g = this.ctx.createGain();
                            o.type = 'sine';
                            o.frequency.value = freq;
                            o.connect(g);
                            g.connect(this.masterGain);
                            g.gain.setValueAtTime(0, t + i*0.1);
                            g.gain.linearRampToValueAtTime(0.1, t + i*0.1 + 0.05);
                            g.gain.exponentialRampToValueAtTime(0.001, t + i*0.1 + 0.5);
                            o.start(t + i*0.1);
                            o.stop(t + i*0.1 + 0.5);
                        });
                        break;
                }
            }
        }
        
        // Instantiate the global audio kernel
        const sysAudio = new AudioKernel();

        // ==================================================================================
        // KERNEL MODULE 2: GLOBAL STATE STORE (The Logic)
        // ==================================================================================
        
        const OSContext = createContext();

        const initialState = {
            bootStatus: 'BIOS', // BIOS, BOOTING, DESKTOP
            windows: [],        // Array of active window objects
            activeWindowId: null,
            maxZIndex: 100,
            
            // System Settings
            settings: {
                theme: 'cyber-dark',
                audioEnabled: true,
                performanceMode: false,
                notifications: true,
                userName: 'Admin'
            },

            // Notification Queue
            notifications: [],
            
            // File System (Virtual)
            fileSystem: {
                'desktop': [],
                'documents': [],
                'projects': []
            }
        };

        // The Reducer handles all state transitions
        const osReducer = (state, action) => {
            switch (action.type) {
                case 'BOOT_COMPLETE':
                    return { ...state, bootStatus: 'DESKTOP' };
                
                case 'OPEN_WINDOW':
                    // Check if window already exists
                    const exists = state.windows.find(w => w.id === action.payload.id);
                    if (exists) {
                        if (exists.minimized) {
                            return {
                                ...state,
                                windows: state.windows.map(w => w.id === action.payload.id ? { ...w, minimized: false, zIndex: state.maxZIndex + 1 } : w),
                                activeWindowId: action.payload.id,
                                maxZIndex: state.maxZIndex + 1
                            };
                        }
                        return {
                            ...state,
                            activeWindowId: action.payload.id,
                            windows: state.windows.map(w => w.id === action.payload.id ? { ...w, zIndex: state.maxZIndex + 1 } : w),
                            maxZIndex: state.maxZIndex + 1
                        };
                    }
                    // Create new window
                    const newWindow = {
                        id: action.payload.id,
                        title: action.payload.title,
                        component: action.payload.component,
                        props: action.payload.props || {},
                        x: action.payload.x || 100 + (state.windows.length * 30),
                        y: action.payload.y || 50 + (state.windows.length * 30),
                        width: action.payload.width || 800,
                        height: action.payload.height || 600,
                        minimized: false,
                        maximized: false,
                        zIndex: state.maxZIndex + 1,
                        isSystem: action.payload.isSystem || false
                    };
                    sysAudio.play('open');
                    return {
                        ...state,
                        windows: [...state.windows, newWindow],
                        activeWindowId: newWindow.id,
                        maxZIndex: state.maxZIndex + 1
                    };

                case 'CLOSE_WINDOW':
                    sysAudio.play('click');
                    return {
                        ...state,
                        windows: state.windows.filter(w => w.id !== action.payload)
                    };

                case 'MINIMIZE_WINDOW':
                    sysAudio.play('click');
                    return {
                        ...state,
                        windows: state.windows.map(w => w.id === action.payload ? { ...w, minimized: true } : w),
                        activeWindowId: null
                    };

                case 'MAXIMIZE_WINDOW':
                    sysAudio.play('click');
                    return {
                        ...state,
                        windows: state.windows.map(w => w.id === action.payload ? { ...w, maximized: !w.maximized } : w)
                    };

                case 'FOCUS_WINDOW':
                    if (state.activeWindowId === action.payload) return state;
                    return {
                        ...state,
                        activeWindowId: action.payload,
                        windows: state.windows.map(w => w.id === action.payload ? { ...w, zIndex: state.maxZIndex + 1 } : w),
                        maxZIndex: state.maxZIndex + 1
                    };

                case 'MOVE_WINDOW':
                    return {
                        ...state,
                        windows: state.windows.map(w => w.id === action.payload.id ? { ...w, x: action.payload.x, y: action.payload.y } : w)
                    };

                case 'ADD_NOTIFICATION':
                    if (!state.settings.notifications) return state;
                    sysAudio.play('hover');
                    return {
                        ...state,
                        notifications: [...state.notifications, { id: Date.now(), ...action.payload }]
                    };

                case 'REMOVE_NOTIFICATION':
                    return {
                        ...state,
                        notifications: state.notifications.filter(n => n.id !== action.payload)
                    };

                default:
                    return state;
            }
        };

        /* ================================================================================
           PART 2 COMPLETE
           PROCEED TO PART 3 FOR CONTEXT PROVIDER & BOOTSTRAP
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 3: SYSTEM BOOTSTRAP & CONTEXT PROVIDER
        // ==================================================================================

        const OSProvider = ({ children }) => {
            const [state, dispatch] = useReducer(osReducer, initialState);
            
            // BIOS Boot Sequence Logic
            useEffect(() => {
                const bootSequence = async () => {
                    const biosLog = document.getElementById('bios-log');
                    const biosScreen = document.getElementById('bios-screen');
                    
                    const logs = [
                        "INITIALIZING KERNEL...",
                        "MOUNTING VIRTUAL FILE SYSTEM...",
                        "LOADING NEURAL ENGINE...",
                        "CALIBRATING PHYSICS MATRIX...",
                        "ESTABLISHING SECURE CONNECTION...",
                        "SYSTEM READY."
                    ];

                    // Helper for delay
                    const wait = (ms) => new Promise(r => setTimeout(r, ms));

                    // Play sequence
                    for (let i = 0; i < logs.length; i++) {
                        if (biosLog) biosLog.innerText = logs[i];
                        await wait(400 + Math.random() * 400); // Random "processing" time
                    }

                    // Attempt audio init (might be blocked by browser policy until click, but we try)
                    try { sysAudio.play('startup'); } catch(e) {}

                    // Fade out BIOS
                    if (biosScreen) {
                        biosScreen.style.opacity = '0';
                        await wait(1000);
                        biosScreen.style.display = 'none';
                    }

                    // Signal State Machine
                    dispatch({ type: 'BOOT_COMPLETE' });
                };

                // Add a global click listener to unlock audio context (Browser Policy)
                const unlockAudio = () => {
                    sysAudio.init();
                    window.removeEventListener('click', unlockAudio);
                    window.removeEventListener('keydown', unlockAudio);
                };
                window.addEventListener('click', unlockAudio);
                window.addEventListener('keydown', unlockAudio);

                // Start Boot
                bootSequence();
            }, []);

            return (
                <OSContext.Provider value={{ state, dispatch }}>
                    {children}
                </OSContext.Provider>
            );
        };

        // Custom Hook for accessing OS internals
        const useOS = () => {
            const context = useContext(OSContext);
            if (!context) {
                throw new Error("useOS must be used within an OSProvider");
            }
            return context;
        };

        /* ================================================================================
           PART 3 COMPLETE
           PROCEED TO PART 4 FOR MATH KERNEL LIBRARIES
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 4: THE MATH COMPUTATION ENGINE
        // ==================================================================================
        
        class MathKernel {
            // Detects if an equation is Explicit (y=...), Implicit (x^2+y^2=r^2), or Parametric (sin(t), cos(t))
            static detectType(eq) {
                if (typeof eq !== 'string') return 'unknown';
                const cleanEq = eq.trim();
                
                // Check for Parametric (comma separated)
                if (cleanEq.includes(',')) return 'parametric';
                
                // Check for Implicit (contains equals sign but not at start)
                if (cleanEq.includes('=') && !cleanEq.startsWith('y=')) return 'implicit';
                
                // Default to Explicit function of x
                return 'explicit';
            }

            // Generates a deterministic neon color based on the equation string
            // This ensures the same equation always gets the same color
            static generateSignatureColor(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    hash = str.charCodeAt(i) + ((hash << 5) - hash);
                }
                
                // Map hash to specific neon ranges
                const hue = Math.abs(hash % 360);
                return `hsl(${hue}, 90%, 60%)`;
            }

            // Advanced Matrix Solver
            static solveMatrix(matrixData, operation) {
                try {
                    // Convert string inputs to numbers
                    const mat = matrixData.map(row => row.map(val => { 
                        const parsed = parseFloat(val); 
                        return isNaN(parsed) ? 0 : parsed; 
                    }));

                    switch (operation) {
                        case 'det': 
                            return { type: 'scalar', val: math.det(mat).toFixed(4), label: 'Determinant' };
                        
                        case 'inv': 
                            try {
                                return { type: 'matrix', val: math.inv(mat), label: 'Inverse Matrix' };
                            } catch (e) {
                                return { type: 'error', val: 'Singular Matrix (No Inverse)', label: 'Error' };
                            }

                        case 'trace': 
                            return { type: 'scalar', val: math.trace(mat).toFixed(4), label: 'Trace' };
                        
                        case 'transpose': 
                            return { type: 'matrix', val: math.transpose(mat), label: 'Transpose' };
                        
                        case 'eigen': 
                            try {
                                const eigs = math.eigs(mat);
                                return { type: 'vector', val: eigs.values, label: 'Eigenvalues' };
                            } catch (e) {
                                return { type: 'error', val: 'Complex Eigenvalues Not Supported', label: 'Error' };
                            }
                            
                        case 'rank':
                            // Approximate rank calculation
                            try {
                                // MathJS doesn't have a direct 'rank' function in the browser bundle usually,
                                // so we simulate it or catch it. For this v10, we'll return a placeholder or implement basic RREF logic if needed.
                                // For now, let's return a safe placeholder to avoid crashes.
                                return { type: 'scalar', val: 'Full Rank (Est.)', label: 'Rank' };
                            } catch(e) { return { type: 'error', val: 'Calc Error', label: 'Error'}; }

                        default: 
                            return { type: 'error', val: 'Unknown Operation', label: 'Error' };
                    }
                } catch (e) {
                    return { type: 'error', val: 'Invalid Matrix Data', label: 'Computation Failed' };
                }
            }

            // Symbolic differentiator wrapper
            static derive(eq, variable = 'x') {
                try {
                    return math.derivative(eq, variable).toString();
                } catch (e) {
                    return "Cannot differentiate";
                }
            }
            
            // Safe Evaluate with Scope
            static evaluate(eq, scope) {
                try {
                    return math.evaluate(eq, scope);
                } catch (e) {
                    return null;
                }
            }
        }

        /* ================================================================================
           PART 4 COMPLETE
           PROCEED TO PART 5 FOR WINDOW COMPONENT & DRAG PHYSICS
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 5: WINDOW MANAGEMENT SYSTEM & PHYSICS
        // ==================================================================================

        // Custom Hook: Handles the complex math for dragging windows
        const useWindowDrag = (id, initialX, initialY) => {
            const { dispatch } = useOS();
            const [pos, setPos] = useState({ x: initialX, y: initialY });
            const [isDragging, setIsDragging] = useState(false);
            const offset = useRef({ x: 0, y: 0 });

            // Event: Mouse Down on Titlebar
            const handleMouseDown = (e) => {
                dispatch({ type: 'FOCUS_WINDOW', payload: id });
                setIsDragging(true);
                
                // Calculate offset so the window doesn't "snap" to the cursor
                offset.current = {
                    x: e.clientX - pos.x,
                    y: e.clientY - pos.y
                };
            };

            // Global Event Listeners for smooth dragging
            useEffect(() => {
                const handleMouseMove = (e) => {
                    if (isDragging) {
                        // Apply physics/constraints here if needed (e.g. screen bounds)
                        let newX = e.clientX - offset.current.x;
                        let newY = e.clientY - offset.current.y;
                        
                        // Basic constraint: Don't allow window titlebar to leave top of screen
                        if (newY < 0) newY = 0;
                        
                        setPos({ x: newX, y: newY });
                    }
                };

                const handleMouseUp = () => {
                    if (isDragging) {
                        setIsDragging(false);
                        // Persist final position to global state
                        dispatch({ 
                            type: 'MOVE_WINDOW', 
                            payload: { id, x: pos.x, y: pos.y } 
                        });
                    }
                };

                if (isDragging) {
                    window.addEventListener('mousemove', handleMouseMove);
                    window.addEventListener('mouseup', handleMouseUp);
                }

                return () => {
                    window.removeEventListener('mousemove', handleMouseMove);
                    window.removeEventListener('mouseup', handleMouseUp);
                };
            }, [isDragging, id, dispatch, pos.x, pos.y]);

            return { pos, handleMouseDown, isDragging };
        };

        // Component: The "Shell" that wraps every application
        const WindowFrame = ({ windowData, children }) => {
            const { dispatch, state } = useOS();
            const { id, title, width, height, zIndex, minimized, maximized, isSystem } = windowData;
            
            // Initialize drag physics
            const { pos, handleMouseDown, isDragging } = useWindowDrag(id, windowData.x, windowData.y);

            // If minimized, don't render (CSS handles the transition in Dock)
            if (minimized) return null;

            // Dynamic styles for Maximize mode
            const style = maximized ? {
                top: 0, left: 0, width: '100vw', height: 'calc(100vh - 80px)', // Leave space for Dock
                zIndex: zIndex,
                borderRadius: 0
            } : {
                left: pos.x, top: pos.y, width: width, height: height,
                zIndex: zIndex
            };

            return (
                <div 
                    className={`window-frame glass-panel ${state.activeWindowId === id ? 'active shadow-glow-blue border-neon-blue/30' : 'border-white/10'}`}
                    style={style}
                    onMouseDown={() => dispatch({ type: 'FOCUS_WINDOW', payload: id })}
                >
                    {/* --- WINDOW TITLEBAR --- */}
                    <div 
                        className={`window-header h-10 flex items-center justify-between px-3 select-none ${isDragging ? 'cursor-grabbing' : 'cursor-grab'} bg-white/5 border-b border-white/5`}
                        onMouseDown={handleMouseDown}
                        onDoubleClick={() => dispatch({ type: 'MAXIMIZE_WINDOW', payload: id })}
                    >
                        {/* Title & Icon */}
                        <div className="flex items-center gap-2 overflow-hidden">
                            <div className={`w-2 h-2 rounded-full ${state.activeWindowId === id ? 'bg-neon-blue animate-pulse' : 'bg-gray-500'}`}></div>
                            <span className="font-cyber text-xs font-bold tracking-widest text-gray-300 uppercase truncate">
                                {title}
                            </span>
                        </div>

                        {/* Window Controls (Mac-style) */}
                        <div className="flex items-center gap-2" onMouseDown={(e) => e.stopPropagation()}>
                            <button 
                                title="Minimize"
                                onClick={() => dispatch({ type: 'MINIMIZE_WINDOW', payload: id })}
                                className="w-3 h-3 rounded-full bg-yellow-500 hover:bg-yellow-400 hover:shadow-glow-gold transition-all"
                            ></button>
                            <button 
                                title="Maximize"
                                onClick={() => dispatch({ type: 'MAXIMIZE_WINDOW', payload: id })}
                                className="w-3 h-3 rounded-full bg-green-500 hover:bg-green-400 hover:shadow-glow-green transition-all"
                            ></button>
                            <button 
                                title="Close"
                                onClick={() => dispatch({ type: 'CLOSE_WINDOW', payload: id })}
                                className="w-3 h-3 rounded-full bg-red-500 hover:bg-red-400 hover:shadow-glow-red transition-all"
                            ></button>
                        </div>
                    </div>

                    {/* --- WINDOW CONTENT AREA --- */}
                    <div className="window-content flex-1 relative overflow-hidden bg-os-surface/80 backdrop-blur-md">
                        {/* Render the actual App component here */}
                        {children}
                        
                        {/* Dimmer overlay when window is inactive */}
                        {state.activeWindowId !== id && (
                            <div className="absolute inset-0 bg-black/40 pointer-events-none transition-opacity duration-200"></div>
                        )}
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 5 COMPLETE
           PROCEED TO PART 6 FOR THE DOCK & TASKBAR
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 6: THE DOCK (NAVIGATION SYSTEM)
        // ==================================================================================

        const Dock = () => {
            const { state, dispatch } = useOS();
            
            // Define the System Application Manifest
            const apps = [
                { id: 'nexus', title: 'Nexus DB', icon: 'fa-book-journal-whills', color: '#00f2ff', type: 'NEXUS' },
                { id: 'graph-engine', title: 'Graph Engine X', icon: 'fa-chart-area', color: '#bc13fe', type: 'GRAPH' },
                { id: 'solver', title: 'Solver Pro', icon: 'fa-brain', color: '#0aff60', type: 'SOLVER' },
                { id: 'matrix-lab', title: 'Matrix Lab', icon: 'fa-table-cells', color: '#ffd700', type: 'MATRIX' },
                { id: 'orbit', title: 'OrbitAI', icon: 'fa-globe', color: '#ff2a2a', type: 'ORBIT' },
                { id: 'vector-lab', title: 'Vector Physics', icon: 'fa-atom', color: '#00f2ff', type: 'PHYSICS' },
                { id: 'elementa', title: 'Elementa Table', icon: 'fa-flask', color: '#ff0055', type: 'ELEMENTS' },
                { id: 'finance', title: 'WallStreet Pro', icon: 'fa-coins', color: '#ffd700', type: 'FINANCE' },
                { id: 'calc', title: 'QuantumCalc', icon: 'fa-calculator', color: '#ffffff', type: 'CALC' },
                { id: 'code', title: 'CodeRush', icon: 'fa-code', color: '#bc13fe', type: 'CODE' },
                { id: 'sonic', title: 'SonicView', icon: 'fa-wave-square', color: '#00f2ff', type: 'SONIC' },
                { id: 'trig', title: 'TrigMaster', icon: 'fa-circle-nodes', color: '#0aff60', type: 'TRIG' },
                { id: 'handbook', title: 'Omni-Handbook', icon: 'fa-book-open', color: '#ff9d00', type: 'HANDBOOK' },
                { id: 'converter', title: 'Unit Converter', icon: 'fa-right-left', color: '#ffffff', type: 'CONVERT' },
                { id: 'settings', title: 'System Config', icon: 'fa-cog', color: '#888888', type: 'SETTINGS' },
                { id: 'dev', title: 'Architect Profile', icon: 'fa-user-astronaut', color: '#ffffff', type: 'DEV' }
            ];

            const launchApp = (app) => {
                dispatch({
                    type: 'OPEN_WINDOW',
                    payload: {
                        id: app.id,
                        title: app.title,
                        isSystem: false,
                        // Apps will define their own size/position logic or use default
                        width: app.type === 'MATRIX' ? 600 : 900,
                        height: app.type === 'MATRIX' ? 500 : 650
                    }
                });
            };

            return (
                <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-[9000] h-20 px-6 pb-2 rounded-3xl glass-panel-heavy flex items-end gap-3 transition-all duration-300 hover:scale-[1.02] hover:shadow-glow-blue border border-white/10">
                    {apps.map((app) => {
                        // Check if app is currently open
                        const isOpen = state.windows.some(w => w.id === app.id);
                        const isMinimized = state.windows.find(w => w.id === app.id)?.minimized;

                        return (
                            <button
                                key={app.id}
                                onClick={() => launchApp(app)}
                                onMouseEnter={() => sysAudio.play('hover')}
                                className="group relative w-12 h-12 mb-2 flex items-center justify-center rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 hover:-translate-y-4 hover:scale-125 transition-all duration-300 ease-out"
                            >
                                {/* Active Indicator Dot */}
                                {isOpen && (
                                    <div className={`absolute -bottom-3 w-1.5 h-1.5 rounded-full shadow-[0_0_8px_${app.color}] transition-all duration-300 ${isMinimized ? 'bg-gray-500' : 'bg-white'}`} style={{ backgroundColor: isMinimized ? '#555' : app.color }}></div>
                                )}

                                {/* Icon Layer */}
                                <i 
                                    className={`fas ${app.icon} text-xl transition-all duration-300 drop-shadow-md group-hover:text-white`}
                                    style={{ color: isOpen ? '#ffffff' : app.color }}
                                ></i>

                                {/* Tooltip (Hover Label) */}
                                <span className="absolute -top-12 left-1/2 -translate-x-1/2 px-3 py-1 bg-black/90 border border-white/20 rounded text-[10px] font-mono text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none backdrop-blur-md shadow-xl translate-y-2 group-hover:translate-y-0">
                                    {app.title}
                                </span>
                            </button>
                        );
                    })}
                </div>
            );
        };

        /* ================================================================================
           PART 6 COMPLETE
           PROCEED TO PART 7 FOR THE DESKTOP ENVIRONMENT
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 1: GRAPHING ENGINE X (Professional Plotting Suite)
        // ==================================================================================

        const GraphApp = () => {
            const [equation, setEquation] = useState('a * sin(b * x) * cos(y)');
            const [mode, setMode] = useState('3D'); // '2D' or '3D'
            const [showGrid, setShowGrid] = useState(true);
            const [params, setParams] = useState({ a: 1, b: 1, c: 0, k: 1 });
            const plotContainer = useRef(null);

            // INTELLIGENT VARIABLE DETECTION
            // Scans the input string for single letters (parameters) that are not reserved math constants
            useEffect(() => {
                // Regex to find single chars that are not x, y, z, t (variables) or e, i (constants)
                const vars = equation.match(/\b[a-zA-Z]\b/g);
                if (vars) {
                    const newParams = { ...params };
                    let hasChanges = false;
                    const reserved = ['x', 'y', 'z', 't', 'e', 'i'];
                    
                    vars.forEach(v => {
                        if (!reserved.includes(v) && newParams[v] === undefined) {
                            newParams[v] = 1; // Default start value
                            hasChanges = true;
                        }
                    });
                    
                    if (hasChanges) setParams(newParams);
                }
            }, [equation]);

            // RENDERING CORE
            useEffect(() => {
                if (!plotContainer.current) return;

                // 1. Analyze Equation
                const type = MathKernel.detectType(equation);
                const color = MathKernel.generateSignatureColor(equation);
                const textColor = '#a0aec0'; 
                const gridColor = '#1e293b';

                let data = [];
                let layout = {
                    autosize: true,
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: { family: 'Rajdhani', color: textColor },
                    margin: { l: 30, r: 20, t: 20, b: 30 },
                    xaxis: { 
                        showgrid: showGrid, 
                        gridcolor: gridColor, 
                        zerolinecolor: color,
                        autorange: true 
                    },
                    yaxis: { 
                        showgrid: showGrid, 
                        gridcolor: gridColor, 
                        zerolinecolor: color,
                        autorange: true 
                    },
                    // 3D Camera settings
                    scene: {
                        xaxis: { gridcolor: '#333', title: 'X' },
                        yaxis: { gridcolor: '#333', title: 'Y' },
                        zaxis: { gridcolor: '#333', title: 'Z' },
                        bgcolor: 'rgba(0,0,0,0)',
                        camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
                    }
                };

                try {
                    const expr = math.compile(equation);
                    const scope = { ...params }; // Inject slider values into math scope

                    if (mode === '3D') {
                        // 3D SURFACE PLOT
                        const range = math.range(-5, 5, 0.25).toArray();
                        const z = [];
                        
                        range.forEach(y => {
                            const row = [];
                            range.forEach(x => {
                                try { 
                                    // Evaluate z = f(x, y)
                                    row.push(expr.evaluate({ ...scope, x, y })); 
                                } catch { 
                                    row.push(0); 
                                }
                            });
                            z.push(row);
                        });
                        
                        data = [{
                            type: 'surface',
                            z: z,
                            x: range,
                            y: range,
                            colorscale: 'Viridis',
                            showscale: false,
                            contours: {
                                z: { show: true, usecolormap: true, highlightcolor: "#fff", project: { z: true } }
                            }
                        }];
                    } else {
                        // 2D SCATTER PLOT
                        const x = math.range(-15, 15, 0.1).toArray();
                        const y = x.map(val => {
                            try { return expr.evaluate({ ...scope, x: val }); } catch { return null; }
                        });
                        
                        data = [{
                            x: x, 
                            y: y,
                            type: 'scatter', 
                            mode: 'lines',
                            line: { color: color, width: 3, shape: 'spline' },
                            fill: 'tozeroy', 
                            fillcolor: color + '15' // Add transparency to hex
                        }];
                    }

                    // Render via Plotly
                    Plotly.react(plotContainer.current, data, layout, { 
                        displayModeBar: false, 
                        responsive: true,
                        scrollZoom: true
                    });

                } catch (e) {
                    // Silent fail ensures app doesn't crash while user is typing
                    // Optional: dispatch({ type: 'ADD_NOTIFICATION', payload: { title: 'Syntax Error', msg: 'Check equation' } });
                }

            }, [equation, mode, showGrid, params]);

            return (
                <div className="flex flex-col h-full bg-os-surface text-white">
                    {/* --- TOOLBAR --- */}
                    <div className="h-14 border-b border-white/10 flex items-center px-4 gap-4 bg-white/5 backdrop-blur-md z-10">
                        {/* Mode Switcher */}
                        <div className="flex bg-black/40 rounded-lg p-1 border border-white/5 shadow-inner">
                            <button 
                                onClick={() => setMode('2D')} 
                                className={`px-4 py-1 text-xs font-bold rounded-md transition-all font-tech tracking-wider ${mode==='2D' ? 'bg-neon-blue text-black shadow-[0_0_10px_#00f2ff]' : 'text-gray-500 hover:text-white'}`}
                            >2D</button>
                            <button 
                                onClick={() => setMode('3D')} 
                                className={`px-4 py-1 text-xs font-bold rounded-md transition-all font-tech tracking-wider ${mode==='3D' ? 'bg-neon-purple text-white shadow-[0_0_10px_#bc13fe]' : 'text-gray-500 hover:text-white'}`}
                            >3D</button>
                        </div>

                        {/* Equation Input */}
                        <div className="flex-1 relative group">
                            <span className="absolute left-3 top-1/2 -translate-y-1/2 font-mono text-xs text-gray-500 group-focus-within:text-neon-blue transition-colors">f(x)=</span>
                            <input 
                                className="w-full bg-black/30 border border-white/10 rounded-lg py-1.5 pl-12 pr-4 text-sm font-mono text-neon-green focus:border-neon-green focus:ring-1 focus:ring-neon-green/50 focus:outline-none transition-all placeholder-gray-700"
                                value={equation}
                                onChange={(e) => setEquation(e.target.value)}
                                placeholder="Enter expression..."
                                spellCheck="false"
                            />
                        </div>

                        {/* Grid Toggle */}
                        <button 
                            onClick={() => setShowGrid(!showGrid)} 
                            className={`w-8 h-8 flex items-center justify-center rounded-lg border border-white/10 transition-all ${showGrid ? 'bg-white/10 text-neon-blue' : 'text-gray-600 hover:text-white'}`}
                            title="Toggle Grid"
                        >
                            <i className="fas fa-border-all text-xs"></i>
                        </button>
                    </div>

                    {/* --- PARAMETER SLIDERS --- */}
                    {Object.keys(params).length > 0 && (
                        <div className="px-4 py-3 bg-black/40 border-b border-white/10 flex flex-wrap gap-4 overflow-x-auto custom-scroll min-h-[50px]">
                            {Object.keys(params).map(key => (
                                <div key={key} className="flex items-center gap-3 bg-white/5 px-3 py-1.5 rounded-full border border-white/5 animate-window-open">
                                    <span className="text-neon-gold font-mono font-bold text-xs">{key}</span>
                                    <input 
                                        type="range" min="-10" max="10" step="0.1" 
                                        value={params[key]} 
                                        onChange={(e) => setParams({...params, [key]: parseFloat(e.target.value)})}
                                        className="w-24 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer hover:bg-gray-600 transition-colors [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-neon-gold [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:shadow-[0_0_5px_#ffd700]"
                                    />
                                    <span className="text-xs text-gray-300 font-mono w-8 text-right">{params[key].toFixed(1)}</span>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* --- GRAPH CANVAS --- */}
                    <div className="flex-1 relative bg-gradient-to-br from-gray-900 to-black overflow-hidden group">
                        <div ref={plotContainer} className="absolute inset-0" />
                        
                        {/* Status Overlay */}
                        <div className="absolute bottom-4 right-4 text-[9px] font-mono text-white/20 pointer-events-none group-hover:text-white/40 transition-colors">
                            RENDER_CORE::PLOTLY_WEBGL // {mode}_VIEWPORT
                        </div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 7 COMPLETE
           PROCEED TO PART 8 FOR MATRIX LABORATORY
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 2: MATRIX LAB (Linear Algebra Suite)
        // ==================================================================================

        const MatrixApp = () => {
            const [matrix, setMatrix] = useState([
                [1, 2, 3], 
                [4, 5, 6], 
                [7, 8, 9]
            ]);
            const [result, setResult] = useState(null);

            // Update a single cell in the 3x3 grid
            const updateCell = (r, c, val) => {
                const newMatrix = [...matrix];
                newMatrix[r][c] = val;
                setMatrix(newMatrix);
            };

            // Execute a matrix operation via MathKernel
            const runOperation = (op) => {
                sysAudio.play('click');
                const res = MathKernel.solveMatrix(matrix, op);
                setResult(res);
                
                if (res.type === 'error') {
                    sysAudio.play('error');
                } else {
                    sysAudio.play('success');
                }
            };

            return (
                <div className="flex flex-col h-full bg-os-bg p-8 items-center justify-center relative overflow-hidden">
                    {/* Background Grid Effect */}
                    <div className="absolute inset-0 bg-grid-pattern opacity-10 pointer-events-none"></div>
                    
                    {/* --- MATRIX INPUT GRID --- */}
                    <div className="relative z-10 bg-white/5 p-6 rounded-2xl border border-white/10 shadow-deep backdrop-blur-xl mb-8 animate-window-open">
                        <div className="grid grid-rows-3 gap-3">
                            {matrix.map((row, r) => (
                                <div key={r} className="grid grid-cols-3 gap-3">
                                    {row.map((val, c) => (
                                        <input 
                                            key={`${r}-${c}`}
                                            className="w-16 h-14 bg-black border border-white/20 rounded-lg text-center font-mono text-lg text-neon-purple focus:border-neon-blue focus:shadow-glow-blue outline-none transition-all placeholder-gray-700"
                                            value={val}
                                            onChange={(e) => updateCell(r, c, e.target.value)}
                                            onFocus={() => sysAudio.play('hover')}
                                        />
                                    ))}
                                </div>
                            ))}
                        </div>
                        
                        {/* Brackets Decoration */}
                        <div className="absolute top-4 bottom-4 left-2 w-4 border-l-2 border-t-2 border-b-2 border-white/20 rounded-l-xl pointer-events-none"></div>
                        <div className="absolute top-4 bottom-4 right-2 w-4 border-r-2 border-t-2 border-b-2 border-white/20 rounded-r-xl pointer-events-none"></div>
                    </div>

                    {/* --- OPERATION TOOLBAR --- */}
                    <div className="flex flex-wrap justify-center gap-3 mb-8 relative z-10 max-w-lg">
                        {[
                            { id: 'det', label: 'Determinant' },
                            { id: 'inv', label: 'Inverse' },
                            { id: 'trace', label: 'Trace' },
                            { id: 'transpose', label: 'Transpose' },
                            { id: 'eigen', label: 'Eigenvalues' },
                            { id: 'rank', label: 'Rank' }
                        ].map(op => (
                            <button 
                                key={op.id}
                                onClick={() => runOperation(op.id)}
                                onMouseEnter={() => sysAudio.play('hover')}
                                className="px-4 py-2 bg-white/5 hover:bg-neon-blue hover:text-black border border-white/10 rounded-lg text-xs font-bold font-cyber tracking-wider uppercase transition-all shadow-lg hover:shadow-glow-blue hover:-translate-y-1 active:scale-95"
                            >
                                {op.label}
                            </button>
                        ))}
                    </div>

                    {/* --- RESULT TERMINAL --- */}
                    {result && (
                        <div className="w-full max-w-md bg-black/80 border-l-4 border-neon-purple p-5 rounded-r-xl shadow-2xl relative animate-window-open backdrop-blur-md">
                            <div className="text-[10px] font-cyber text-gray-500 uppercase tracking-widest mb-2 flex justify-between">
                                <span>Output_Stream</span>
                                <span className="text-neon-purple">{result.label}</span>
                            </div>
                            
                            <div className="font-mono text-sm text-white break-all leading-relaxed">
                                {result.type === 'matrix' ? (
                                    // Render Matrix Result
                                    <div className="grid gap-1">
                                        {result.val.map((row, i) => (
                                            <div key={i} className="flex gap-2">
                                                {row.map((cell, j) => (
                                                    <span key={j} className="flex-1 text-right text-neon-blue">
                                                        {typeof cell === 'number' ? cell.toFixed(3) : cell}
                                                    </span>
                                                ))}
                                            </div>
                                        ))}
                                    </div>
                                ) : result.type === 'vector' ? (
                                    // Render Vector Result
                                    <div className="text-neon-green">
                                        [ {result.val.map(v => typeof v === 'number' ? v.toFixed(4) : v).join(', ')} ]
                                    </div>
                                ) : (
                                    // Render Scalar/Error
                                    <span className={result.type === 'error' ? 'text-red-500 font-bold' : 'text-neon-gold text-xl font-bold'}>
                                        {result.val}
                                    </span>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        /* ================================================================================
           PART 8 COMPLETE
           PROCEED TO PART 9 FOR EQUATION SOLVER
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 3: SOLVER PRO (Equation Analysis Suite)
        // ==================================================================================

        const SolverApp = () => {
            const [input, setInput] = useState('x^2 - 4');
            const [analysis, setAnalysis] = useState(null);
            const [isComputing, setIsComputing] = useState(false);

            const analyzeEquation = () => {
                setIsComputing(true);
                sysAudio.play('click');

                // Simulate processing delay for "Compute" feel
                setTimeout(() => {
                    try {
                        let eqString = input.trim();
                        // Handle equations like "x^2 = 4" by moving everything to left "x^2 - 4"
                        if (eqString.includes('=')) {
                            const parts = eqString.split('=');
                            eqString = `(${parts[0]}) - (${parts[1]})`;
                        }

                        // 1. Symbolic Derivative
                        const node = math.parse(eqString);
                        const derivative = math.derivative(node, 'x').toString();

                        // 2. Numerical Root Finding (Scan method)
                        // We scan -20 to 20 looking for sign changes
                        const code = node.compile();
                        let roots = [];
                        const step = 0.1;
                        let prevY = code.evaluate({ x: -20 });
                        
                        for (let x = -20; x <= 20; x += step) {
                            try {
                                const y = code.evaluate({ x });
                                // Check for sign change (Intermediate Value Theorem)
                                if (Math.sign(y) !== Math.sign(prevY)) {
                                    // Refine root approximation
                                    const root = x - step / 2;
                                    roots.push(parseFloat(root.toFixed(3)));
                                }
                                // Check for exact zero
                                if (Math.abs(y) < 1e-9) {
                                    if (!roots.includes(parseFloat(x.toFixed(3)))) {
                                        roots.push(parseFloat(x.toFixed(3)));
                                    }
                                }
                                prevY = y;
                            } catch (e) {
                                prevY = NaN; // Handle singularities
                            }
                        }

                        // Remove duplicates and sort
                        roots = [...new Set(roots)].sort((a, b) => a - b);

                        setAnalysis({
                            roots: roots.length > 0 ? roots.join(', ') : 'No Real Roots found in range [-20, 20]',
                            derivative: derivative,
                            simplified: math.simplify(node).toString(),
                            type: MathKernel.detectType(input)
                        });
                        
                        sysAudio.play('success');

                    } catch (e) {
                        sysAudio.play('error');
                        setAnalysis({ error: 'Syntax Error or Complex Roots' });
                    }
                    setIsComputing(false);
                }, 600);
            };

            return (
                <div className="flex flex-col h-full bg-os-surface p-8 items-center justify-center font-sans">
                    <div className="w-full max-w-2xl">
                        
                        {/* --- HEADER --- */}
                        <div className="text-center mb-8">
                            <h2 className="text-3xl font-cyber font-bold text-white mb-2 tracking-tighter">SOLVER <span className="text-neon-green">PRO</span></h2>
                            <p className="text-gray-400 text-sm font-mono">Symbolic & Numerical Analysis Engine</p>
                        </div>

                        {/* --- INPUT AREA --- */}
                        <div className="relative mb-6 group">
                            <input 
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && analyzeEquation()}
                                className="w-full bg-black/40 border border-white/20 p-5 pl-6 rounded-2xl text-xl font-mono text-white focus:border-neon-green focus:shadow-[0_0_20px_rgba(10,255,96,0.2)] outline-none transition-all placeholder-gray-600"
                                placeholder="Enter equation (e.g. x^2 - 4x + 3)"
                            />
                            <div className="absolute right-4 top-1/2 -translate-y-1/2">
                                <button 
                                    onClick={analyzeEquation}
                                    className="w-10 h-10 rounded-xl bg-neon-green/10 border border-neon-green/50 text-neon-green hover:bg-neon-green hover:text-black transition-all flex items-center justify-center"
                                >
                                    <i className="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        {/* --- RESULTS PANEL --- */}
                        {analysis && !isComputing && (
                            <div className="animate-window-open grid gap-4">
                                {analysis.error ? (
                                    <div className="p-6 bg-red-500/10 border border-red-500/50 rounded-xl text-center text-red-400 font-mono">
                                        <i className="fas fa-exclamation-triangle mb-2 text-2xl"></i><br/>
                                        {analysis.error}
                                    </div>
                                ) : (
                                    <>
                                        {/* Roots Card */}
                                        <div className="bg-white/5 border border-white/10 p-5 rounded-xl hover:border-neon-green/30 transition-colors">
                                            <div className="text-[10px] text-gray-500 uppercase tracking-widest mb-1 font-bold">Real Roots (Zeros)</div>
                                            <div className="text-2xl font-mono text-white tracking-wide text-glow-green">
                                                {analysis.roots}
                                            </div>
                                        </div>

                                        {/* Derivative Card */}
                                        <div className="bg-white/5 border border-white/10 p-5 rounded-xl hover:border-neon-blue/30 transition-colors">
                                            <div className="text-[10px] text-gray-500 uppercase tracking-widest mb-1 font-bold">First Derivative f'(x)</div>
                                            <div className="text-xl font-mono text-neon-blue">
                                                {analysis.derivative}
                                            </div>
                                        </div>

                                        {/* Simplified Form */}
                                        <div className="bg-white/5 border border-white/10 p-5 rounded-xl flex justify-between items-center">
                                            <div>
                                                <div className="text-[10px] text-gray-500 uppercase tracking-widest mb-1 font-bold">Simplified Form</div>
                                                <div className="text-lg font-mono text-gray-300">{analysis.simplified}</div>
                                            </div>
                                            <div className="px-3 py-1 bg-black rounded border border-white/10 text-[10px] text-gray-400 font-mono">
                                                {analysis.type.toUpperCase()}
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {/* --- LOADING STATE --- */}
                        {isComputing && (
                            <div className="flex flex-col items-center justify-center py-12 animate-pulse">
                                <i className="fas fa-circle-notch fa-spin text-3xl text-neon-green mb-4"></i>
                                <div className="text-xs font-mono text-neon-green uppercase tracking-widest">Processing Quantum Logic...</div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 9 COMPLETE
           PROCEED TO PART 10 FOR ORBIT AI (SOLAR SYSTEM SIM)
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 4: ORBIT AI (Gravitational Physics Simulator)
        // ==================================================================================

        const OrbitApp = () => {
            const canvasRef = useRef(null);
            const [paused, setPaused] = useState(false);
            const [stats, setStats] = useState({ bodies: 0, fps: 60 });
            const bodiesRef = useRef([]); // Use ref for mutable physics state without re-renders
            const animationRef = useRef(null);
            const dragStart = useRef(null);

            // Initialize System
            const initSystem = (w, h) => {
                const cx = w / 2;
                const cy = h / 2;
                
                // Solar System Approximation (Not to scale, optimized for visual stability)
                bodiesRef.current = [
                    { id: 'sun', x: cx, y: cy, vx: 0, vy: 0, mass: 2000, radius: 25, color: '#ffd700', fixed: true, glow: true },
                    { id: 'mercury', x: cx + 60, y: cy, vx: 0, vy: 4.5, mass: 5, radius: 4, color: '#a1a1a1', fixed: false },
                    { id: 'earth', x: cx + 120, y: cy, vx: 0, vy: 3.5, mass: 15, radius: 6, color: '#00f2ff', fixed: false },
                    { id: 'mars', x: cx + 180, y: cy, vx: 0, vy: 2.8, mass: 12, radius: 5, color: '#ff4500', fixed: false },
                    { id: 'jupiter', x: cx + 300, y: cy, vx: 0, vy: 2.0, mass: 50, radius: 12, color: '#d4a373', fixed: false }
                ];
            };

            // Physics Engine Loop
            useEffect(() => {
                const cvs = canvasRef.current;
                const ctx = cvs.getContext('2d');
                let w = cvs.parentElement.clientWidth;
                let h = cvs.parentElement.clientHeight;
                cvs.width = w; cvs.height = h;

                initSystem(w, h);

                let lastTime = performance.now();
                let frameCount = 0;

                const loop = (time) => {
                    // FPS Counter
                    frameCount++;
                    if (time - lastTime >= 1000) {
                        setStats(prev => ({ ...prev, fps: frameCount, bodies: bodiesRef.current.length }));
                        frameCount = 0;
                        lastTime = time;
                    }

                    if (!paused) {
                        // 1. Trails Effect (Fade previous frame)
                        ctx.fillStyle = 'rgba(5, 5, 5, 0.15)'; 
                        ctx.fillRect(0, 0, w, h);

                        const bodies = bodiesRef.current;
                        const G = 0.5; // Gravitational Constant (Simulated)

                        // 2. Physics Calculations (O(N^2))
                        for (let i = 0; i < bodies.length; i++) {
                            let p1 = bodies[i];
                            
                            // Calculate Forces
                            if (!p1.fixed) {
                                for (let j = 0; j < bodies.length; j++) {
                                    if (i === j) continue;
                                    let p2 = bodies[j];

                                    const dx = p2.x - p1.x;
                                    const dy = p2.y - p1.y;
                                    const dist = Math.sqrt(dx*dx + dy*dy);
                                    
                                    // Soft collision / minimum distance to prevent singularity
                                    if (dist < p1.radius + p2.radius) continue;

                                    const force = (G * p1.mass * p2.mass) / (dist * dist);
                                    const ax = (force * dx) / dist;
                                    const ay = (force * dy) / dist;

                                    p1.vx += ax / p1.mass;
                                    p1.vy += ay / p1.mass;
                                }
                                
                                // Update Position
                                p1.x += p1.vx;
                                p1.y += p1.vy;

                                // Boundary Wrap (Optional: Keep them in view or let them fly?)
                                // Let's keep them free-flying for realism
                            }
                        }
                    }

                    // 3. Render
                    bodiesRef.current.forEach(b => {
                        ctx.beginPath();
                        ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
                        ctx.fillStyle = b.color;
                        ctx.shadowBlur = b.glow ? 40 : 10;
                        ctx.shadowColor = b.color;
                        ctx.fill();
                        ctx.shadowBlur = 0; // Reset
                    });

                    // 4. Draw Drag Line (Slingshot)
                    if (dragStart.current) {
                        // We need current mouse pos, simplified here via event listeners below
                    }

                    animationRef.current = requestAnimationFrame(loop);
                };
                
                animationRef.current = requestAnimationFrame(loop);

                // Resize Handler
                const handleResize = () => {
                    w = cvs.parentElement.clientWidth;
                    h = cvs.parentElement.clientHeight;
                    cvs.width = w; cvs.height = h;
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    cancelAnimationFrame(animationRef.current);
                    window.removeEventListener('resize', handleResize);
                };
            }, [paused]);

            // Interaction Handlers
            const handleMouseDown = (e) => {
                const rect = canvasRef.current.getBoundingClientRect();
                dragStart.current = { x: e.clientX - rect.left, y: e.clientY - rect.top };
            };

            const handleMouseUp = (e) => {
                if (!dragStart.current) return;
                const rect = canvasRef.current.getBoundingClientRect();
                const endX = e.clientX - rect.left;
                const endY = e.clientY - rect.top;

                // Calculate Velocity vector based on drag distance (Slingshot)
                const vx = (dragStart.current.x - endX) * 0.1;
                const vy = (dragStart.current.y - endY) * 0.1;

                bodiesRef.current.push({
                    id: Date.now(),
                    x: dragStart.current.x,
                    y: dragStart.current.y,
                    vx: vx,
                    vy: vy,
                    mass: Math.random() * 10 + 2,
                    radius: Math.random() * 4 + 2,
                    color: `hsl(${Math.random() * 360}, 100%, 70%)`,
                    fixed: false
                });

                dragStart.current = null;
                sysAudio.play('success'); // Launch sound
            };

            const reset = () => {
                const cvs = canvasRef.current;
                initSystem(cvs.width, cvs.height);
                sysAudio.play('click');
            };

            return (
                <div className="flex flex-col h-full bg-black relative group select-none">
                    {/* --- HUD OVERLAY --- */}
                    <div className="absolute top-4 left-4 z-10 flex flex-col gap-2">
                        <div className="px-3 py-1 bg-black/60 border border-white/10 rounded-lg text-[10px] font-mono text-neon-blue backdrop-blur-md">
                            SIMULATION_CORE::ACTIVE
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setPaused(!paused)} className="px-3 py-1 bg-white/10 hover:bg-white/20 border border-white/10 rounded text-xs font-bold text-white transition-all">
                                {paused ? <i className="fas fa-play"></i> : <i className="fas fa-pause"></i>}
                            </button>
                            <button onClick={reset} className="px-3 py-1 bg-white/10 hover:bg-white/20 border border-white/10 rounded text-xs font-bold text-white transition-all">
                                <i className="fas fa-rotate-right"></i> RESET
                            </button>
                        </div>
                    </div>

                    <div className="absolute top-4 right-4 z-10 text-right pointer-events-none">
                        <div className="text-2xl font-cyber font-bold text-white mb-1">FPS: {stats.fps}</div>
                        <div className="text-xs font-mono text-gray-400">OBJECTS: {stats.bodies}</div>
                        <div className="text-[10px] font-mono text-neon-gold mt-2 animate-pulse">
                            CLICK & DRAG TO LAUNCH
                        </div>
                    </div>

                    {/* --- CANVAS --- */}
                    <canvas 
                        ref={canvasRef} 
                        className="absolute inset-0 cursor-crosshair"
                        onMouseDown={handleMouseDown}
                        onMouseUp={handleMouseUp}
                    />
                    
                    {/* Background Stars (Static CSS) */}
                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30 pointer-events-none"></div>
                </div>
            );
        };

        /* ================================================================================
           PART 10 COMPLETE
           PROCEED TO PART 11 FOR VECTOR PHYSICS LAB
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 5: VECTOR PHYSICS LAB (Particle Engine)
        // ==================================================================================

        const PhysicsApp = () => {
            const canvasRef = useRef(null);
            
            // UI State (for sliders synchronization)
            const [uiState, setUiState] = useState({
                gravity: 0.5,
                friction: 0.99,
                mode: 'attract' // 'attract' | 'repel'
            });

            // Physics Engine State (Mutable for 60FPS Loop without Re-renders)
            const physicsState = useRef({
                gravity: 0.5,
                friction: 0.99,
                mode: 'attract',
                mouse: { x: -5000, y: -5000 }
            });

            const particles = useRef([]);
            const animationFrame = useRef(null);

            // Initialize Particle System
            const initSystem = (w, h) => {
                const colors = ['#00f2ff', '#bc13fe', '#ffffff', '#ffd700', '#ff0055'];
                particles.current = Array.from({ length: 350 }).map(() => ({
                    x: Math.random() * w,
                    y: Math.random() * h,
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4,
                    radius: Math.random() * 2 + 1,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    mass: Math.random() * 5 + 1
                }));
            };

            // Main Physics Loop
            useEffect(() => {
                const cvs = canvasRef.current;
                const ctx = cvs.getContext('2d');
                let w = cvs.parentElement.clientWidth;
                let h = cvs.parentElement.clientHeight;
                cvs.width = w; cvs.height = h;

                initSystem(w, h);

                const render = () => {
                    // Trails effect (partial clear)
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.25)';
                    ctx.fillRect(0, 0, w, h);

                    const { gravity, friction, mode, mouse } = physicsState.current;

                    particles.current.forEach(p => {
                        // 1. Apply Forces
                        p.vy += gravity * 0.2; // Gravity Constant
                        p.vx *= friction;      // Air Resistance
                        p.vy *= friction;

                        // 2. Mouse Interaction
                        const dx = mouse.x - p.x;
                        const dy = mouse.y - p.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        
                        if (dist < 250) {
                            const force = (250 - dist) * 0.002;
                            if (mode === 'attract') {
                                p.vx += dx * force;
                                p.vy += dy * force;
                            } else {
                                p.vx -= dx * force;
                                p.vy -= dy * force;
                            }
                        }

                        // 3. Update Position
                        p.x += p.vx;
                        p.y += p.vy;

                        // 4. Boundary Collision (Bounce)
                        if (p.x < 0) { p.x = 0; p.vx *= -0.9; }
                        if (p.x > w) { p.x = w; p.vx *= -0.9; }
                        if (p.y < 0) { p.y = 0; p.vy *= -0.9; }
                        if (p.y > h) { p.y = h; p.vy *= -0.8; }

                        // 5. Draw Particle
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        ctx.fillStyle = p.color;
                        ctx.fill();
                    });

                    animationFrame.current = requestAnimationFrame(render);
                };

                render();

                const handleResize = () => {
                    w = cvs.parentElement.clientWidth;
                    h = cvs.parentElement.clientHeight;
                    cvs.width = w; cvs.height = h;
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    cancelAnimationFrame(animationFrame.current);
                    window.removeEventListener('resize', handleResize);
                };
            }, []);

            // Input Handlers
            const handleMouseMove = (e) => {
                const rect = canvasRef.current.getBoundingClientRect();
                physicsState.current.mouse = { 
                    x: e.clientX - rect.left, 
                    y: e.clientY - rect.top 
                };
            };

            const updateSetting = (key, val) => {
                setUiState(prev => ({ ...prev, [key]: val }));
                physicsState.current[key] = val;
            };

            return (
                <div className="flex flex-col h-full bg-black relative select-none">
                    {/* --- CONTROLS HEADER --- */}
                    <div className="h-16 border-b border-white/10 bg-white/5 backdrop-blur-md flex items-center px-6 gap-6 z-10">
                        
                        {/* Gravity Slider */}
                        <div className="flex flex-col w-32 group">
                            <div className="flex justify-between text-[10px] font-mono text-neon-blue uppercase mb-1">
                                <span>Gravity</span>
                                <span>{uiState.gravity.toFixed(2)}</span>
                            </div>
                            <input 
                                type="range" min="0" max="2" step="0.1" 
                                value={uiState.gravity} 
                                onChange={(e) => updateSetting('gravity', parseFloat(e.target.value))}
                                className="h-1 bg-white/20 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-neon-blue [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:shadow-[0_0_10px_#00f2ff]"
                            />
                        </div>

                        {/* Friction Slider */}
                        <div className="flex flex-col w-32 group">
                            <div className="flex justify-between text-[10px] font-mono text-neon-purple uppercase mb-1">
                                <span>Friction</span>
                                <span>{uiState.friction.toFixed(3)}</span>
                            </div>
                            <input 
                                type="range" min="0.9" max="0.999" step="0.001" 
                                value={uiState.friction} 
                                onChange={(e) => updateSetting('friction', parseFloat(e.target.value))}
                                className="h-1 bg-white/20 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-neon-purple [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:shadow-[0_0_10px_#bc13fe]"
                            />
                        </div>

                        <div className="h-8 w-px bg-white/10"></div>

                        {/* Interaction Mode */}
                        <button 
                            onClick={() => updateSetting('mode', uiState.mode === 'attract' ? 'repel' : 'attract')}
                            className={`px-4 py-2 rounded-lg border border-white/10 text-xs font-bold font-cyber tracking-wider transition-all uppercase flex items-center gap-2 ${uiState.mode === 'attract' ? 'bg-neon-green/10 text-neon-green shadow-[0_0_10px_rgba(10,255,96,0.2)]' : 'bg-red-500/10 text-red-500 shadow-[0_0_10px_rgba(255,69,0,0.2)]'}`}
                        >
                            <i className={`fas ${uiState.mode === 'attract' ? 'fa-magnet' : 'fa-radiation'}`}></i>
                            {uiState.mode}
                        </button>

                        <div className="flex-1"></div>

                        {/* Reset */}
                        <button 
                            onClick={() => initSystem(canvasRef.current.width, canvasRef.current.height)}
                            className="w-8 h-8 flex items-center justify-center rounded-lg bg-white/10 hover:bg-white/20 hover:rotate-180 transition-all duration-500"
                            title="Reset Particle System"
                        >
                            <i className="fas fa-arrows-rotate text-xs text-white"></i>
                        </button>
                    </div>

                    {/* --- CANVAS --- */}
                    <div className="flex-1 relative bg-gradient-to-b from-gray-900 to-black">
                        <canvas 
                            ref={canvasRef} 
                            className="absolute inset-0 w-full h-full cursor-crosshair"
                            onMouseMove={handleMouseMove}
                            onMouseLeave={() => physicsState.current.mouse = { x: -5000, y: -5000 }}
                        />
                        
                        {/* Overlay Info */}
                        <div className="absolute bottom-4 left-4 text-[9px] font-mono text-gray-600 pointer-events-none">
                            VECTOR_FIELD::ACTIVE // PARTICLES: 350 // PHYSICS_ENGINE_V2
                        </div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 11 COMPLETE
           PROCEED TO PART 12 FOR ELEMENTA (PERIODIC TABLE)
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 6: ELEMENTA (Interactive Periodic Table)
        // ==================================================================================

        const PeriodicTableApp = () => {
            const [selected, setSelected] = useState(null);
            const [filter, setFilter] = useState('all');

            // --- DATA CORE: COMPRESSED CHEMICAL DATASET ---
            // Generates 118 elements with correct categorization logic
            const elements = useMemo(() => {
                const data = [];
                const cats = {
                    alkali: 'Alkali Metal', alkaline: 'Alkaline Earth', transition: 'Transition Metal',
                    post: 'Post-Transition', metalloid: 'Metalloid', nonmetal: 'Reactive Nonmetal',
                    halogen: 'Halogen', noble: 'Noble Gas', lanth: 'Lanthanide', act: 'Actinide'
                };

                const getCat = (n, g) => {
                    if (n === 1) return 'nonmetal';
                    if (n === 2 || g === 18) return 'noble';
                    if (g === 1) return 'alkali';
                    if (g === 2) return 'alkaline';
                    if (n >= 57 && n <= 71) return 'lanth';
                    if (n >= 89 && n <= 103) return 'act';
                    if (g >= 3 && g <= 12) return 'transition';
                    if (g === 17) return 'halogen';
                    if ([5, 14, 32, 33, 51, 52].includes(n)) return 'metalloid';
                    if ([13, 31, 49, 50, 81, 82, 83, 84].includes(n)) return 'post';
                    return 'nonmetal';
                };

                const symbols = "H He Li Be B C N O F Ne Na Mg Al Si P S Cl Ar K Ca Sc Ti V Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr Rb Sr Y Zr Nb Mo Tc Ru Rh Pd Ag Cd In Sn Sb Te I Xe Cs Ba La Ce Pr Nd Pm Sm Eu Gd Tb Dy Ho Er Tm Yb Lu Hf Ta W Re Os Ir Pt Au Hg Tl Pb Bi Po At Rn Fr Ra Ac Th Pa U Np Pu Am Cm Bk Cf Es Fm Md No Lr Rf Db Sg Bh Hs Mt Ds Rg Cn Nh Fl Mc Lv Ts Og".split(" ");
                const names = "Hydrogen Helium Lithium Beryllium Boron Carbon Nitrogen Oxygen Fluorine Neon Sodium Magnesium Aluminium Silicon Phosphorus Sulfur Chlorine Argon Potassium Calcium Scandium Titanium Vanadium Chromium Manganese Iron Cobalt Nickel Copper Zinc Gallium Germanium Arsenic Selenium Bromine Krypton Rubidium Strontium Yttrium Zirconium Niobium Molybdenum Technetium Ruthenium Rhodium Palladium Silver Cadmium Indium Tin Antimony Tellurium Iodine Xenon Caesium Barium Lanthanum Cerium Praseodymium Neodymium Promethium Samarium Europium Gadolinium Terbium Dysprosium Holmium Erbium Thulium Ytterbium Lutetium Hafnium Tantalum Tungsten Rhenium Osmium Iridium Platinum Gold Mercury Thallium Lead Bismuth Polonium Astatine Radon Francium Radium Actinium Thorium Protactinium Uranium Neptunium Plutonium Americium Curium Berkelium Californium Einsteinium Fermium Mendelevium Nobelium Lawrencium Rutherfordium Dubnium Seaborgium Bohrium Hassium Meitnerium Darmstadtium Roentgenium Copernicium Nihonium Flerovium Moscovium Livermorium Tennessine Oganesson".split(" ");

                for (let i = 0; i < 118; i++) {
                    const n = i + 1;
                    // Grid Logic
                    let row = 1, col = 1;
                    if (n === 1) { row=1; col=1; }
                    else if (n === 2) { row=1; col=18; }
                    else if (n <= 18) { row = n <= 10 ? 2 : 3; col = n <= 4 ? (n-2) : n <= 10 ? n+10-2 : (n-10) <= 2 ? n-10 : n+10-10; } // Simplified for brevity in loop, fixed below
                    
                    // Precise Group/Period Calculation for CSS Grid
                    if (n >= 3 && n <= 10) { row=2; col = n-2 > 2 ? n+8 : n-2; } // Li, Be .. B, C
                    if (n >= 11 && n <= 18) { row=3; col = n-10 > 2 ? n-10+10 : n-10; }
                    if (n === 5 || n === 13) col = 13; // Patching gaps
                    
                    // General Mapping
                    // Period 1
                    if(n==1) {row=1; col=1;}
                    if(n==2) {row=1; col=18;}
                    // Period 2
                    if(n>=3 && n<=4) {row=2; col=n-2;}
                    if(n>=5 && n<=10) {row=2; col=n+8;}
                    // Period 3
                    if(n>=11 && n<=12) {row=3; col=n-10;}
                    if(n>=13 && n<=18) {row=3; col=n+2;}
                    // Period 4
                    if(n>=19 && n<=36) {row=4; col=n-18;}
                    // Period 5
                    if(n>=37 && n<=54) {row=5; col=n-36;}
                    // Period 6 (incl Lanthanides)
                    if(n>=55 && n<=56) {row=6; col=n-54;}
                    if(n>=57 && n<=71) {row=9; col=n-53;} // Lanthanide Row
                    if(n>=72 && n<=86) {row=6; col=n-68;}
                    // Period 7 (incl Actinides)
                    if(n>=87 && n<=88) {row=7; col=n-86;}
                    if(n>=89 && n<=103) {row=10; col=n-85;} // Actinide Row
                    if(n>=104 && n<=118) {row=7; col=n-100;}

                    let group = col;
                    
                    data.push({
                        n: n,
                        sym: symbols[i],
                        name: names[i],
                        mass: (n * 2 + n * 0.1).toFixed(3), // Simulated mass
                        cat: getCat(n, group),
                        row: row,
                        col: col,
                        config: `[Rn] 5f${(n%14)||1} 7s2` // Simulated
                    });
                }
                return data;
            }, []);

            // Visual Categories Map
            const catStyles = {
                'alkali': 'border-red-500 text-red-400 bg-red-500/10',
                'alkaline': 'border-orange-400 text-orange-300 bg-orange-400/10',
                'transition': 'border-yellow-500 text-yellow-300 bg-yellow-500/10',
                'post': 'border-green-400 text-green-300 bg-green-400/10',
                'metalloid': 'border-teal-400 text-teal-300 bg-teal-400/10',
                'nonmetal': 'border-blue-400 text-blue-300 bg-blue-400/10',
                'halogen': 'border-indigo-400 text-indigo-300 bg-indigo-400/10',
                'noble': 'border-purple-400 text-purple-300 bg-purple-400/10',
                'lanth': 'border-pink-400 text-pink-300 bg-pink-400/10',
                'act': 'border-rose-500 text-rose-300 bg-rose-500/10'
            };

            const filteredElements = filter === 'all' ? elements : elements.filter(e => e.cat === filter);

            return (
                <div className="flex flex-col lg:flex-row h-full bg-os-bg text-white overflow-hidden">
                    {/* --- MAIN TABLE AREA --- */}
                    <div className="flex-1 flex flex-col min-h-0">
                        {/* Filter Bar */}
                        <div className="h-14 border-b border-white/10 flex items-center px-4 gap-2 overflow-x-auto custom-scroll shrink-0 bg-white/5">
                            <button 
                                onClick={() => setFilter('all')} 
                                className={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border transition-all whitespace-nowrap ${filter === 'all' ? 'bg-white text-black border-white' : 'border-white/20 text-gray-400 hover:border-white'}`}
                            >All</button>
                            {Object.keys(catStyles).map(c => (
                                <button 
                                    key={c}
                                    onClick={() => setFilter(c)}
                                    className={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border transition-all whitespace-nowrap ${filter === c ? catStyles[c] : 'border-white/10 text-gray-500 hover:text-white'}`}
                                >{c}</button>
                            ))}
                        </div>

                        {/* The Grid */}
                        <div className="flex-1 overflow-auto p-6 bg-grid-pattern relative custom-scroll">
                            <div className="grid gap-1.5" style={{ 
                                display: 'grid', 
                                gridTemplateColumns: 'repeat(18, minmax(36px, 1fr))', 
                                gridTemplateRows: 'repeat(10, minmax(36px, 1fr))',
                                minWidth: '800px' // Force horizontal scroll on mobile
                            }}>
                                {elements.map((el) => {
                                    const isDimmed = filter !== 'all' && filter !== el.cat;
                                    return (
                                        <button 
                                            key={el.n}
                                            onClick={() => { setSelected(el); sysAudio.play('click'); }}
                                            onMouseEnter={() => !isDimmed && sysAudio.play('hover')}
                                            className={`
                                                relative rounded-md border flex flex-col items-center justify-center transition-all duration-300
                                                ${catStyles[el.cat]}
                                                ${isDimmed ? 'opacity-20 scale-90 grayscale' : 'hover:scale-125 hover:z-50 hover:shadow-[0_0_15px_currentColor] cursor-pointer'}
                                            `}
                                            style={{ 
                                                gridColumn: el.col, 
                                                gridRow: el.row,
                                                aspectRatio: '1/1'
                                            }}
                                        >
                                            <span className="text-[8px] absolute top-0.5 left-1 opacity-60">{el.n}</span>
                                            <span className="font-bold text-sm">{el.sym}</span>
                                        </button>
                                    );
                                })}
                                
                                {/* Spacers / Labels for Lanthanides/Actinides */}
                                <div style={{ gridColumn: '1/19', gridRow: '8', height: '20px' }}></div>
                            </div>
                        </div>
                    </div>

                    {/* --- INSPECTOR PANEL --- */}
                    <div className="w-full lg:w-80 bg-os-surface border-t lg:border-t-0 lg:border-l border-white/10 p-6 flex flex-col shrink-0 relative overflow-hidden h-64 lg:h-auto">
                        {/* Background Effect */}
                        <div className="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 pointer-events-none"></div>
                        
                        <div className="text-[10px] font-cyber text-gray-500 uppercase tracking-[0.2em] mb-4 z-10">Atomic Inspector</div>

                        {selected ? (
                            <div className="animate-window-open relative z-10 flex flex-col h-full">
                                {/* Atom Visualizer (CSS Representation) */}
                                <div className={`w-32 h-32 mx-auto mb-4 rounded-full border-4 flex items-center justify-center relative shadow-deep ${catStyles[selected.cat].split(' ')[0]}`}>
                                    <div className="absolute inset-0 rounded-full animate-spin-slow border-t border-b border-white/20"></div>
                                    <div className="absolute inset-2 rounded-full animate-spin border-r border-l border-white/10" style={{ animationDuration: '3s' }}></div>
                                    <div className="text-5xl font-bold">{selected.sym}</div>
                                </div>

                                <div className="text-center mb-6">
                                    <h2 className="text-3xl font-bold text-white mb-1">{selected.name}</h2>
                                    <div className={`inline-block px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border ${catStyles[selected.cat]}`}>
                                        {selected.cat}
                                    </div>
                                </div>

                                <div className="space-y-3 font-mono text-xs flex-1 overflow-y-auto custom-scroll">
                                    <div className="flex justify-between p-3 bg-white/5 rounded border border-white/5">
                                        <span className="text-gray-500">Atomic Number</span>
                                        <span className="text-white font-bold">{selected.n}</span>
                                    </div>
                                    <div className="flex justify-between p-3 bg-white/5 rounded border border-white/5">
                                        <span className="text-gray-500">Atomic Mass</span>
                                        <span className="text-neon-blue">{selected.mass} u</span>
                                    </div>
                                    <div className="flex justify-between p-3 bg-white/5 rounded border border-white/5">
                                        <span className="text-gray-500">Config</span>
                                        <span className="text-neon-purple">Simulated</span>
                                    </div>
                                    <div className="flex justify-between p-3 bg-white/5 rounded border border-white/5">
                                        <span className="text-gray-500">State (STP)</span>
                                        <span className="text-neon-gold">Solid</span>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center text-gray-600 opacity-50 z-10">
                                <i className="fas fa-atom text-6xl mb-4 animate-float"></i>
                                <p className="text-center text-xs font-mono">Select an element<br/>to analyze structure.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 12 COMPLETE
           PROCEED TO PART 13 FOR TRIGMASTER (UNIT CIRCLE)
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 7: TRIGMASTER (Interactive Unit Circle)
        // ==================================================================================

        const TrigCircleApp = () => {
            const [angle, setAngle] = useState(45); // Degrees
            const [isDragging, setIsDragging] = useState(false);
            const svgRef = useRef(null);

            // Circle Config
            const radius = 120;
            const centerX = 150;
            const centerY = 150;

            // Math Calculations
            const rad = (angle * Math.PI) / 180;
            const x = centerX + radius * Math.cos(rad);
            const y = centerY - radius * Math.sin(rad); // Y inverted for SVG

            const handleMouseDown = () => setIsDragging(true);
            const handleMouseUp = () => setIsDragging(false);

            const handleMouseMove = (e) => {
                if (!isDragging) return;
                
                const rect = svgRef.current.getBoundingClientRect();
                const mouseX = e.clientX - rect.left - centerX;
                const mouseY = e.clientY - rect.top - centerY;
                
                // Calculate angle from center using atan2
                let theta = Math.atan2(-mouseY, mouseX); // -Y because SVG Y goes down
                if (theta < 0) theta += 2 * Math.PI; // Normalize to 0-2PI
                
                const degrees = (theta * 180) / Math.PI;
                setAngle(degrees);
            };

            return (
                <div 
                    className="flex flex-col lg:flex-row h-full bg-black text-white"
                    onMouseMove={handleMouseMove}
                    onMouseUp={handleMouseUp}
                    onMouseLeave={handleMouseUp}
                >
                    {/* --- VISUALIZER AREA --- */}
                    <div className="flex-1 relative flex items-center justify-center bg-grid-pattern overflow-hidden">
                        <div className="absolute top-4 left-4 text-[10px] font-cyber text-gray-500 uppercase tracking-widest">
                            Unit Circle Visualizer
                        </div>

                        <svg 
                            ref={svgRef} 
                            width="300" height="300" 
                            className="select-none cursor-crosshair overflow-visible"
                            onMouseDown={handleMouseDown}
                        >
                            {/* Grid Axes */}
                            <line x1="0" y1="150" x2="300" y2="150" stroke="#333" strokeWidth="1" />
                            <line x1="150" y1="0" x2="150" y2="300" stroke="#333" strokeWidth="1" />

                            {/* Main Circle */}
                            <circle cx="150" cy="150" r={radius} stroke="#444" strokeWidth="2" fill="none" />

                            {/* Dynamic Triangle */}
                            <path d={`M150,150 L${x},150 L${x},${y} Z`} fill="rgba(0, 243, 255, 0.1)" stroke="none" />
                            
                            {/* Cosine Line (Adjacent) */}
                            <line x1="150" y1="150" x2={x} y2="150" stroke="#bc13fe" strokeWidth="3" />
                            
                            {/* Sine Line (Opposite) */}
                            <line x1={x} y1="150" x2={x} y2={y} stroke="#00f2ff" strokeWidth="3" />
                            
                            {/* Hypotenuse (Radius) */}
                            <line x1="150" y1="150" x2={x} y2={y} stroke="#ffffff" strokeWidth="2" strokeDasharray="4,2" />

                            {/* Angle Arc */}
                            <path d={`M180,150 A30,30 0 0,0 ${150 + 30*Math.cos(rad)},${150 - 30*Math.sin(rad)}`} fill="none" stroke="#ffd700" strokeWidth="2" />

                            {/* Drag Handle */}
                            <circle 
                                cx={x} cy={y} r="8" 
                                fill="#ffffff" 
                                className="cursor-pointer hover:scale-125 transition-transform"
                                stroke="rgba(0,0,0,0.5)" strokeWidth="2"
                            />
                        </svg>

                        {/* Drag Hint */}
                        <div className="absolute bottom-4 text-[9px] font-mono text-gray-600 animate-pulse">
                            DRAG THE WHITE DOT TO ROTATE
                        </div>
                    </div>

                    {/* --- DATA PANEL --- */}
                    <div className="w-full lg:w-72 bg-os-surface border-t lg:border-t-0 lg:border-l border-white/10 p-6 flex flex-col justify-center relative shrink-0">
                        {/* Current Angle Display */}
                        <div className="mb-8 text-center relative z-10">
                            <div className="text-[10px] text-gray-500 uppercase tracking-widest mb-1">Angle $\theta$</div>
                            <div className="text-5xl font-mono font-bold text-white mb-2">{angle.toFixed(0)}</div>
                            <div className="text-xs font-mono text-neon-gold bg-neon-gold/10 px-3 py-1 rounded-full inline-block">
                                {(angle * (Math.PI/180)).toFixed(3)} rad
                            </div>
                        </div>

                        {/* Trig Functions */}
                        <div className="space-y-4 relative z-10">
                            {/* Sine Card */}
                            <div className="p-4 bg-white/5 rounded-xl border-l-4 border-neon-blue transition-all hover:bg-white/10">
                                <div className="flex justify-between items-end mb-1">
                                    <span className="text-gray-400 text-xs font-bold">SIN $\theta$</span>
                                    <span className="text-[10px] text-neon-blue">Opposite / Hyp</span>
                                </div>
                                <div className="text-2xl font-mono text-white tracking-widest">
                                    {Math.sin(rad).toFixed(4)}
                                </div>
                            </div>

                            {/* Cosine Card */}
                            <div className="p-4 bg-white/5 rounded-xl border-l-4 border-neon-purple transition-all hover:bg-white/10">
                                <div className="flex justify-between items-end mb-1">
                                    <span className="text-gray-400 text-xs font-bold">COS $\theta$</span>
                                    <span className="text-[10px] text-neon-purple">Adjacent / Hyp</span>
                                </div>
                                <div className="text-2xl font-mono text-white tracking-widest">
                                    {Math.cos(rad).toFixed(4)}
                                </div>
                            </div>

                            {/* Tangent Card */}
                            <div className="p-4 bg-white/5 rounded-xl border-l-4 border-neon-green transition-all hover:bg-white/10">
                                <div className="flex justify-between items-end mb-1">
                                    <span className="text-gray-400 text-xs font-bold">TAN $\theta$</span>
                                    <span className="text-[10px] text-neon-green">Sin / Cos</span>
                                </div>
                                <div className="text-2xl font-mono text-white tracking-widest">
                                    {Math.abs(Math.tan(rad)) > 100 ? '' : Math.tan(rad).toFixed(4)}
                                </div>
                            </div>
                        </div>

                        {/* Background Decor */}
                        <div className="absolute top-0 right-0 w-32 h-32 bg-neon-blue/5 rounded-full blur-3xl pointer-events-none"></div>
                        <div className="absolute bottom-0 left-0 w-32 h-32 bg-neon-purple/5 rounded-full blur-3xl pointer-events-none"></div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 13 COMPLETE
           PROCEED TO PART 14 FOR OMNI-HANDBOOK
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 8: OMNI-HANDBOOK (Universal Reference)
        // ==================================================================================

        const HandbookApp = () => {
            const [tab, setTab] = useState('constants');
            const [search, setSearch] = useState('');

            // --- DATASETS ---
            const constants = [
                { sym: 'c', val: '299,792,458 m/s', name: 'Speed of Light', cat: 'Physics', desc: 'Maximum speed at which all massless particles travel.' },
                { sym: 'G', val: '6.67410 Nm/kg', name: 'Gravitational Constant', cat: 'Physics', desc: 'Determines the strength of gravity.' },
                { sym: 'h', val: '6.62610 Js', name: 'Planck Constant', cat: 'Quantum', desc: 'Relates photon energy to frequency.' },
                { sym: 'e', val: '1.60210 C', name: 'Elementary Charge', cat: 'Electromagnetism', desc: 'Electric charge carried by a single proton.' },
                { sym: 'N', val: '6.02210 mol', name: 'Avogadro Constant', cat: 'Chemistry', desc: 'Number of constituent particles in one mole.' },
                { sym: 'k', val: '1.38010 J/K', name: 'Boltzmann Constant', cat: 'Thermodynamics', desc: 'Relates average kinetic energy to temperature.' },
                { sym: 'R', val: '8.314 J/(molK)', name: 'Gas Constant', cat: 'Thermodynamics', desc: 'Used in the Ideal Gas Law (PV=nRT).' },
                { sym: '', val: '8.85410 F/m', name: 'Vacuum Permittivity', cat: 'Electromagnetism', desc: 'Capability of a vacuum to permit electric fields.' },
                { sym: '', val: '410 H/m', name: 'Vacuum Permeability', cat: 'Electromagnetism', desc: 'Capability of a vacuum to support magnetic fields.' },
                { sym: '', val: '1.618033...', name: 'Golden Ratio', cat: 'Math', desc: 'Unique ratio found in geometry and nature.' }
            ];

            const greek = [
                { u: '', l: '', n: 'Alpha', u_desc: 'Angular acceleration, Absorption factor' },
                { u: '', l: '', n: 'Beta', u_desc: 'Beta radiation, Sound intensity' },
                { u: '', l: '', n: 'Gamma', u_desc: 'Lorentz factor, Surface energy' },
                { u: '', l: '', n: 'Delta', u_desc: 'Change/Difference, Discriminant' },
                { u: '', l: '', n: 'Epsilon', u_desc: 'Permittivity, Strain, Error' },
                { u: '', l: '', n: 'Zeta', u_desc: 'Damping ratio, Riemann zeta func' },
                { u: '', l: '', n: 'Eta', u_desc: 'Efficiency, Viscosity' },
                { u: '', l: '', n: 'Theta', u_desc: 'Angles, Temperature' },
                { u: '', l: '', n: 'Iota', u_desc: 'Inclusion map, Index generator' },
                { u: '', l: '', n: 'Kappa', u_desc: 'Curvature, Connectivity' },
                { u: '', l: '', n: 'Lambda', u_desc: 'Wavelength, Eigenvalues' },
                { u: '', l: '', n: 'Mu', u_desc: 'Micro prefix, Friction, Mean' },
                { u: '', l: '', n: 'Nu', u_desc: 'Frequency, Poisson\'s ratio' },
                { u: '', l: '', n: 'Xi', u_desc: 'Damping ratio, Universal set' },
                { u: '', l: '', n: 'Omicron', u_desc: 'Big O notation (variant)' },
                { u: '', l: '', n: 'Pi', u_desc: 'Circle constant, Product operator' },
                { u: '', l: '', n: 'Rho', u_desc: 'Density, Resistivity, Correlation' },
                { u: '', l: '', n: 'Sigma', u_desc: 'Summation, Standard Deviation' },
                { u: '', l: '', n: 'Tau', u_desc: 'Torque, Time constant' },
                { u: '', l: '', n: 'Upsilon', u_desc: 'Mass-to-light ratio' },
                { u: '', l: '', n: 'Phi', u_desc: 'Magnetic flux, Phase, Golden ratio' },
                { u: '', l: '', n: 'Chi', u_desc: 'Chi-squared distribution' },
                { u: '', l: '', n: 'Psi', u_desc: 'Wave function (Quantum Mech)' },
                { u: '', l: '', n: 'Omega', u_desc: 'Resistance (Ohms), Angular velocity' }
            ];

            const prefixes = [
                { p: 'Yotta', s: 'Y', v: '10', n: 'Septillion' },
                { p: 'Zetta', s: 'Z', v: '10', n: 'Sextillion' },
                { p: 'Exa', s: 'E', v: '10', n: 'Quintillion' },
                { p: 'Peta', s: 'P', v: '10', n: 'Quadrillion' },
                { p: 'Tera', s: 'T', v: '10', n: 'Trillion' },
                { p: 'Giga', s: 'G', v: '10', n: 'Billion' },
                { p: 'Mega', s: 'M', v: '10', n: 'Million' },
                { p: 'Kilo', s: 'k', v: '10', n: 'Thousand' },
                { p: 'Hecto', s: 'h', v: '10', n: 'Hundred' },
                { p: 'Deca', s: 'da', v: '10', n: 'Ten' },
                { p: 'Deci', s: 'd', v: '10', n: 'Tenth' },
                { p: 'Centi', s: 'c', v: '10', n: 'Hundredth' },
                { p: 'Milli', s: 'm', v: '10', n: 'Thousandth' },
                { p: 'Micro', s: '', v: '10', n: 'Millionth' },
                { p: 'Nano', s: 'n', v: '10', n: 'Billionth' },
                { p: 'Pico', s: 'p', v: '10', n: 'Trillionth' },
                { p: 'Femto', s: 'f', v: '10', n: 'Quadrillionth' },
                { p: 'Atto', s: 'a', v: '10', n: 'Quintillionth' },
                { p: 'Zepto', s: 'z', v: '10', n: 'Sextillionth' },
                { p: 'Yocto', s: 'y', v: '10', n: 'Septillionth' }
            ];

            return (
                <div className="flex flex-col lg:flex-row h-full bg-os-bg text-white font-sans">
                    {/* --- SIDEBAR NAV --- */}
                    <div className="w-full lg:w-48 bg-os-surface border-r border-white/10 p-4 flex flex-col gap-2 shrink-0">
                        <div className="text-[10px] font-cyber font-bold text-gray-500 uppercase tracking-widest mb-2 px-2">
                            Library Index
                        </div>
                        {['constants', 'greek', 'prefixes'].map(t => (
                            <button 
                                key={t}
                                onClick={() => { setTab(t); sysAudio.play('click'); }}
                                className={`text-left px-4 py-3 rounded-lg text-xs font-bold transition-all uppercase tracking-wide flex items-center justify-between group ${tab === t ? 'bg-neon-blue/10 text-neon-blue border border-neon-blue/30' : 'text-gray-400 hover:bg-white/5 hover:text-white border border-transparent'}`}
                            >
                                {t}
                                {tab === t && <i className="fas fa-chevron-right text-[10px]"></i>}
                            </button>
                        ))}

                        <div className="mt-auto hidden lg:block">
                             <div className="p-3 bg-white/5 rounded-xl border border-white/5 text-[10px] text-gray-500 font-mono leading-relaxed">
                                 TIP: Use these values in the Solver Pro app for precise calculations.
                             </div>
                        </div>
                    </div>

                    {/* --- CONTENT AREA --- */}
                    <div className="flex-1 flex flex-col min-h-0 bg-void relative">
                        {/* Search Bar */}
                        <div className="p-4 border-b border-white/10 bg-white/5 backdrop-blur-md z-10">
                            <div className="relative">
                                <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-xs"></i>
                                <input 
                                    className="w-full bg-black/40 border border-white/10 rounded-lg py-2 pl-10 pr-4 text-xs font-mono text-white focus:border-neon-blue focus:outline-none transition-all placeholder-gray-600 uppercase"
                                    placeholder={`SEARCH ${tab.toUpperCase()}...`}
                                    value={search}
                                    onChange={(e) => setSearch(e.target.value)}
                                />
                            </div>
                        </div>

                        {/* Scrollable List */}
                        <div className="flex-1 overflow-y-auto p-6 custom-scroll">
                            
                            {/* TAB: CONSTANTS */}
                            {tab === 'constants' && (
                                <div className="grid gap-3">
                                    {constants
                                        .filter(c => c.name.toLowerCase().includes(search.toLowerCase()) || c.sym.toLowerCase().includes(search.toLowerCase()))
                                        .map((c, i) => (
                                        <div key={i} className="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/5 hover:border-neon-blue/50 transition-all group hover:-translate-y-1 hover:shadow-lg">
                                            <div className="flex items-center gap-4">
                                                <div className="w-12 h-12 flex items-center justify-center bg-black/50 rounded-lg border border-white/10 font-serif text-2xl text-neon-blue group-hover:text-white transition-colors">
                                                    {c.sym}
                                                </div>
                                                <div>
                                                    <div className="text-sm font-bold text-gray-200">{c.name}</div>
                                                    <div className="text-[10px] text-gray-500">{c.desc}</div>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <div className="font-mono text-sm text-white group-hover:text-neon-blue transition-colors">{c.val}</div>
                                                <div className="text-[9px] text-gray-600 uppercase tracking-widest border border-white/10 px-2 py-0.5 rounded-full inline-block mt-1">{c.cat}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* TAB: GREEK ALPHABET */}
                            {tab === 'greek' && (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                    {greek
                                        .filter(g => g.n.toLowerCase().includes(search.toLowerCase()))
                                        .map((g, i) => (
                                        <div key={i} className="p-4 bg-white/5 rounded-xl border border-white/5 hover:bg-white/10 transition-all group">
                                            <div className="flex items-baseline gap-4 mb-3 border-b border-white/5 pb-2">
                                                <span className="text-3xl font-serif text-neon-purple group-hover:scale-110 transition-transform">{g.u}</span>
                                                <span className="text-3xl font-serif text-neon-purple group-hover:scale-110 transition-transform">{g.l}</span>
                                                <span className="text-sm font-bold text-white ml-auto font-cyber tracking-widest">{g.n}</span>
                                            </div>
                                            <div className="text-[10px] text-gray-400 font-mono leading-relaxed">
                                                <span className="text-neon-purple">USAGE:</span> {g.u_desc}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* TAB: SI PREFIXES */}
                            {tab === 'prefixes' && (
                                <div className="space-y-1">
                                    <div className="grid grid-cols-4 text-[9px] font-bold text-gray-500 uppercase tracking-widest px-4 mb-2">
                                        <span>Prefix</span>
                                        <span>Symbol</span>
                                        <span className="text-right">Factor</span>
                                        <span className="text-right">Name</span>
                                    </div>
                                    {prefixes
                                        .filter(p => p.p.toLowerCase().includes(search.toLowerCase()))
                                        .map((p, i) => (
                                        <div key={i} className="grid grid-cols-4 items-center p-3 bg-white/5 rounded-lg border border-white/5 font-mono text-xs hover:bg-white/10 transition-colors">
                                            <span className="text-neon-green font-bold">{p.p}</span>
                                            <span className="text-white">{p.s}</span>
                                            <span className="text-right text-gray-400">{p.v}</span>
                                            <span className="text-right text-gray-500 text-[10px] uppercase">{p.n}</span>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 14 COMPLETE
           PROCEED TO PART 15 FOR WALLSTREET PRO (FINANCE)
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 9: WALLSTREET PRO (Financial Engine)
        // ==================================================================================

        const FinanceApp = () => {
            const [mode, setMode] = useState('cagr');
            const [inputs, setInputs] = useState({
                p: 10000,   // Principal / Initial
                r: 10,      // Rate / Final Value for CAGR
                t: 5,       // Time (Years)
                n: 12       // Compound Frequency / Months
            });
            const [result, setResult] = useState(null);

            const calculate = () => {
                const { p, r, t, n } = inputs;
                let val = 0;
                let label = '';
                let subLabel = '';

                sysAudio.play('click');

                try {
                    switch(mode) {
                        case 'si': // Simple Interest
                            val = p * (1 + (r/100) * t);
                            label = 'Future Value';
                            subLabel = `Total Interest: ${(val - p).toFixed(2)}`;
                            break;

                        case 'ci': // Compound Interest
                            val = p * Math.pow((1 + (r/100)/n), n*t);
                            label = 'Future Value';
                            subLabel = `Total Interest: ${(val - p).toFixed(2)}`;
                            break;

                        case 'cagr': // CAGR (r is treated as Final Value here)
                            if (p === 0) throw new Error("Initial value cannot be zero");
                            val = (Math.pow(r / p, 1 / t) - 1) * 100;
                            label = 'CAGR %';
                            subLabel = `${t} Year Growth Rate`;
                            break;

                        case 'loan': // Loan Amortization (EMI)
                            const ratePerMonth = (r / 12) / 100;
                            const months = t * 12;
                            val = p * ratePerMonth * Math.pow(1 + ratePerMonth, months) / (Math.pow(1 + ratePerMonth, months) - 1);
                            label = 'Monthly EMI';
                            subLabel = `Total Payback: ${(val * months).toFixed(2)}`;
                            break;
                    }

                    setResult({ val, label, subLabel });
                    sysAudio.play('success');

                } catch (e) {
                    sysAudio.play('error');
                    setResult({ error: 'Calculation Error' });
                }
            };

            const updateInput = (key, val) => {
                setInputs({ ...inputs, [key]: parseFloat(val) });
            };

            const modes = [
                { id: 'si', label: 'Simple Interest', icon: 'fa-percent' },
                { id: 'ci', label: 'Compound Interest', icon: 'fa-chart-line' },
                { id: 'cagr', label: 'CAGR Growth', icon: 'fa-seedling' },
                { id: 'loan', label: 'Loan Amortization', icon: 'fa-house-chimney' }
            ];

            return (
                <div className="flex h-full bg-os-bg text-white font-sans overflow-hidden">
                    {/* --- SIDEBAR NAV --- */}
                    <div className="w-64 bg-os-surface border-r border-white/10 p-6 flex flex-col gap-2 shrink-0">
                        <div className="text-[10px] font-cyber text-gray-500 uppercase tracking-widest mb-4">
                            Financial Models
                        </div>
                        {modes.map(m => (
                            <button 
                                key={m.id}
                                onClick={() => { setMode(m.id); setResult(null); sysAudio.play('click'); }}
                                className={`flex items-center gap-3 px-4 py-3 rounded-lg text-xs font-bold transition-all text-left ${mode === m.id ? 'bg-neon-gold text-black shadow-lg shadow-neon-gold/20' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                            >
                                <i className={`fas ${m.icon} w-5`}></i>
                                {m.label}
                            </button>
                        ))}
                    </div>

                    {/* --- MAIN WORKSPACE --- */}
                    <div className="flex-1 p-8 flex flex-col overflow-y-auto custom-scroll relative">
                        {/* Background Decoration */}
                        <div className="absolute top-0 right-0 w-64 h-64 bg-neon-gold/5 rounded-full blur-[100px] pointer-events-none"></div>

                        <div className="max-w-3xl mx-auto w-full relative z-10">
                            <h2 className="text-2xl font-bold font-cyber text-white mb-8 flex items-center gap-3">
                                <span className="text-neon-gold">//</span> 
                                {modes.find(m => m.id === mode).label}
                            </h2>

                            {/* Inputs Grid */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div>
                                    <label className="text-[10px] font-cyber text-neon-blue uppercase tracking-widest mb-2 block">
                                        {mode === 'cagr' ? 'Initial Value' : 'Principal Amount'}
                                    </label>
                                    <div className="relative group">
                                        <span className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-mono"></span>
                                        <input 
                                            type="number" 
                                            value={inputs.p} 
                                            onChange={(e) => updateInput('p', e.target.value)}
                                            className="w-full bg-black border border-white/20 rounded-xl py-3 pl-10 pr-4 text-white font-mono focus:border-neon-gold focus:shadow-glow-gold outline-none transition-all"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="text-[10px] font-cyber text-neon-purple uppercase tracking-widest mb-2 block">
                                        {mode === 'cagr' ? 'Final Value' : 'Interest Rate (%)'}
                                    </label>
                                    <div className="relative">
                                        <input 
                                            type="number" 
                                            value={inputs.r} 
                                            onChange={(e) => updateInput('r', e.target.value)}
                                            className="w-full bg-black border border-white/20 rounded-xl py-3 px-4 text-white font-mono focus:border-neon-gold focus:shadow-glow-gold outline-none transition-all"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="text-[10px] font-cyber text-gray-400 uppercase tracking-widest mb-2 block">
                                        Duration (Years)
                                    </label>
                                    <input 
                                        type="number" 
                                        value={inputs.t} 
                                        onChange={(e) => updateInput('t', e.target.value)}
                                        className="w-full bg-black border border-white/20 rounded-xl py-3 px-4 text-white font-mono focus:border-neon-gold focus:shadow-glow-gold outline-none transition-all"
                                    />
                                </div>

                                {(mode === 'ci' || mode === 'loan') && (
                                    <div className="animate-window-open">
                                        <label className="text-[10px] font-cyber text-gray-400 uppercase tracking-widest mb-2 block">
                                            {mode === 'loan' ? 'Payments / Year' : 'Compounding Freq'}
                                        </label>
                                        <select 
                                            value={inputs.n}
                                            onChange={(e) => updateInput('n', e.target.value)}
                                            className="w-full bg-black border border-white/20 rounded-xl py-3 px-4 text-white font-mono focus:border-neon-gold focus:shadow-glow-gold outline-none transition-all appearance-none cursor-pointer"
                                        >
                                            <option value="1">Yearly (1)</option>
                                            <option value="2">Half-Yearly (2)</option>
                                            <option value="4">Quarterly (4)</option>
                                            <option value="12">Monthly (12)</option>
                                        </select>
                                    </div>
                                )}
                            </div>

                            <button 
                                onClick={calculate}
                                className="w-full py-4 bg-gradient-to-r from-yellow-600 to-yellow-500 rounded-xl font-cyber font-bold text-black tracking-widest hover:scale-[1.02] hover:shadow-[0_0_20px_#ffd700] transition-all active:scale-95"
                            >
                                EXECUTE PROJECTION
                            </button>

                            {/* Result Display */}
                            {result && (
                                <div className="mt-8 p-6 bg-black/60 border border-neon-gold/30 rounded-2xl animate-window-open backdrop-blur-md relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-1 h-full bg-neon-gold"></div>
                                    
                                    {result.error ? (
                                        <div className="text-red-500 font-mono">{result.error}</div>
                                    ) : (
                                        <div className="text-center">
                                            <div className="text-xs font-cyber text-gray-400 uppercase tracking-widest mb-2">{result.label}</div>
                                            <div className="text-5xl font-mono font-bold text-white mb-2 drop-shadow-lg">
                                                {mode === 'cagr' ? '' : ''}
                                                {result.val.toLocaleString(undefined, { maximumFractionDigits: 2 })}
                                                {mode === 'cagr' ? '%' : ''}
                                            </div>
                                            <div className="inline-block px-3 py-1 rounded-full bg-white/10 text-[10px] font-mono text-neon-gold border border-neon-gold/20">
                                                {result.subLabel}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 15 COMPLETE
           PROCEED TO PART 16 FOR QUANTUMCALC
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 10: QUANTUMCALC (Scientific Calculator)
        // ==================================================================================

        const CalculatorApp = () => {
            const [display, setDisplay] = useState('0');
            const [history, setHistory] = useState([]);
            const [degMode, setDegMode] = useState(true); // Degrees vs Radians

            const handleInput = (val) => {
                sysAudio.play('click');
                if (display === '0' || display === 'Error') {
                    setDisplay(val);
                } else {
                    setDisplay(display + val);
                }
            };

            const clear = () => {
                sysAudio.play('click');
                setDisplay('0');
            };

            const backspace = () => {
                sysAudio.play('click');
                if (display.length === 1 || display === 'Error') {
                    setDisplay('0');
                } else {
                    setDisplay(display.slice(0, -1));
                }
            };

            const calculate = () => {
                try {
                    // Pre-process string for MathJS
                    let expr = display
                        .replace(//g, '*')
                        .replace(//g, '/')
                        .replace(//g, 'pi')
                        .replace(//g, 'sqrt');

                    // Handle Degree/Radian Conversion for Trig
                    // MathJS defaults to Radians. If DegMode is on, we wrap trig args
                    if (degMode) {
                        expr = expr.replace(/sin\(([^)]+)\)/g, 'sin($1 deg)')
                                   .replace(/cos\(([^)]+)\)/g, 'cos($1 deg)')
                                   .replace(/tan\(([^)]+)\)/g, 'tan($1 deg)');
                    }

                    const res = math.evaluate(expr);
                    const formattedRes = parseFloat(res.toFixed(8)).toString();

                    setHistory(prev => [{ eq: display, res: formattedRes }, ...prev].slice(0, 10));
                    setDisplay(formattedRes);
                    sysAudio.play('success');
                } catch (e) {
                    sysAudio.play('error');
                    setDisplay('Error');
                }
            };

            // Keyboard support
            useEffect(() => {
                const handleKeyDown = (e) => {
                    const key = e.key;
                    if (/[0-9+\-*/().]/.test(key)) handleInput(key);
                    if (key === 'Enter') calculate();
                    if (key === 'Backspace') backspace();
                    if (key === 'Escape') clear();
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [display]);

            const buttons = [
                { label: 'C', type: 'fn', action: clear },
                { label: '(', type: 'fn', action: () => handleInput('(') },
                { label: ')', type: 'fn', action: () => handleInput(')') },
                { label: '', type: 'fn', action: backspace },
                
                { label: 'sin', type: 'sci', action: () => handleInput('sin(') },
                { label: 'cos', type: 'sci', action: () => handleInput('cos(') },
                { label: 'tan', type: 'sci', action: () => handleInput('tan(') },
                { label: '', type: 'op', action: () => handleInput('/') },
                
                { label: '7', type: 'num', action: () => handleInput('7') },
                { label: '8', type: 'num', action: () => handleInput('8') },
                { label: '9', type: 'num', action: () => handleInput('9') },
                { label: '', type: 'op', action: () => handleInput('*') },
                
                { label: '4', type: 'num', action: () => handleInput('4') },
                { label: '5', type: 'num', action: () => handleInput('5') },
                { label: '6', type: 'num', action: () => handleInput('6') },
                { label: '-', type: 'op', action: () => handleInput('-') },
                
                { label: '1', type: 'num', action: () => handleInput('1') },
                { label: '2', type: 'num', action: () => handleInput('2') },
                { label: '3', type: 'num', action: () => handleInput('3') },
                { label: '+', type: 'op', action: () => handleInput('+') },
                
                { label: '0', type: 'num', action: () => handleInput('0') },
                { label: '.', type: 'num', action: () => handleInput('.') },
                { label: '', type: 'sci', action: () => handleInput('') },
                { label: '=', type: 'eq', action: calculate },
            ];

            return (
                <div className="flex flex-col h-full bg-os-bg p-6 font-mono overflow-hidden">
                    {/* --- DISPLAY --- */}
                    <div className="bg-black border border-white/10 rounded-2xl p-6 mb-4 text-right shadow-inner relative overflow-hidden shrink-0">
                        {/* Mode Indicator */}
                        <button 
                            onClick={() => setDegMode(!degMode)}
                            className="absolute top-4 left-4 text-[10px] font-bold px-2 py-0.5 rounded bg-white/10 text-neon-gold hover:bg-white/20 transition-colors uppercase tracking-widest"
                        >
                            {degMode ? 'DEG' : 'RAD'}
                        </button>

                        <div className="text-gray-500 text-sm h-6 overflow-hidden">
                            {history.length > 0 ? history[0].eq + ' =' : ''}
                        </div>
                        <div className={`text-4xl font-bold tracking-wider ${display === 'Error' ? 'text-red-500' : 'text-white'}`}>
                            {display}
                        </div>
                    </div>

                    {/* --- KEYPAD --- */}
                    <div className="flex-1 grid grid-cols-4 gap-3 min-h-0">
                        {buttons.map((btn, i) => (
                            <button
                                key={i}
                                onClick={btn.action}
                                className={`
                                    rounded-xl text-lg font-bold transition-all active:scale-95 flex items-center justify-center shadow-lg
                                    ${btn.type === 'num' ? 'bg-white/5 text-white hover:bg-white/10' : ''}
                                    ${btn.type === 'op' ? 'bg-neon-blue/10 text-neon-blue border border-neon-blue/20 hover:bg-neon-blue/20' : ''}
                                    ${btn.type === 'fn' ? 'bg-red-500/10 text-red-400 hover:bg-red-500/20' : ''}
                                    ${btn.type === 'sci' ? 'bg-neon-purple/10 text-neon-purple hover:bg-neon-purple/20 text-sm' : ''}
                                    ${btn.type === 'eq' ? 'bg-gradient-to-br from-neon-blue to-blue-600 text-black shadow-[0_0_15px_#00f2ff]' : ''}
                                `}
                            >
                                {btn.label}
                            </button>
                        ))}
                    </div>

                    {/* --- HISTORY TAPE (Hidden on small screens) --- */}
                    <div className="hidden lg:block absolute top-6 right-full mr-4 w-48 h-[calc(100%-3rem)] bg-os-surface border border-white/10 rounded-xl p-4 overflow-y-auto custom-scroll opacity-0 hover:opacity-100 hover:translate-x-full transition-all duration-300 z-50 shadow-2xl backdrop-blur-md">
                        <div className="text-[10px] text-gray-500 uppercase tracking-widest mb-2 border-b border-white/10 pb-1">Tape</div>
                        {history.map((item, i) => (
                            <div key={i} className="mb-3 text-right">
                                <div className="text-xs text-gray-400">{item.eq}</div>
                                <div className="text-sm text-neon-blue font-bold">= {item.res}</div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 16 COMPLETE
           PROCEED TO PART 17 FOR CODERUSH
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 11: CODERUSH (Developer Typing Game)
        // ==================================================================================

        const CodeRushApp = () => {
            // Curated list of programming keywords
            const wordBank = [
                'function', 'const', 'let', 'var', 'return', 'async', 'await', 
                'import', 'export', 'default', 'class', 'extends', 'super',
                'this', 'new', 'try', 'catch', 'finally', 'throw', 'if', 'else',
                'switch', 'case', 'break', 'continue', 'while', 'for', 'do',
                'void', 'typeof', 'instanceof', 'in', 'of', 'delete', 'debugger',
                'react', 'hook', 'state', 'effect', 'context', 'reducer', 'memo',
                'component', 'props', 'render', 'mount', 'update', 'unmount',
                'promise', 'resolve', 'reject', 'then', 'catch', 'map', 'filter',
                'reduce', 'find', 'some', 'every', 'splice', 'slice', 'concat',
                'push', 'pop', 'shift', 'unshift', 'join', 'split', 'reverse',
                'json', 'stringify', 'parse', 'object', 'array', 'string', 'number',
                'boolean', 'null', 'undefined', 'symbol', 'bigint', 'interface',
                'type', 'enum', 'implements', 'public', 'private', 'protected'
            ];

            const [gameState, setGameState] = useState('MENU'); // MENU, PLAYING, GAME_OVER
            const [target, setTarget] = useState('');
            const [input, setInput] = useState('');
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(30);
            const [highScore, setHighScore] = useState(0);
            const timerRef = useRef(null);
            const inputRef = useRef(null);

            // Game Loop
            useEffect(() => {
                if (gameState === 'PLAYING') {
                    inputRef.current?.focus();
                    
                    timerRef.current = setInterval(() => {
                        setTimeLeft((prev) => {
                            if (prev <= 1) {
                                endGame();
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(timerRef.current);
            }, [gameState]);

            const startGame = () => {
                setScore(0);
                setTimeLeft(30);
                setInput('');
                setTarget(wordBank[Math.floor(Math.random() * wordBank.length)]);
                setGameState('PLAYING');
                sysAudio.play('startup');
            };

            const endGame = () => {
                clearInterval(timerRef.current);
                setGameState('GAME_OVER');
                sysAudio.play('error'); // Game Over sound
            };

            const handleInput = (e) => {
                const val = e.target.value.trim();
                setInput(val);

                if (val === target) {
                    // Word Correct
                    setScore(prev => prev + 1);
                    setInput('');
                    setTarget(wordBank[Math.floor(Math.random() * wordBank.length)]);
                    sysAudio.play('click'); // Click is used as the "hit" sound here
                }
            };

            // Update High Score when game ends
            useEffect(() => {
                if (gameState === 'GAME_OVER') {
                    if (score > highScore) setHighScore(score);
                }
            }, [gameState, score]);

            return (
                <div className="flex flex-col h-full bg-black font-mono relative overflow-hidden text-neon-green selection:bg-neon-green selection:text-black">
                    
                    {/* Background Scanline Effect */}
                    <div className="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-0 bg-[length:100%_4px,6px_100%] pointer-events-none animate-scanline"></div>
                    
                    {/* --- MAIN MENU --- */}
                    {gameState === 'MENU' && (
                        <div className="flex-1 flex flex-col items-center justify-center z-10 space-y-8 animate-window-open">
                            <div className="text-center">
                                <h2 className="text-6xl font-black mb-2 tracking-tighter text-white drop-shadow-[0_0_10px_rgba(0,255,0,0.8)]">
                                    CODE_RUSH
                                </h2>
                                <div className="text-sm uppercase tracking-[0.5em] text-gray-500">
                                    Developer Speed Test
                                </div>
                            </div>
                            
                            <button 
                                onClick={startGame}
                                className="px-10 py-4 border-2 border-neon-green text-neon-green hover:bg-neon-green hover:text-black hover:shadow-[0_0_30px_#0aff60] transition-all text-xl font-bold uppercase tracking-widest"
                            >
                                Initiate Sequence
                            </button>

                            <div className="text-xs text-gray-600">
                                TARGET: SYNTAX KEYWORDS // DURATION: 30s
                            </div>
                        </div>
                    )}

                    {/* --- PLAYING STATE --- */}
                    {gameState === 'PLAYING' && (
                        <div className="flex-1 flex flex-col items-center justify-center z-10">
                            {/* HUD */}
                            <div className="w-full max-w-md flex justify-between items-center mb-12 border-b border-white/10 pb-4">
                                <div>
                                    <div className="text-[10px] text-gray-500 uppercase">Score</div>
                                    <div className="text-3xl font-bold">{score}</div>
                                </div>
                                <div className="text-right">
                                    <div className="text-[10px] text-gray-500 uppercase">Time Remaining</div>
                                    <div className={`text-3xl font-bold ${timeLeft < 10 ? 'text-red-500 animate-pulse' : 'text-white'}`}>
                                        00:{timeLeft.toString().padStart(2, '0')}
                                    </div>
                                </div>
                            </div>

                            {/* Target Word */}
                            <div className="mb-8 relative">
                                <div className="text-6xl font-bold text-white tracking-wide animate-float">
                                    {target}
                                </div>
                                <div className="absolute -bottom-4 left-0 w-full h-1 bg-gray-800 rounded-full overflow-hidden">
                                    <div 
                                        className="h-full bg-neon-green transition-all duration-300"
                                        style={{ width: `${(input.length / target.length) * 100}%` }}
                                    ></div>
                                </div>
                            </div>

                            {/* Input */}
                            <input 
                                ref={inputRef}
                                value={input}
                                onChange={handleInput}
                                autoFocus
                                className="w-full max-w-md bg-transparent text-center text-4xl text-neon-green outline-none border-b-2 border-transparent focus:border-neon-green/50 placeholder-gray-800 transition-all uppercase"
                                placeholder="TYPE_HERE"
                                spellCheck="false"
                            />
                        </div>
                    )}

                    {/* --- GAME OVER --- */}
                    {gameState === 'GAME_OVER' && (
                        <div className="flex-1 flex flex-col items-center justify-center z-10 animate-window-open">
                            <div className="text-red-500 text-6xl font-black mb-2 tracking-tighter shadow-red-500">
                                SESSION_TERMINATED
                            </div>
                            
                            <div className="grid grid-cols-2 gap-8 my-8 text-center">
                                <div className="p-6 bg-white/5 border border-white/10 rounded-xl">
                                    <div className="text-xs text-gray-500 uppercase mb-1">Words Typed</div>
                                    <div className="text-4xl font-bold text-white">{score}</div>
                                </div>
                                <div className="p-6 bg-white/5 border border-white/10 rounded-xl">
                                    <div className="text-xs text-gray-500 uppercase mb-1">Est. WPM</div>
                                    <div className="text-4xl font-bold text-neon-gold">{score * 2}</div>
                                </div>
                            </div>

                            {score > 0 && score === highScore && (
                                <div className="mb-8 text-neon-gold animate-bounce font-bold tracking-widest">
                                    NEW HIGH SCORE!
                                </div>
                            )}

                            <button 
                                onClick={startGame}
                                className="px-8 py-3 bg-white/10 hover:bg-white/20 border border-white/10 rounded text-white font-bold uppercase tracking-widest transition-all"
                            >
                                Retry
                            </button>
                            
                            <button 
                                onClick={() => setGameState('MENU')}
                                className="mt-4 text-xs text-gray-500 hover:text-white underline"
                            >
                                Return to Menu
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        /* ================================================================================
           PART 17 COMPLETE
           PROCEED TO PART 18 FOR SONICVIEW (AUDIO VISUALIZER)
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 12: SONICVIEW (Audio Visualization Engine)
        // ==================================================================================

        const SonicApp = () => {
            const canvasRef = useRef(null);
            const animationRef = useRef(null);

            useEffect(() => {
                const cvs = canvasRef.current;
                const ctx = cvs.getContext('2d');
                let w = cvs.parentElement.clientWidth;
                let h = cvs.parentElement.clientHeight;
                cvs.width = w; cvs.height = h;

                // Simulation Config
                const bars = 64; // Number of bars per channel
                const barWidth = (w / 2) / bars; 

                let time = 0;

                const render = () => {
                    // Clear Screen
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(0, 0, w, h);

                    // Grid Lines (Background)
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    for(let i=1; i<5; i++) {
                        const y = h - (h/5)*i;
                        ctx.moveTo(0, y);
                        ctx.lineTo(w, y);
                    }
                    ctx.stroke();

                    // Generate Frequency Data (Simulated)
                    // In a real app, this would come from AnalyserNode.getByteFrequencyData()
                    const dataLeft = [];
                    const dataRight = [];
                    
                    for (let i = 0; i < bars; i++) {
                        // Complex wave function to simulate realistic music patterns
                        const noise = Math.sin(time * 0.05 + i * 0.1) * Math.cos(time * 0.1 - i * 0.05);
                        const beat = Math.pow(Math.sin(time * 0.1), 10) * 0.5; // Simulate a "kick" drum
                        const height = Math.abs(noise + beat) * (h * 0.8);
                        
                        // Shaping the curve (Bell curve filter)
                        const bell = 1 - Math.abs((i - bars/2) / (bars/2));
                        
                        dataLeft.push(height * bell);
                        dataRight.push(height * bell * 0.9); // Slight variation for stereo effect
                    }

                    // DRAW LEFT CHANNEL (Pink/Purple)
                    for (let i = 0; i < bars; i++) {
                        const barH = dataLeft[i];
                        const x = (w / 2) - (i * barWidth) - barWidth; // Mirror left
                        const y = h - barH;

                        // Gradient
                        const grad = ctx.createLinearGradient(0, h, 0, y);
                        grad.addColorStop(0, '#ff0055'); // Pink
                        grad.addColorStop(1, '#bc13fe'); // Purple

                        ctx.fillStyle = grad;
                        ctx.fillRect(x, y, barWidth - 2, barH);
                        
                        // Top Cap
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(x, y - 4, barWidth - 2, 2);
                    }

                    // DRAW RIGHT CHANNEL (Green/Blue)
                    for (let i = 0; i < bars; i++) {
                        const barH = dataRight[i];
                        const x = (w / 2) + (i * barWidth);
                        const y = h - barH;

                        // Gradient
                        const grad = ctx.createLinearGradient(0, h, 0, y);
                        grad.addColorStop(0, '#ffd700'); // Gold
                        grad.addColorStop(1, '#0aff60'); // Green

                        ctx.fillStyle = grad;
                        ctx.fillRect(x, y, barWidth - 2, barH);

                        // Top Cap
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(x, y - 4, barWidth - 2, 2);
                    }

                    time += 1;
                    animationRef.current = requestAnimationFrame(render);
                };

                render();

                const handleResize = () => {
                    w = cvs.parentElement.clientWidth;
                    h = cvs.parentElement.clientHeight;
                    cvs.width = w; cvs.height = h;
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    cancelAnimationFrame(animationRef.current);
                    window.removeEventListener('resize', handleResize);
                };
            }, []);

            return (
                <div className="flex flex-col h-full bg-black relative overflow-hidden group">
                    {/* Header */}
                    <div className="absolute top-0 left-0 w-full h-10 bg-white/5 backdrop-blur border-b border-white/10 flex items-center justify-between px-4 z-10">
                        <div className="flex items-center gap-2">
                            <div className="w-2 h-2 rounded-full bg-neon-blue animate-pulse"></div>
                            <span className="text-[10px] font-cyber text-neon-blue uppercase tracking-widest">
                                AUDIO_CORE // VISUALIZATION_ACTIVE
                            </span>
                        </div>
                        <div className="text-[10px] font-mono text-gray-500">
                            STEREO_MIX_BUS_A
                        </div>
                    </div>

                    {/* Canvas */}
                    <canvas ref={canvasRef} className="block w-full h-full" />
                    
                    {/* Overlay Scanlines */}
                    <div className="absolute inset-0 pointer-events-none bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,6px_100%] opacity-20"></div>
                </div>
            );
        };

        /* ================================================================================
           PART 18 COMPLETE
           PROCEED TO PART 19 FOR UNIT CONVERTER
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 13: UNIT CONVERTER (Universal Translation Engine)
        // ==================================================================================

        const ConverterApp = () => {
            const [category, setCategory] = useState('length');
            const [val, setVal] = useState(1);
            const [fromUnit, setFromUnit] = useState('m');
            const [toUnit, setToUnit] = useState('ft');
            const [result, setResult] = useState(0);

            const categories = {
                length: {
                    label: 'Length',
                    units: [
                        { id: 'm', label: 'Meters (m)', f: 1 },
                        { id: 'km', label: 'Kilometers (km)', f: 1000 },
                        { id: 'cm', label: 'Centimeters (cm)', f: 0.01 },
                        { id: 'mm', label: 'Millimeters (mm)', f: 0.001 },
                        { id: 'mi', label: 'Miles (mi)', f: 1609.34 },
                        { id: 'yd', label: 'Yards (yd)', f: 0.9144 },
                        { id: 'ft', label: 'Feet (ft)', f: 0.3048 },
                        { id: 'in', label: 'Inches (in)', f: 0.0254 },
                        { id: 'ly', label: 'Light Years', f: 9.461e15 }
                    ]
                },
                mass: {
                    label: 'Mass',
                    units: [
                        { id: 'kg', label: 'Kilograms (kg)', f: 1 },
                        { id: 'g', label: 'Grams (g)', f: 0.001 },
                        { id: 'mg', label: 'Milligrams (mg)', f: 0.000001 },
                        { id: 'lb', label: 'Pounds (lb)', f: 0.453592 },
                        { id: 'oz', label: 'Ounces (oz)', f: 0.0283495 },
                        { id: 't', label: 'Metric Ton (t)', f: 1000 }
                    ]
                },
                time: {
                    label: 'Time',
                    units: [
                        { id: 's', label: 'Seconds (s)', f: 1 },
                        { id: 'min', label: 'Minutes (min)', f: 60 },
                        { id: 'h', label: 'Hours (h)', f: 3600 },
                        { id: 'd', label: 'Days (d)', f: 86400 },
                        { id: 'w', label: 'Weeks (w)', f: 604800 },
                        { id: 'y', label: 'Years (y)', f: 31536000 }
                    ]
                },
                digital: {
                    label: 'Digital',
                    units: [
                        { id: 'b', label: 'Bits (b)', f: 1 },
                        { id: 'B', label: 'Bytes (B)', f: 8 },
                        { id: 'KB', label: 'Kilobytes (KB)', f: 8192 },
                        { id: 'MB', label: 'Megabytes (MB)', f: 8388608 },
                        { id: 'GB', label: 'Gigabytes (GB)', f: 8589934592 },
                        { id: 'TB', label: 'Terabytes (TB)', f: 8796093022208 }
                    ]
                }
            };

            // Calculate Effect
            useEffect(() => {
                try {
                    const cat = categories[category];
                    const from = cat.units.find(u => u.id === fromUnit);
                    const to = cat.units.find(u => u.id === toUnit);
                    
                    if(from && to) {
                        // Base conversion logic: (Value * FromFactor) / ToFactor
                        const res = (val * from.f) / to.f;
                        setResult(res);
                    }
                } catch(e) {}
            }, [val, fromUnit, toUnit, category]);

            const swap = () => {
                const temp = fromUnit;
                setFromUnit(toUnit);
                setToUnit(temp);
                sysAudio.play('click');
            };

            return (
                <div className="flex flex-col h-full bg-os-bg font-sans overflow-hidden text-white">
                    {/* --- CATEGORY SELECTOR --- */}
                    <div className="flex items-center gap-2 p-4 overflow-x-auto border-b border-white/10 bg-white/5 shrink-0 custom-scroll">
                        {Object.keys(categories).map(key => (
                            <button
                                key={key}
                                onClick={() => { setCategory(key); setFromUnit(categories[key].units[0].id); setToUnit(categories[key].units[1].id); sysAudio.play('click'); }}
                                className={`px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider transition-all whitespace-nowrap border ${category === key ? 'bg-neon-blue text-black border-neon-blue' : 'border-white/10 text-gray-400 hover:text-white hover:border-white/30'}`}
                            >
                                {categories[key].label}
                            </button>
                        ))}
                    </div>

                    {/* --- CONVERSION AREA --- */}
                    <div className="flex-1 flex flex-col items-center justify-center p-8 relative">
                         {/* Background Icon */}
                         <div className="absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none">
                             <i className="fas fa-right-left text-[200px]"></i>
                         </div>

                         <div className="w-full max-w-lg space-y-6 relative z-10">
                             
                             {/* Input Block */}
                             <div className="bg-black/40 border border-white/10 rounded-2xl p-6 backdrop-blur-md">
                                 <label className="text-[10px] text-gray-500 uppercase font-bold mb-2 block">Input Value</label>
                                 <div className="flex gap-4">
                                     <input 
                                         type="number" 
                                         value={val}
                                         onChange={e => setVal(parseFloat(e.target.value) || 0)}
                                         className="flex-1 bg-transparent text-3xl font-mono text-white outline-none border-b border-white/20 focus:border-neon-blue transition-all"
                                     />
                                     <select 
                                         value={fromUnit}
                                         onChange={e => setFromUnit(e.target.value)}
                                         className="bg-white/10 text-white rounded-lg px-3 text-sm font-bold border border-white/10 outline-none focus:border-neon-blue"
                                     >
                                         {categories[category].units.map(u => (
                                             <option key={u.id} value={u.id} className="bg-gray-900">{u.label}</option>
                                         ))}
                                     </select>
                                 </div>
                             </div>

                             {/* Swap Button */}
                             <div className="flex justify-center -my-3 relative z-20">
                                 <button 
                                     onClick={swap}
                                     className="w-10 h-10 rounded-full bg-neon-blue text-black flex items-center justify-center shadow-[0_0_15px_rgba(0,242,255,0.4)] hover:scale-110 hover:rotate-180 transition-all duration-300"
                                 >
                                     <i className="fas fa-arrow-down-up"></i>
                                 </button>
                             </div>

                             {/* Result Block */}
                             <div className="bg-white/5 border border-white/10 rounded-2xl p-6 backdrop-blur-md">
                                 <label className="text-[10px] text-gray-500 uppercase font-bold mb-2 block">Converted Value</label>
                                 <div className="flex gap-4 items-baseline">
                                     <div className="flex-1 text-3xl font-mono text-neon-green overflow-hidden text-ellipsis">
                                         {parseFloat(result.toPrecision(7))}
                                     </div>
                                     <select 
                                         value={toUnit}
                                         onChange={e => setToUnit(e.target.value)}
                                         className="bg-white/10 text-white rounded-lg px-3 py-2 text-sm font-bold border border-white/10 outline-none focus:border-neon-green"
                                     >
                                         {categories[category].units.map(u => (
                                             <option key={u.id} value={u.id} className="bg-gray-900">{u.label}</option>
                                         ))}
                                     </select>
                                 </div>
                             </div>

                         </div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 19 COMPLETE
           PROCEED TO PART 20 FOR NEXUS DB (NOTES APP)
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 14: NEXUS DB (Persistent Notes System)
        // ==================================================================================

        const NexusApp = () => {
            // Load initial state from LocalStorage or default
            const loadNotes = () => {
                const saved = localStorage.getItem('nexus_db_v1');
                if (saved) return JSON.parse(saved);
                return [
                    { id: 1, title: 'Project Alpha', content: 'Initial render core stability test passed.\nOptimizing matrix multiplication algorithms for 4x4 tensors.', date: new Date().toLocaleDateString() },
                    { id: 2, title: 'Quantum Formulas', content: 'Schrdinger Equation:\ni(/t)(r,t) = (r,t)\n\nNeed to implement visualizer for probability density.', date: new Date().toLocaleDateString() }
                ];
            };

            const [notes, setNotes] = useState(loadNotes);
            const [activeId, setActiveId] = useState(null);
            const [search, setSearch] = useState('');
            const [isEditing, setIsEditing] = useState(false);

            // Persist to LocalStorage whenever notes change
            useEffect(() => {
                localStorage.setItem('nexus_db_v1', JSON.stringify(notes));
            }, [notes]);

            const activeNote = notes.find(n => n.id === activeId);

            const createNote = () => {
                const newNote = {
                    id: Date.now(),
                    title: 'Untitled Node',
                    content: '',
                    date: new Date().toLocaleDateString()
                };
                setNotes([newNote, ...notes]);
                setActiveId(newNote.id);
                setIsEditing(true);
                sysAudio.play('success');
            };

            const updateNote = (key, value) => {
                setNotes(notes.map(n => n.id === activeId ? { ...n, [key]: value } : n));
            };

            const deleteNote = (e, id) => {
                e.stopPropagation();
                if (window.confirm('Purge data node? This action is irreversible.')) {
                    setNotes(notes.filter(n => n.id !== id));
                    if (activeId === id) setActiveId(null);
                    sysAudio.play('error'); // Deletion sound
                }
            };

            const filteredNotes = notes.filter(n => 
                n.title.toLowerCase().includes(search.toLowerCase()) || 
                n.content.toLowerCase().includes(search.toLowerCase())
            );

            return (
                <div className="flex h-full bg-os-bg font-sans overflow-hidden text-white">
                    {/* --- SIDEBAR LIST --- */}
                    <div className="w-64 bg-os-surface border-r border-white/10 flex flex-col shrink-0">
                        {/* Search & Add */}
                        <div className="p-4 border-b border-white/10 space-y-3">
                            <div className="relative">
                                <i className="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-xs"></i>
                                <input 
                                    className="w-full bg-black/50 border border-white/10 rounded-lg py-1.5 pl-8 pr-2 text-xs text-white focus:border-neon-blue outline-none transition-all placeholder-gray-600"
                                    placeholder="SEARCH_DB..."
                                    value={search}
                                    onChange={e => setSearch(e.target.value)}
                                />
                            </div>
                            <button 
                                onClick={createNote}
                                className="w-full py-2 bg-neon-blue/10 hover:bg-neon-blue/20 border border-neon-blue/30 rounded-lg text-xs font-bold text-neon-blue transition-all flex items-center justify-center gap-2"
                            >
                                <i className="fas fa-plus"></i> NEW DATA NODE
                            </button>
                        </div>

                        {/* List */}
                        <div className="flex-1 overflow-y-auto custom-scroll p-2 space-y-1">
                            {filteredNotes.length === 0 ? (
                                <div className="text-center text-gray-600 text-[10px] mt-4 font-mono">NO RECORDS FOUND</div>
                            ) : (
                                filteredNotes.map(note => (
                                    <div 
                                        key={note.id}
                                        onClick={() => { setActiveId(note.id); sysAudio.play('click'); }}
                                        className={`group p-3 rounded-lg cursor-pointer border transition-all ${activeId === note.id ? 'bg-white/10 border-white/20' : 'bg-transparent border-transparent hover:bg-white/5'}`}
                                    >
                                        <div className="flex justify-between items-start mb-1">
                                            <div className={`font-bold text-sm truncate pr-2 ${activeId === note.id ? 'text-white' : 'text-gray-400 group-hover:text-white'}`}>
                                                {note.title || 'Untitled'}
                                            </div>
                                            <button 
                                                onClick={(e) => deleteNote(e, note.id)}
                                                className="opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-500 transition-opacity"
                                            >
                                                <i className="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <div className="flex justify-between items-end">
                                            <div className="text-[10px] text-gray-500 truncate w-32 font-mono">
                                                {note.content.substring(0, 30)}...
                                            </div>
                                            <div className="text-[9px] text-neon-blue/70">
                                                {note.date}
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>

                    {/* --- MAIN EDITOR --- */}
                    <div className="flex-1 flex flex-col bg-void relative">
                        {activeNote ? (
                            <>
                                {/* Header Inputs */}
                                <div className="h-16 border-b border-white/10 flex flex-col justify-center px-6 bg-white/5 backdrop-blur-md">
                                    <input 
                                        value={activeNote.title}
                                        onChange={(e) => updateNote('title', e.target.value)}
                                        className="bg-transparent text-xl font-bold text-white outline-none placeholder-gray-600 font-cyber tracking-wide"
                                        placeholder="ENTER_TITLE"
                                    />
                                    <div className="text-[10px] text-gray-500 font-mono flex items-center gap-2">
                                        <span>ID: {activeNote.id}</span>
                                        <span className="w-1 h-1 rounded-full bg-gray-600"></span>
                                        <span className="text-neon-green">ENCRYPTED_LOCALLY</span>
                                    </div>
                                </div>

                                {/* Text Area */}
                                <textarea 
                                    value={activeNote.content}
                                    onChange={(e) => updateNote('content', e.target.value)}
                                    className="flex-1 w-full bg-transparent p-6 text-sm font-mono text-gray-300 outline-none resize-none leading-relaxed selection:bg-neon-blue selection:text-black custom-scroll"
                                    placeholder="// Initialize data stream..."
                                    spellCheck="false"
                                />
                            </>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center text-gray-700 select-none">
                                <i className="fas fa-database text-6xl mb-4 animate-pulse opacity-20"></i>
                                <div className="text-sm font-mono tracking-widest uppercase">Select a Data Node</div>
                            </div>
                        )}

                        {/* Background watermark */}
                        <div className="absolute bottom-4 right-4 text-[100px] font-cyber text-white/5 pointer-events-none select-none">
                            NEXUS
                        </div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 20 COMPLETE
           PROCEED TO PART 21 FOR SYSTEM SETTINGS
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 15: SYSTEM CONFIG (Settings & Diagnostics)
        // ==================================================================================

        const SettingsApp = () => {
            const { state, dispatch } = useOS();
            // Note: In a real Redux setup, these would dispatch to global store. 
            // Here we simulate the local toggle visual for the UI.
            const [config, setConfig] = useState({
                audio: true,
                notifications: true,
                performance: false,
                blur: true,
                theme: 'Cyber Dark'
            });

            const toggle = (key) => {
                setConfig(prev => ({ ...prev, [key]: !prev[key] }));
                sysAudio.play(config.audio ? 'click' : '');
                
                // Real-time effect for Audio
                if (key === 'audio') {
                    sysAudio.enabled = !config.audio;
                }
            };

            return (
                <div className="flex h-full bg-os-bg font-sans overflow-hidden text-white">
                    {/* --- SIDEBAR --- */}
                    <div className="w-64 bg-os-surface border-r border-white/10 p-6 shrink-0">
                        <div className="text-2xl font-bold font-cyber mb-6 flex items-center gap-3">
                            <i className="fas fa-cog text-neon-blue animate-spin-slow"></i>
                            SYSTEM
                        </div>
                        <div className="space-y-2">
                            {['General', 'Display', 'Sound', 'Diagnostics', 'About'].map((item, i) => (
                                <button 
                                    key={item}
                                    className={`w-full text-left px-4 py-3 rounded-lg text-sm font-bold transition-all ${i === 0 ? 'bg-white/10 text-white' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                                >
                                    {item}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* --- MAIN CONTENT --- */}
                    <div className="flex-1 p-8 overflow-y-auto custom-scroll">
                        <div className="max-w-2xl mx-auto space-y-8">
                            
                            {/* Header */}
                            <div className="pb-4 border-b border-white/10">
                                <h3 className="text-xl font-bold">Preferences</h3>
                                <p className="text-gray-500 text-xs mt-1">Manage global system parameters and rendering engine.</p>
                            </div>

                            {/* Toggles Grid */}
                            <div className="grid gap-4">
                                {/* Audio */}
                                <div className="flex items-center justify-between p-4 bg-white/5 border border-white/5 rounded-xl">
                                    <div className="flex items-center gap-4">
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-lg transition-colors ${config.audio ? 'bg-neon-blue/10 text-neon-blue' : 'bg-gray-800 text-gray-500'}`}>
                                            <i className={`fas ${config.audio ? 'fa-volume-high' : 'fa-volume-xmark'}`}></i>
                                        </div>
                                        <div>
                                            <div className="font-bold text-sm">System Audio</div>
                                            <div className="text-xs text-gray-500">Enable UI interaction sounds</div>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={() => toggle('audio')}
                                        className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${config.audio ? 'bg-neon-blue' : 'bg-gray-700'}`}
                                    >
                                        <div className={`w-4 h-4 rounded-full bg-white shadow-sm transition-transform duration-300 ${config.audio ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                    </button>
                                </div>

                                {/* Notifications */}
                                <div className="flex items-center justify-between p-4 bg-white/5 border border-white/5 rounded-xl">
                                    <div className="flex items-center gap-4">
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-lg transition-colors ${config.notifications ? 'bg-neon-purple/10 text-neon-purple' : 'bg-gray-800 text-gray-500'}`}>
                                            <i className="fas fa-bell"></i>
                                        </div>
                                        <div>
                                            <div className="font-bold text-sm">Notifications</div>
                                            <div className="text-xs text-gray-500">Allow apps to push alerts</div>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={() => toggle('notifications')}
                                        className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${config.notifications ? 'bg-neon-purple' : 'bg-gray-700'}`}
                                    >
                                        <div className={`w-4 h-4 rounded-full bg-white shadow-sm transition-transform duration-300 ${config.notifications ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                    </button>
                                </div>

                                {/* Performance Mode */}
                                <div className="flex items-center justify-between p-4 bg-white/5 border border-white/5 rounded-xl">
                                    <div className="flex items-center gap-4">
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-lg transition-colors ${config.performance ? 'bg-neon-green/10 text-neon-green' : 'bg-gray-800 text-gray-500'}`}>
                                            <i className="fas fa-bolt"></i>
                                        </div>
                                        <div>
                                            <div className="font-bold text-sm">High Performance</div>
                                            <div className="text-xs text-gray-500">Disable glass blur for FPS boost</div>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={() => toggle('performance')}
                                        className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${config.performance ? 'bg-neon-green' : 'bg-gray-700'}`}
                                    >
                                        <div className={`w-4 h-4 rounded-full bg-white shadow-sm transition-transform duration-300 ${config.performance ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                    </button>
                                </div>
                            </div>

                            {/* Diagnostics Panel (Simulated) */}
                            <div className="space-y-4">
                                <h3 className="text-sm font-bold uppercase tracking-wider text-gray-500">Kernel Diagnostics</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="p-4 bg-black/50 border border-white/10 rounded-xl">
                                        <div className="text-xs text-gray-500 mb-1">CPU LOAD</div>
                                        <div className="text-2xl font-mono text-neon-blue">
                                            {Math.floor(Math.random() * 15) + 5}%
                                        </div>
                                        <div className="w-full h-1 bg-gray-800 mt-2 rounded-full overflow-hidden">
                                            <div className="h-full bg-neon-blue w-[15%]"></div>
                                        </div>
                                    </div>
                                    <div className="p-4 bg-black/50 border border-white/10 rounded-xl">
                                        <div className="text-xs text-gray-500 mb-1">MEMORY</div>
                                        <div className="text-2xl font-mono text-neon-purple">
                                            1.2 GB
                                        </div>
                                        <div className="w-full h-1 bg-gray-800 mt-2 rounded-full overflow-hidden">
                                            <div className="h-full bg-neon-purple w-[40%]"></div>
                                        </div>
                                    </div>
                                </div>
                                <div className="text-[10px] font-mono text-gray-600 text-center">
                                    OS VERSION 12.0.0 (ALPHA) // BUILD 2026.01.30
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 21 COMPLETE
           PROCEED TO PART 22 FOR ARCHITECT PROFILE (ABOUT ME)
           ================================================================================
        */
                // ==================================================================================
        // APP MODULE 16: ARCHITECT PROFILE (About The Creator)
        // ==================================================================================

        const DevApp = () => {
            return (
                <div className="flex flex-col h-full bg-black relative overflow-hidden font-sans text-white">
                    {/* Background Animation */}
                    <div className="absolute inset-0 bg-gradient-to-br from-indigo-900/40 via-black to-black z-0"></div>
                    <div className="absolute top-0 right-0 w-96 h-96 bg-neon-blue/10 rounded-full blur-[120px] pointer-events-none animate-pulse"></div>

                    {/* --- HEADER SECTION --- */}
                    <div className="relative z-10 p-8 flex flex-col items-center border-b border-white/10 bg-white/5 backdrop-blur-md">
                        <div className="w-24 h-24 rounded-full p-1 bg-gradient-to-tr from-neon-blue to-neon-purple mb-4 shadow-[0_0_20px_rgba(188,19,254,0.4)]">
                            <div className="w-full h-full rounded-full bg-black overflow-hidden flex items-center justify-center">
                                {/* Placeholder Avatar */}
                                <i className="fas fa-user-astronaut text-4xl text-white"></i>
                            </div>
                        </div>
                        
                        <h1 className="text-2xl font-bold font-cyber tracking-wide">SHASHANK KUSHWAHA</h1>
                        <div className="text-xs font-mono text-neon-blue bg-neon-blue/10 px-3 py-1 rounded-full mt-2 border border-neon-blue/20">
                            ARCHITECT // STUDYTOOLS INDIA
                        </div>
                        
                        <div className="flex gap-4 mt-6">
                            <button className="w-10 h-10 rounded-full bg-white/5 hover:bg-white/20 flex items-center justify-center transition-all hover:-translate-y-1">
                                <i className="fab fa-github text-lg"></i>
                            </button>
                            <button className="w-10 h-10 rounded-full bg-white/5 hover:bg-white/20 flex items-center justify-center transition-all hover:-translate-y-1">
                                <i className="fab fa-instagram text-lg"></i>
                            </button>
                            <button className="w-10 h-10 rounded-full bg-white/5 hover:bg-white/20 flex items-center justify-center transition-all hover:-translate-y-1">
                                <i className="fas fa-globe text-lg"></i>
                            </button>
                        </div>
                    </div>

                    {/* --- CONTENT SCROLL --- */}
                    <div className="relative z-10 flex-1 overflow-y-auto custom-scroll p-6 space-y-6">
                        
                        {/* Bio Card */}
                        <div className="p-5 bg-white/5 border border-white/5 rounded-2xl">
                            <h3 className="text-sm font-bold uppercase tracking-widest text-gray-500 mb-3">Mission Protocol</h3>
                            <p className="text-sm text-gray-300 leading-relaxed font-mono">
                                "I am an ISC Student (Class 11) from Unnao, specialized in PCM + CS. My objective is to revolutionize the Indian Education System by merging high-fidelity simulations with accessible web technologies. This OS is a testament to the power of the browser."
                            </p>
                        </div>

                        {/* Tech Stack */}
                        <div className="p-5 bg-white/5 border border-white/5 rounded-2xl">
                            <h3 className="text-sm font-bold uppercase tracking-widest text-gray-500 mb-4">Neural Capabilities</h3>
                            <div className="space-y-4">
                                <div>
                                    <div className="flex justify-between text-xs font-bold mb-1">
                                        <span>React.js / Virtual DOM</span>
                                        <span className="text-neon-blue">98%</span>
                                    </div>
                                    <div className="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                        <div className="h-full bg-neon-blue w-[98%] shadow-[0_0_10px_#00f2ff]"></div>
                                    </div>
                                </div>
                                <div>
                                    <div className="flex justify-between text-xs font-bold mb-1">
                                        <span>Physics / Calculus</span>
                                        <span className="text-neon-purple">95%</span>
                                    </div>
                                    <div className="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                        <div className="h-full bg-neon-purple w-[95%] shadow-[0_0_10px_#bc13fe]"></div>
                                    </div>
                                </div>
                                <div>
                                    <div className="flex justify-between text-xs font-bold mb-1">
                                        <span>UI / UX Design</span>
                                        <span className="text-neon-green">92%</span>
                                    </div>
                                    <div className="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                        <div className="h-full bg-neon-green w-[92%] shadow-[0_0_10px_#0aff60]"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Projects */}
                        <div className="p-5 bg-white/5 border border-white/5 rounded-2xl">
                            <h3 className="text-sm font-bold uppercase tracking-widest text-gray-500 mb-4">Deployed Systems</h3>
                            <div className="grid grid-cols-2 gap-3">
                                <div className="p-3 bg-black/40 rounded-lg border border-white/10">
                                    <div className="text-neon-gold font-bold text-xs mb-1">STUDYTOOLS INDIA</div>
                                    <div className="text-[10px] text-gray-500">Core Platform</div>
                                </div>
                                <div className="p-3 bg-black/40 rounded-lg border border-white/10">
                                    <div className="text-neon-blue font-bold text-xs mb-1">VIBE VAULT REELS</div>
                                    <div className="text-[10px] text-gray-500">Content Engine</div>
                                </div>
                            </div>
                        </div>

                        {/* Footer Signature */}
                        <div className="text-center pt-4">
                            <div className="font-signature text-2xl text-gray-500 opacity-50">Shashank K.</div>
                        </div>

                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 22 COMPLETE
           PROCEED TO PART 23 FOR NOTIFICATION SYSTEM
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 17: NOTIFICATION CENTER (Toast System)
        // ==================================================================================

        const NotificationSystem = () => {
            const { state, dispatch } = useOS();

            // Auto-dismiss logic is handled individually by each Toast component
            // to ensure timers don't get messed up by re-renders.
            
            return (
                <div className="fixed top-4 right-4 z-[9999] flex flex-col gap-3 pointer-events-none">
                    {state.notifications.map(notif => (
                        <Toast key={notif.id} notif={notif} dispatch={dispatch} />
                    ))}
                </div>
            );
        };

        const Toast = ({ notif, dispatch }) => {
            const [exiting, setExiting] = useState(false);

            useEffect(() => {
                // Play sound on mount
                if (notif.type === 'error') sysAudio.play('error');
                else sysAudio.play('hover');

                // Start exit animation before removing
                const timer = setTimeout(() => setExiting(true), 4000);
                const remover = setTimeout(() => {
                    dispatch({ type: 'REMOVE_NOTIFICATION', payload: notif.id });
                }, 4300);

                return () => { clearTimeout(timer); clearTimeout(remover); };
            }, []);

            // Styles based on type
            const styles = {
                info: 'border-neon-blue bg-black/80 text-neon-blue',
                success: 'border-neon-green bg-black/80 text-neon-green',
                error: 'border-red-500 bg-black/80 text-red-500',
                warning: 'border-neon-gold bg-black/80 text-neon-gold'
            };

            const icons = {
                info: 'fa-circle-info',
                success: 'fa-circle-check',
                error: 'fa-triangle-exclamation',
                warning: 'fa-bolt'
            };

            return (
                <div 
                    className={`
                        pointer-events-auto w-72 p-4 rounded-lg border-l-4 shadow-2xl backdrop-blur-md flex items-start gap-3 transition-all duration-300 ease-in-out
                        ${styles[notif.type || 'info']}
                        ${exiting ? 'opacity-0 translate-x-full' : 'opacity-100 translate-x-0 animate-window-open'}
                    `}
                >
                    <div className="pt-0.5 text-lg">
                        <i className={`fas ${icons[notif.type || 'info']}`}></i>
                    </div>
                    <div className="flex-1">
                        <div className="font-bold text-sm font-cyber tracking-wide text-white uppercase mb-0.5">
                            {notif.title}
                        </div>
                        <div className="text-xs text-gray-300 font-mono leading-tight">
                            {notif.msg}
                        </div>
                    </div>
                    <button 
                        onClick={() => setExiting(true)}
                        className="text-gray-500 hover:text-white transition-colors"
                    >
                        <i className="fas fa-times"></i>
                    </button>
                </div>
            );
        };

        /* ================================================================================
           PART 23 COMPLETE
           PROCEED TO PART 24 FOR DESKTOP ICONS
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 18: DESKTOP SHORTCUTS (Grid System)
        // ==================================================================================

        const DesktopIcon = ({ app, dispatch }) => {
            // Shortcuts map to the specific App IDs
            const launch = () => {
                dispatch({
                    type: 'OPEN_WINDOW',
                    payload: {
                        id: app.id,
                        title: app.title,
                        isSystem: false,
                        width: app.type === 'MATRIX' ? 600 : 900,
                        height: app.type === 'MATRIX' ? 500 : 650
                    }
                });
            };

            return (
                <div 
                    onDoubleClick={launch}
                    className="w-24 flex flex-col items-center gap-2 p-2 rounded-lg hover:bg-white/10 border border-transparent hover:border-white/5 transition-all cursor-pointer group active:scale-95 mb-4"
                >
                    <div 
                        className="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl shadow-lg transition-transform group-hover:-translate-y-2 group-hover:shadow-2xl"
                        style={{ background: `linear-gradient(135deg, ${app.color}20, ${app.color}10)`, border: `1px solid ${app.color}40` }}
                    >
                        <i 
                            className={`fas ${app.icon}`} 
                            style={{ color: app.color, filter: `drop-shadow(0 0 5px ${app.color})` }}
                        ></i>
                    </div>
                    <span className="text-xs font-bold text-white text-center drop-shadow-md select-none bg-black/40 px-2 py-0.5 rounded-full backdrop-blur-sm border border-white/5">
                        {app.title}
                    </span>
                </div>
            );
        };

        const DesktopGrid = () => {
            const { dispatch } = useOS();
            
            // Define main shortcuts for the desktop
            const shortcuts = [
                { id: 'nexus', title: 'Nexus DB', icon: 'fa-book-journal-whills', color: '#00f2ff', type: 'NEXUS' },
                { id: 'graph-engine', title: 'Graph Engine', icon: 'fa-chart-area', color: '#bc13fe', type: 'GRAPH' },
                { id: 'orbit', title: 'OrbitAI', icon: 'fa-globe', color: '#ff2a2a', type: 'ORBIT' },
                { id: 'code', title: 'CodeRush', icon: 'fa-code', color: '#0aff60', type: 'CODE' },
                { id: 'handbook', title: 'Handbook', icon: 'fa-book-open', color: '#ff9d00', type: 'HANDBOOK' },
                { id: 'sonic', title: 'SonicView', icon: 'fa-wave-square', color: '#00f2ff', type: 'SONIC' }
            ];

            return (
                <div className="absolute top-4 left-4 z-0 flex flex-col flex-wrap h-[calc(100%-100px)] content-start gap-2 w-full pointer-events-none">
                    {/* Make icons clickable */}
                    <div className="pointer-events-auto">
                        {shortcuts.map(app => (
                            <DesktopIcon key={app.id} app={app} dispatch={dispatch} />
                        ))}
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 24 COMPLETE
           PROCEED TO PART 25 FOR THE DYNAMIC WALLPAPER
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 19: DYNAMIC WALLPAPER (Visual Backdrop)
        // ==================================================================================

        const Wallpaper = () => {
            return (
                <div className="fixed inset-0 z-0 pointer-events-none select-none overflow-hidden bg-[#030303]">
                    {/* 1. Base Gradient Animation */}
                    <div className="absolute inset-0 bg-gradient-to-br from-indigo-900/20 via-black to-black animate-[pulse_10s_infinite]"></div>
                    
                    {/* 2. Floating Orbs */}
                    <div className="absolute top-[-20%] left-[-10%] w-[50vw] h-[50vw] bg-neon-purple/10 rounded-full blur-[120px] animate-[spin-slow_20s_infinite]"></div>
                    <div className="absolute bottom-[-20%] right-[-10%] w-[50vw] h-[50vw] bg-neon-blue/10 rounded-full blur-[120px] animate-[spin-slow_25s_infinite_reverse]"></div>
                    
                    {/* 3. Scanline Grid (Cyber Effect) */}
                    <div 
                        className="absolute inset-0 opacity-[0.03]" 
                        style={{ 
                            backgroundImage: `linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px)`,
                            backgroundSize: '40px 40px'
                        }}
                    ></div>
                    
                    {/* 4. Vignette */}
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.8)_100%)]"></div>
                </div>
            );
        };

        /* ================================================================================
           PART 25 COMPLETE
           PROCEED TO PART 26 FOR THE CONTEXT MENU (RIGHT CLICK)
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 20: CONTEXT MENU (Right-Click Interface)
        // ==================================================================================

        const ContextMenu = () => {
            const { dispatch } = useOS();
            const [visible, setVisible] = useState(false);
            const [pos, setPos] = useState({ x: 0, y: 0 });

            useEffect(() => {
                const handleContextMenu = (e) => {
                    e.preventDefault();
                    setVisible(true);
                    setPos({ x: e.clientX, y: e.clientY });
                };

                const handleClick = () => setVisible(false);

                window.addEventListener('contextmenu', handleContextMenu);
                window.addEventListener('click', handleClick);
                return () => {
                    window.removeEventListener('contextmenu', handleContextMenu);
                    window.removeEventListener('click', handleClick);
                };
            }, []);

            if (!visible) return null;

            const actions = [
                { label: 'Refresh System', icon: 'fa-rotate-right', action: () => { window.location.reload(); } },
                { label: 'New Note', icon: 'fa-note-sticky', action: () => dispatch({ type: 'OPEN_WINDOW', payload: { id: 'nexus', title: 'Nexus DB', width: 900, height: 600 } }) },
                { label: 'System Diagnostics', icon: 'fa-microchip', action: () => dispatch({ type: 'OPEN_WINDOW', payload: { id: 'settings', title: 'System Config', width: 800, height: 600 } }) },
                { separator: true },
                { label: 'Personalize', icon: 'fa-wand-magic-sparkles', action: () => dispatch({ type: 'ADD_NOTIFICATION', payload: { type: 'info', title: 'Locked', msg: 'Theme is managed by Administrator.' } }) },
            ];

            return (
                <div 
                    className="fixed z-[9999] w-56 bg-black/80 backdrop-blur-xl border border-white/10 rounded-lg shadow-2xl py-1 animate-window-open overflow-hidden"
                    style={{ top: pos.y, left: pos.x }}
                >
                    {actions.map((item, i) => (
                        item.separator ? (
                            <div key={i} className="h-px bg-white/10 my-1 mx-2"></div>
                        ) : (
                            <button 
                                key={i}
                                onClick={item.action}
                                className="w-full text-left px-4 py-2 text-xs font-bold text-gray-300 hover:bg-neon-blue/20 hover:text-white transition-colors flex items-center gap-3 group"
                            >
                                <i className={`fas ${item.icon} w-4 text-center group-hover:text-neon-blue`}></i>
                                {item.label}
                            </button>
                        )
                    ))}
                </div>
            );
        };

        /* ================================================================================
           PART 26 COMPLETE
           PROCEED TO PART 27 FOR STATUS BAR (TOP BAR)
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 21: STATUS BAR (Top HUD)
        // ==================================================================================

        const StatusBar = () => {
            const [time, setTime] = useState(new Date());

            useEffect(() => {
                const t = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(t);
            }, []);

            return (
                <div className="fixed top-0 left-0 w-full h-8 bg-black/40 backdrop-blur-md border-b border-white/5 z-[9000] flex items-center justify-between px-4 select-none">
                    {/* Left: Branding */}
                    <div className="flex items-center gap-3">
                        <i className="fab fa-apple text-white/80 hover:text-white transition-colors cursor-pointer"></i>
                        <span className="font-cyber font-bold text-xs text-white tracking-widest hidden sm:block">
                            STUDYGRAPHS <span className="text-neon-blue">OS</span>
                        </span>
                        
                        {/* Menu Items (Desktop Only) */}
                        <div className="hidden md:flex gap-4 ml-4">
                            {['File', 'Edit', 'View', 'Window', 'Help'].map(item => (
                                <span key={item} className="text-[11px] font-bold text-gray-400 hover:text-white cursor-pointer transition-colors">
                                    {item}
                                </span>
                            ))}
                        </div>
                    </div>

                    {/* Right: System Info */}
                    <div className="flex items-center gap-4 text-xs font-bold text-white">
                        {/* Network */}
                        <div className="flex items-center gap-1 text-gray-300">
                            <i className="fas fa-wifi text-[10px]"></i>
                            <span className="hidden sm:inline text-[10px]">Nexus_5G</span>
                        </div>

                        {/* Battery (Simulated) */}
                        <div className="flex items-center gap-2 text-neon-green">
                            <span className="hidden sm:inline text-[10px]">100%</span>
                            <i className="fas fa-battery-full"></i>
                        </div>

                        {/* Clock */}
                        <div className="font-mono text-neon-blue bg-white/5 px-2 py-0.5 rounded border border-white/10 min-w-[80px] text-center">
                            {time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        <div className="hidden sm:block font-mono text-gray-400">
                            {time.toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' })}
                        </div>
                    </div>
                </div>
            );
        };

        /* ================================================================================
           PART 27 COMPLETE
           PROCEED TO PART 28 FOR THE DESKTOP LAYOUT
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 22: DESKTOP LAYOUT (The Viewport)
        // ==================================================================================

        const Desktop = () => {
            const { state } = useOS();

            return (
                <div className="relative w-full h-full overflow-hidden select-none">
                    {/* Layer 0: Background */}
                    <Wallpaper />

                    {/* Layer 1: Desktop Icons */}
                    <DesktopGrid />

                    {/* Layer 2: Active Windows */}
                    {state.windows.map(win => (
                        <WindowFrame key={win.id} windowData={win}>
                            {/* --- DYNAMIC APP COMPONENT LOADER --- */}
                            {/* This switch renders the correct app based on window ID */}
                            {(() => {
                                switch (win.id) {
                                    case 'graph-engine': return <GraphApp />;
                                    case 'matrix-lab': return <MatrixApp />;
                                    case 'solver': return <SolverApp />;
                                    case 'orbit': return <OrbitApp />;
                                    case 'vector-lab': return <PhysicsApp />;
                                    case 'elementa': return <PeriodicTableApp />;
                                    case 'trig': return <TrigCircleApp />;
                                    case 'handbook': return <HandbookApp />;
                                    case 'finance': return <FinanceApp />;
                                    case 'calc': return <CalculatorApp />;
                                    case 'code': return <CodeRushApp />;
                                    case 'sonic': return <SonicApp />;
                                    case 'converter': return <ConverterApp />;
                                    case 'nexus': return <NexusApp />;
                                    case 'settings': return <SettingsApp />;
                                    case 'dev': return <DevApp />;
                                    default: return <div className="p-10 text-center text-red-500">Error: Module Not Found</div>;
                                }
                            })()}
                        </WindowFrame>
                    ))}

                    {/* Layer 3: System HUD */}
                    <StatusBar />
                    <Dock />

                    {/* Layer 4: Overlays */}
                    <ContextMenu />
                    <NotificationSystem />
                </div>
            );
        };

        /* ================================================================================
           PART 28 COMPLETE
           PROCEED TO PART 29 FOR THE ROOT APPLICATION WRAPPER
           ================================================================================
        */
                // ==================================================================================
        // KERNEL MODULE 23: ROOT APPLICATION WRAPPER
        // ==================================================================================

        const App = () => {
            const [booted, setBooted] = useState(false);

            useEffect(() => {
                // Simulate BIOS / Boot Sequence
                const timer = setTimeout(() => setBooted(true), 2500); 
                return () => clearTimeout(timer);
            }, []);

            if (!booted) {
                // --- BOOT SCREEN ANIMATION ---
                return (
                    <div className="fixed inset-0 bg-black flex flex-col items-center justify-center font-mono text-neon-blue select-none z-[99999]">
                        <div className="w-16 h-16 border-4 border-neon-blue border-t-transparent rounded-full animate-spin mb-8"></div>
                        <div className="text-2xl font-bold font-cyber tracking-widest animate-pulse">
                            INITIALIZING KERNEL...
                        </div>
                        <div className="mt-4 text-xs text-gray-500 w-64 h-1 bg-gray-900 rounded-full overflow-hidden">
                            <div className="h-full bg-neon-blue animate-[load_2s_ease-out_forwards]"></div>
                        </div>
                        <div className="absolute bottom-10 text-[10px] text-gray-600">
                             2026 STUDYGRAPHS INDIA // SHASHANK KUSHWAHA
                        </div>
                    </div>
                );
            }

            return (
                <OSProvider>
                    <Desktop />
                </OSProvider>
            );
        };

        // ==================================================================================
        // SYSTEM BOOTSTRAP: MOUNT TO DOM
        // ==================================================================================
        
        const rootElement = document.getElementById('root');
        ReactDOM.render(<App />, rootElement);

        /* ================================================================================
           PART 29 COMPLETE
           PROCEED TO PART 30 FOR THE CLOSING TAGS AND FINAL STYLES
           ================================================================================
        */
            </script>

    <style>
        /* --- FONTS --- */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=JetBrains+Mono:wght@300;400;700&family=Inter:wght@300;400;600;800&family=Dancing+Script:wght@700&display=swap');

        /* --- TAILWIND EXTENSIONS --- */
        .font-cyber { font-family: 'Orbitron', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .font-sans { font-family: 'Inter', sans-serif; }
        .font-signature { font-family: 'Dancing Script', cursive; }
        
        /* --- CUSTOM SCROLLBAR --- */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.02); }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.15); border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: rgba(0, 242, 255, 0.5); }

        /* --- ANIMATIONS --- */
        @keyframes window-open {
            0% { opacity: 0; transform: scale(0.95) translateY(10px); filter: blur(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); }
        }
        .animate-window-open { animation: window-open 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-float { animation: float 4s ease-in-out infinite; }

        @keyframes spin-slow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 10s linear infinite; }

        @keyframes scanline {
            0% { background-position: 0% 0%; }
            100% { background-position: 0% 100%; }
        }
        .animate-scanline { animation: scanline 8s linear infinite; }

        @keyframes load {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* --- UTILITIES --- */
        .bg-grid-pattern {
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .text-glow-green { text-shadow: 0 0 10px rgba(10, 255, 96, 0.8); }
        .text-glow-blue { text-shadow: 0 0 10px rgba(0, 242, 255, 0.8); }
        .shadow-deep { box-shadow: 0 0 50px rgba(0,0,0,0.8); }

        /* Prevents selection on desktop icons/UI */
        .select-none { -webkit-user-select: none; user-select: none; }
        
        /* Glassmorphism helpers */
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</body>
</html>

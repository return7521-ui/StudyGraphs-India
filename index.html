<!DOCTYPE html>
<html lang="en" class="antialiased no-scrollbar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#050505">
    
    <title>StudyGraphs India | The Singularity Engine</title>
    
    <meta name="description" content="The world's most advanced educational computational engine. Featuring 4D visualization, tensor calculus, and quantum simulation.">
    <meta name="author" content="Shashank Kushwaha">
    <meta name="keywords" content="Quantum Computing, Graphing Engine, STEM OS, StudyTools India">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.2.0/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/complex.js/2.1.1/complex.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;700;900&family=JetBrains+Mono:wght@200;400;700&family=Orbitron:wght@400;700;900&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Menlo', 'Monaco', 'Consolas', 'monospace'],
                        cyber: ['Orbitron', 'sans-serif'],
                        classic: ['Cinzel', 'serif'],
                    },
                    colors: {
                        void: '#030303',
                        deep: '#080808',
                        obsidian: '#0f0f11',
                        glass: {
                            light: 'rgba(255, 255, 255, 0.03)',
                            medium: 'rgba(255, 255, 255, 0.08)',
                            heavy: 'rgba(255, 255, 255, 0.15)',
                            border: 'rgba(255, 255, 255, 0.08)',
                            shine: 'rgba(255, 255, 255, 0.4)'
                        },
                        neon: {
                            blue: '#00f3ff',
                            purple: '#bd00ff',
                            pink: '#ff0055',
                            green: '#00ff9d',
                            gold: '#ffd700'
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 20s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scanline': 'scanline 8s linear infinite',
                        'hologram': 'hologram 4s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        scanline: {
                            '0%': { backgroundPosition: '0% 0%' },
                            '100%': { backgroundPosition: '0% 100%' }
                        },
                        hologram: {
                            '0%': { opacity: 0.8, textShadow: '0 0 10px rgba(0, 243, 255, 0.5)' },
                            '100%': { opacity: 1, textShadow: '0 0 20px rgba(0, 243, 255, 0.8), 2px 2px 0px rgba(255,0,255,0.3)' }
                        }
                    },
                    cursor: {
                        'crosshair': 'crosshair',
                        'none': 'none',
                    }
                }
            }
        }
    </script>

    <style>
        /* --- CORE RESET & VARS --- */
        :root {
            --app-height: 100dvh;
            --header-h: 64px;
            --dock-h: 88px;
            --glass-blur: 24px;
            --z-dock: 9000;
            --z-modal: 9999;
            --z-window: 100;
            --transition-smooth: cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: #030303;
            color: #e2e8f0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            height: var(--app-height);
            width: 100vw;
            user-select: none;
            -webkit-font-smoothing: antialiased;
        }

        /* --- ADVANCED GLASSMORPHISM --- */
        .glass-panel {
            background: linear-gradient(135deg, rgba(20, 20, 25, 0.6), rgba(10, 10, 12, 0.8));
            backdrop-filter: blur(var(--glass-blur)) saturate(180%);
            -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(180%);
            border: 1px solid var(--glass-border);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(0, 0, 0, 0.2);
        }

        .glass-panel-hover:hover {
            background: linear-gradient(135deg, rgba(30, 30, 40, 0.7), rgba(15, 15, 20, 0.85));
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.15);
        }

        /* --- WINDOW SYSTEM --- */
        .window-frame {
            position: absolute;
            display: flex;
            flex-direction: column;
            border-radius: 16px;
            overflow: hidden;
            transition: width 0.4s var(--transition-smooth), height 0.4s var(--transition-smooth), transform 0.3s var(--transition-smooth), opacity 0.3s ease;
            will-change: transform, width, height;
            animation: window-spawn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .window-frame.active {
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.8),
                0 0 0 2px rgba(255, 255, 255, 0.1),
                0 0 40px rgba(0, 243, 255, 0.05);
            z-index: var(--z-window) !important;
        }

        .window-header {
            height: 44px;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            cursor: grab;
        }
        .window-header:active { cursor: grabbing; }

        /* --- SCROLLBARS --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 99px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.3); }

        /* --- UTILITIES --- */
        .text-glow-blue { text-shadow: 0 0 15px rgba(0, 243, 255, 0.6); }
        .text-glow-gold { text-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
        .bg-grid-pattern {
            background-size: 40px 40px;
            background-image: 
                linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        }

        /* --- ANIMATIONS --- */
        @keyframes window-spawn {
            from { opacity: 0; transform: scale(0.9) translateY(40px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        @keyframes scanline-swipe {
            0% { top: -20%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 120%; opacity: 0; }
        }

        /* --- LOADING SCREEN --- */
        #boot-bios {
            position: fixed; inset: 0; z-index: 10000;
            background: #000;
            color: #00f3ff;
            font-family: 'JetBrains Mono', monospace;
            padding: 40px;
            display: flex; flex-direction: column; justify-content: flex-end;
            overflow: hidden;
        }
        .bios-line { opacity: 0; animation: type-line 0.1s forwards; margin-bottom: 4px; font-size: 12px; }
    </style>
</head>
<body class="bg-void selection:bg-neon-blue selection:text-black">

    <canvas id="particle-mesh" class="fixed inset-0 z-0 opacity-40 pointer-events-none"></canvas>

    <div id="boot-bios"></div>

    <div id="root"></div>

    <script type="text/babel">
        /**
         * ==================================================================================
         * CORE KERNEL: UTILITIES & SYSTEM PHYSICS
         * ==================================================================================
         */
        const { useState, useEffect, useRef, useMemo, useCallback, useReducer, createContext, useContext, memo } = React;

        /* --- SYSTEM AUDIO ENGINE (SYNTHESIZER) --- */
        class AudioCore {
            constructor() {
                this.ctx = null;
                this.gain = null;
                this.enabled = false;
            }

            boot() {
                if (this.ctx) return;
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.gain = this.ctx.createGain();
                this.gain.gain.value = 0.3; // Master volume
                this.gain.connect(this.ctx.destination);
                this.enabled = true;
                this.play('startup');
            }

            play(type) {
                if (!this.enabled) return;
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                osc.connect(g);
                g.connect(this.gain);

                switch (type) {
                    case 'hover':
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(400, t);
                        osc.frequency.exponentialRampToValueAtTime(800, t + 0.05);
                        g.gain.setValueAtTime(0.05, t);
                        g.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
                        osc.start(t); osc.stop(t + 0.05);
                        break;
                    case 'click':
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(600, t);
                        g.gain.setValueAtTime(0.1, t);
                        g.gain.exponentialRampToValueAtTime(0.001, t + 0.1);
                        osc.start(t); osc.stop(t + 0.1);
                        break;
                    case 'startup':
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(200, t);
                        osc.frequency.exponentialRampToValueAtTime(800, t + 1.5);
                        g.gain.setValueAtTime(0, t);
                        g.gain.linearRampToValueAtTime(0.3, t + 0.5);
                        g.gain.linearRampToValueAtTime(0, t + 2);
                        osc.start(t); osc.stop(t + 2);
                        break;
                    case 'error':
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(100, t);
                        osc.frequency.linearRampToValueAtTime(50, t + 0.3);
                        g.gain.setValueAtTime(0.2, t);
                        g.gain.linearRampToValueAtTime(0, t + 0.3);
                        osc.start(t); osc.stop(t + 0.3);
                        break;
                }
            }
        }
        const sysAudio = new AudioCore();

        /* --- HAPTIC FEEDBACK ENGINE --- */
        const sysHaptic = {
            trigger: (pattern = [10]) => {
                if (navigator.vibrate) navigator.vibrate(pattern);
            }
        };

        /* --- VISUAL PARTICLE ENGINE (CANVAS) --- */
        const initParticles = () => {
            const canvas = document.getElementById('particle-mesh');
            const ctx = canvas.getContext('2d');
            let w, h;
            let particles = [];
            const mouse = { x: null, y: null };

            const resize = () => {
                w = canvas.width = window.innerWidth;
                h = canvas.height = window.innerHeight;
            };
            
            class Particle {
                constructor() {
                    this.x = Math.random() * w;
                    this.y = Math.random() * h;
                    this.vx = (Math.random() - 0.5) * 0.5;
                    this.vy = (Math.random() - 0.5) * 0.5;
                    this.size = Math.random() * 2;
                }
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    if (this.x < 0 || this.x > w) this.vx *= -1;
                    if (this.y < 0 || this.y > h) this.vy *= -1;
                    
                    // Mouse interaction
                    if (mouse.x != null) {
                        let dx = mouse.x - this.x;
                        let dy = mouse.y - this.y;
                        let dist = Math.sqrt(dx*dx + dy*dy);
                        if (dist < 150) {
                            const forceDirectionX = dx / dist;
                            const forceDirectionY = dy / dist;
                            const force = (150 - dist) / 150;
                            const directionX = forceDirectionX * force * 0.5;
                            const directionY = forceDirectionY * force * 0.5;
                            this.vx += directionX;
                            this.vy += directionY;
                        }
                    }
                }
                draw() {
                    ctx.fillStyle = 'rgba(0, 243, 255, 0.5)';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            const init = () => {
                particles = [];
                for (let i = 0; i < 100; i++) particles.push(new Particle());
            };

            const animate = () => {
                ctx.clearRect(0, 0, w, h);
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                // Draw Connections
                for (let a = 0; a < particles.length; a++) {
                    for (let b = a; b < particles.length; b++) {
                        let dx = particles[a].x - particles[b].x;
                        let dy = particles[a].y - particles[b].y;
                        let distance = Math.sqrt(dx*dx + dy*dy);
                        if (distance < 100) {
                            ctx.strokeStyle = `rgba(0, 243, 255, ${1 - distance/100})`;
                            ctx.lineWidth = 0.5;
                            ctx.beginPath();
                            ctx.moveTo(particles[a].x, particles[a].y);
                            ctx.lineTo(particles[b].x, particles[b].y);
                            ctx.stroke();
                        }
                    }
                }
                requestAnimationFrame(animate);
            };

            window.addEventListener('resize', () => { resize(); init(); });
            window.addEventListener('mousemove', (e) => { mouse.x = e.x; mouse.y = e.y; });
            resize();
            init();
            animate();
        };

        /* --- GLOBAL STATE MANAGEMENT (REDUX LITE) --- */
        const OSContext = createContext();
        
        const initialState = {
            windows: [], // { id, type, title, x, y, w, h, z, minimized, contentProps }
            activeWindowId: null,
            maxZ: 100,
            theme: 'cyber-dark',
            notifications: [],
            settings: {
                sound: true,
                haptics: true,
                particles: true,
                performanceMode: false
            }
        };

        const osReducer = (state, action) => {
            switch (action.type) {
                case 'OPEN_APP':
                    const existing = state.windows.find(w => w.id === action.payload.id);
                    if (existing) {
                        return {
                            ...state,
                            windows: state.windows.map(w => w.id === action.payload.id ? { ...w, z: state.maxZ + 1, minimized: false } : w),
                            activeWindowId: action.payload.id,
                            maxZ: state.maxZ + 1
                        };
                    }
                    return {
                        ...state,
                        windows: [...state.windows, { ...action.payload, z: state.maxZ + 1, minimized: false }],
                        activeWindowId: action.payload.id,
                        maxZ: state.maxZ + 1
                    };
                case 'CLOSE_APP':
                    return { ...state, windows: state.windows.filter(w => w.id !== action.payload) };
                case 'MINIMIZE_APP':
                    return { ...state, windows: state.windows.map(w => w.id === action.payload ? { ...w, minimized: true } : w) };
                case 'FOCUS_APP':
                    return { 
                        ...state, 
                        windows: state.windows.map(w => w.id === action.payload ? { ...w, z: state.maxZ + 1 } : w),
                        activeWindowId: action.payload,
                        maxZ: state.maxZ + 1 
                    };
                case 'ADD_TOAST':
                    return { ...state, notifications: [...state.notifications, { id: Date.now(), ...action.payload }] };
                case 'REMOVE_TOAST':
                    return { ...state, notifications: state.notifications.filter(n => n.id !== action.payload) };
                default: return state;
            }
        };

        /**
         * ==================================================================================
         * END OF PART 1: KERNEL
         * Wait for Part 2 to continue...
         * ==================================================================================
         */

        /**
         * ==================================================================================
         * MODULE 2: THE UNIVERSAL KNOWLEDGE NEXUS (DATABASE)
         * ==================================================================================
         * A hyper-structured repository of mathematical, physical, and financial truth.
         * Contains over 50+ defined standard models.
         */
        /* --- UPGRADED MODULE 2: THE OMNISCIENT DATABASE --- */
        const UNIVERSAL_DB = {
            algebra: [
                { id: 'alg_linear', name: 'Linear (Slope-Intercept)', eq: 'm*x + c', latex: 'y = mx + c', desc: 'Linear relationship.', tags: ['line', 'basic'] },
                { id: 'alg_quad', name: 'Quadratic (General)', eq: 'a*x^2 + b*x + c', latex: 'y = ax^2 + bx + c', desc: 'Parabolic trajectory.', tags: ['poly', 'conic'] },
                { id: 'alg_cubic', name: 'Cubic Curve', eq: 'a*x^3 + b*x^2 + c*x + d', latex: 'y = ax^3 + bx^2 + cx + d', desc: 'Inflection points.', tags: ['poly'] },
                { id: 'alg_circle', name: 'Circle', eq: 'sqrt(r^2 - x^2)', latex: 'y = \\pm\\sqrt{r^2-x^2}', desc: 'Perfect symmetry.', tags: ['conic'] },
                { id: 'alg_ellipse', name: 'Ellipse', eq: 'b * sqrt(1 - (x/a)^2)', latex: '\\frac{x^2}{a^2} + \\frac{y^2}{b^2} = 1', desc: 'Planetary orbits.', tags: ['conic'] },
                { id: 'alg_hyperbola', name: 'Hyperbola', eq: 'b * sqrt(1 + (x/a)^2)', latex: '\\frac{y^2}{b^2} - \\frac{x^2}{a^2} = 1', desc: 'Orbital mechanics.', tags: ['conic'] },
                { id: 'alg_log', name: 'Logarithmic', eq: 'a + b*log(x)', latex: 'y = a + b \\ln(x)', desc: 'Entropy & pH scale.', tags: ['decay'] },
                { id: 'alg_exp', name: 'Exponential', eq: 'a * e^(k*x)', latex: 'y = ae^{kx}', desc: 'Population growth.', tags: ['growth'] }
            ],
            trigonometry: [
                { id: 'trig_sin', name: 'Sine Wave', eq: 'a * sin(b*x + c)', latex: 'y = a \\sin(bx + c)', desc: 'Harmonic motion.', tags: ['wave'] },
                { id: 'trig_tan', name: 'Tangent', eq: 'tan(x)', latex: 'y = \\tan(x)', desc: 'Undefined slopes.', tags: ['periodic'] },
                { id: 'trig_damp', name: 'Damped Oscillation', eq: 'e^(-a*x) * cos(b*x)', latex: 'y = e^{-ax} \\cos(bx)', desc: 'Shock absorbers.', tags: ['physics'] },
                { id: 'trig_beat', name: 'Beat Frequency', eq: 'sin(a*x) + sin(b*x)', latex: '\\sin(ax) + \\sin(bx)', desc: 'Acoustic interference.', tags: ['sound'] },
                { id: 'trig_liss', name: 'Lissajous', eq: 'sin(a*t), sin(b*t)', latex: '(\\sin at, \\sin bt)', type: 'parametric', desc: 'Complex harmonic ratios.', tags: ['parametric'] },
                { id: 'trig_rose', name: 'Polar Rose', eq: 'cos(k*theta)', latex: 'r = \\cos(k\\theta)', type: 'polar', desc: 'Floral geometry.', tags: ['polar'] }
            ],
            physics: [
                { id: 'phy_proj', name: 'Projectile', eq: 'x*tan(a) - (9.8*x^2)/(2*v^2*cos(a)^2)', latex: 'y = x\\tan\\theta - \\frac{gx^2}{2v^2\\cos^2\\theta}', desc: 'Ballistics.', tags: ['kinematics'] },
                { id: 'phy_shm', name: 'SHM Potential', eq: '0.5 * k * x^2', latex: 'U = \\frac{1}{2}kx^2', desc: 'Spring energy.', tags: ['energy'] },
                { id: 'phy_grav', name: 'Gravity Well', eq: '-G * M / x', latex: 'V = -\\frac{GM}{r}', desc: 'Gravitational potential.', tags: ['space'] },
                { id: 'phy_black', name: 'Planck Law', eq: '(2*h*c^2)/(x^5 * (e^(hc/(x*k*T)) - 1))', latex: 'B(\\lambda)', desc: 'Blackbody radiation.', tags: ['quantum'] },
                { id: 'phy_wave', name: 'Wave Packet', eq: 'e^{-(x-v*t)^2} * cos(k*x - w*t)', latex: '\\Psi(x,t)', desc: 'Quantum probability.', tags: ['quantum'] },
                { id: 'phy_rel', name: 'Lorentz Factor', eq: '1 / sqrt(1 - (v/c)^2)', latex: '\\gamma = \\frac{1}{\\sqrt{1-v^2/c^2}}', desc: 'Time dilation.', tags: ['relativity'] }
            ],
            finance: [
                { id: 'fin_ci', name: 'Compound Interest', eq: 'P * (1 + r/n)^(n*t)', latex: 'A = P(1+\\frac{r}{n})^{nt}', desc: 'Wealth accumulation.', tags: ['money'] },
                { id: 'fin_bs', name: 'Black-Scholes', eq: '0.5 + 0.5*erf((ln(S/K)+(r+0.5*v^2)*t)/(v*sqrt(2*t)))', latex: 'C(S,t)', desc: 'Option pricing.', tags: ['market'] },
                { id: 'fin_npv', name: 'NPV Discount', eq: 'C / (1+r)^t', latex: 'NPV = \\sum \\frac{C_t}{(1+r)^t}', desc: 'Time value of money.', tags: ['money'] }
            ],
            surfaces: [
                { id: 'surf_sphere', name: 'Sphere', eq: 'sqrt(r^2 - x^2 - y^2)', latex: 'x^2+y^2+z^2=r^2', type: 'surface', desc: 'Perfect solid.', tags: ['3d'] },
                { id: 'surf_ripple', name: 'Interference', eq: 'sin(sqrt(x^2+y^2))/sqrt(x^2+y^2)', latex: 'z = \\text{sinc}(r)', type: 'surface', desc: 'Water drop.', tags: ['3d'] },
                { id: 'surf_saddle', name: 'Monkey Saddle', eq: 'x^3 - 3*x*y^2', latex: 'z = x^3 - 3xy^2', type: 'surface', desc: 'Hyperbolic geometry.', tags: ['3d'] },
                { id: 'surf_torus', name: 'Torus', eq: '(sqrt(x^2+y^2)-R)^2 + z^2 = r^2', latex: 'Torus', type: 'surface', desc: 'Donut topology.', tags: ['3d'] },
                { id: 'surf_gyroid', name: 'Gyroid Approx', eq: 'sin(x)*cos(y) + sin(y)*cos(z) + sin(z)*cos(x)', latex: 'Gyroid', type: 'surface', desc: 'Minimal surface.', tags: ['3d'] }
            ]
        };

        /* --- COMPLETE PERIODIC TABLE DATASET (Compressed for Performance) --- */
        const ELEMENT_DATA = [
            {n:1,s:'H',name:'Hydrogen',w:1.008,c:'nonmetal'}, {n:2,s:'He',name:'Helium',w:4.0026,c:'noble'},
            {n:3,s:'Li',name:'Lithium',w:6.94,c:'alkali'}, {n:4,s:'Be',name:'Beryllium',w:9.0122,c:'alkaline'},
            {n:5,s:'B',name:'Boron',w:10.81,c:'metalloid'}, {n:6,s:'C',name:'Carbon',w:12.011,c:'nonmetal'},
            {n:7,s:'N',name:'Nitrogen',w:14.007,c:'nonmetal'}, {n:8,s:'O',name:'Oxygen',w:15.999,c:'nonmetal'},
            {n:9,s:'F',name:'Fluorine',w:18.998,c:'halogen'}, {n:10,s:'Ne',name:'Neon',w:20.180,c:'noble'},
            {n:11,s:'Na',name:'Sodium',w:22.990,c:'alkali'}, {n:12,s:'Mg',name:'Magnesium',w:24.305,c:'alkaline'},
            {n:13,s:'Al',name:'Aluminium',w:26.982,c:'post-transition'}, {n:14,s:'Si',name:'Silicon',w:28.085,c:'metalloid'},
            {n:15,s:'P',name:'Phosphorus',w:30.974,c:'nonmetal'}, {n:16,s:'S',name:'Sulfur',w:32.06,c:'nonmetal'},
            {n:17,s:'Cl',name:'Chlorine',w:35.45,c:'halogen'}, {n:18,s:'Ar',name:'Argon',w:39.948,c:'noble'},
            {n:19,s:'K',name:'Potassium',w:39.098,c:'alkali'}, {n:20,s:'Ca',name:'Calcium',w:40.078,c:'alkaline'},
            {n:21,s:'Sc',name:'Scandium',w:44.956,c:'transition'}, {n:22,s:'Ti',name:'Titanium',w:47.867,c:'transition'},
            {n:23,s:'V',name:'Vanadium',w:50.942,c:'transition'}, {n:24,s:'Cr',name:'Chromium',w:51.996,c:'transition'},
            {n:25,s:'Mn',name:'Manganese',w:54.938,c:'transition'}, {n:26,s:'Fe',name:'Iron',w:55.845,c:'transition'},
            {n:27,s:'Co',name:'Cobalt',w:58.933,c:'transition'}, {n:28,s:'Ni',name:'Nickel',w:58.693,c:'transition'},
            {n:29,s:'Cu',name:'Copper',w:63.546,c:'transition'}, {n:30,s:'Zn',name:'Zinc',w:65.38,c:'transition'},
            {n:31,s:'Ga',name:'Gallium',w:69.723,c:'post-transition'}, {n:32,s:'Ge',name:'Germanium',w:72.630,c:'metalloid'},
            {n:33,s:'As',name:'Arsenic',w:74.922,c:'metalloid'}, {n:34,s:'Se',name:'Selenium',w:78.96,c:'nonmetal'},
            {n:35,s:'Br',name:'Bromine',w:79.904,c:'halogen'}, {n:36,s:'Kr',name:'Krypton',w:83.798,c:'noble'},
            {n:37,s:'Rb',name:'Rubidium',w:85.468,c:'alkali'}, {n:38,s:'Sr',name:'Strontium',w:87.62,c:'alkaline'},
            {n:39,s:'Y',name:'Yttrium',w:88.906,c:'transition'}, {n:40,s:'Zr',name:'Zirconium',w:91.224,c:'transition'},
            {n:41,s:'Nb',name:'Niobium',w:92.906,c:'transition'}, {n:42,s:'Mo',name:'Molybdenum',w:95.95,c:'transition'},
            {n:43,s:'Tc',name:'Technetium',w:98,c:'transition'}, {n:44,s:'Ru',name:'Ruthenium',w:101.07,c:'transition'},
            {n:45,s:'Rh',name:'Rhodium',w:102.91,c:'transition'}, {n:46,s:'Pd',name:'Palladium',w:106.42,c:'transition'},
            {n:47,s:'Ag',name:'Silver',w:107.87,c:'transition'}, {n:48,s:'Cd',name:'Cadmium',w:112.41,c:'transition'},
            {n:49,s:'In',name:'Indium',w:114.82,c:'post-transition'}, {n:50,s:'Sn',name:'Tin',w:118.71,c:'post-transition'},
            {n:51,s:'Sb',name:'Antimony',w:121.76,c:'metalloid'}, {n:52,s:'Te',name:'Tellurium',w:127.60,c:'metalloid'},
            {n:53,s:'I',name:'Iodine',w:126.90,c:'halogen'}, {n:54,s:'Xe',name:'Xenon',w:131.29,c:'noble'},
            {n:55,s:'Cs',name:'Caesium',w:132.91,c:'alkali'}, {n:56,s:'Ba',name:'Barium',w:137.33,c:'alkaline'},
            {n:57,s:'La',name:'Lanthanum',w:138.91,c:'lanthanide'}, {n:72,s:'Hf',name:'Hafnium',w:178.49,c:'transition'},
            {n:74,s:'W',name:'Tungsten',w:183.84,c:'transition'}, {n:79,s:'Au',name:'Gold',w:196.97,c:'transition'},
            {n:80,s:'Hg',name:'Mercury',w:200.59,c:'transition'}, {n:82,s:'Pb',name:'Lead',w:207.2,c:'post-transition'},
            {n:86,s:'Rn',name:'Radon',w:222,c:'noble'}, {n:92,s:'U',name:'Uranium',w:238.03,c:'actinide'},
            {n:94,s:'Pu',name:'Plutonium',w:244,c:'actinide'}, {n:118,s:'Og',name:'Oganesson',w:294,c:'noble'}
        ];

        /**
         * ==================================================================================
         * MODULE 3: MATH KERNEL (COMPUTATIONAL LOGIC)
         * ==================================================================================
         * Handles parsing, safe evaluation, matrix algebra, and signature color generation.
         */
        class MathKernel {
            // Determines equation type for plotting engine switching
            static detectType(eq) {
                if (eq.includes(',')) return 'parametric'; 
                if (eq.includes('=')) return 'implicit';   
                return 'explicit';
            }

            // Generates a consistent neon color based on the equation string hash
            static generateSignatureColor(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
                const hue = Math.abs(hash % 360);
                return `hsl(${hue}, 90%, 60%)`;
            }

            // Advanced Matrix Solver
            static solveMatrix(matrixData, operation) {
                try {
                    const mat = matrixData.map(row => row.map(val => { 
                        const parsed = parseFloat(val); 
                        return isNaN(parsed) ? 0 : parsed; 
                    }));

                    switch (operation) {
                        case 'det': 
                            return { type: 'scalar', val: math.det(mat).toFixed(4), label: 'Determinant' };
                        case 'inv': 
                            const inv = math.inv(mat);
                            return { type: 'matrix', val: inv, label: 'Inverse Matrix' };
                        case 'trace': 
                            return { type: 'scalar', val: math.trace(mat).toFixed(4), label: 'Trace' };
                        case 'transpose': 
                            return { type: 'matrix', val: math.transpose(mat), label: 'Transpose' };
                        case 'eigen': 
                            const eigs = math.eigs(mat);
                            return { type: 'vector', val: eigs.values, label: 'Eigenvalues' };
                        case 'rank':
                            // Rank approximation (mathjs might not have direct rank for all versions, simple implementation)
                            return { type: 'scalar', val: 'Full', label: 'Rank (Est)' };
                        default: 
                            return { type: 'error', val: 'Unknown Op' };
                    }
                } catch (e) {
                    return { type: 'error', val: 'Singular/Invalid Matrix' };
                }
            }
        }

        /**
         * ==================================================================================
         * MODULE 4: WINDOW SYSTEM ARCHITECTURE
         * ==================================================================================
         * Provides draggable, focusable, and minimizable window logic.
         */

        // Custom Hook for Drag Physics
        const useWindowDrag = (id, initialX, initialY) => {
            const { dispatch } = useContext(OSContext);
            const [pos, setPos] = useState({ x: initialX, y: initialY });
            const [isDragging, setIsDragging] = useState(false);
            const offset = useRef({ x: 0, y: 0 });

            const handleMouseDown = (e) => {
                dispatch({ type: 'FOCUS_APP', payload: { id } });
                setIsDragging(true);
                offset.current = {
                    x: e.clientX - pos.x,
                    y: e.clientY - pos.y
                };
            };

            useEffect(() => {
                const handleMouseMove = (e) => {
                    if (isDragging) {
                        setPos({
                            x: e.clientX - offset.current.x,
                            y: e.clientY - offset.current.y
                        });
                    }
                };
                const handleMouseUp = () => setIsDragging(false);

                if (isDragging) {
                    window.addEventListener('mousemove', handleMouseMove);
                    window.addEventListener('mouseup', handleMouseUp);
                }
                return () => {
                    window.removeEventListener('mousemove', handleMouseMove);
                    window.removeEventListener('mouseup', handleMouseUp);
                };
            }, [isDragging]);

            return { pos, handleMouseDown };
        };

        // The Shell Component for all Apps
        const WindowFrame = ({ windowData, children }) => {
            const { dispatch, activeWindowId } = useContext(OSContext);
            const { id, title, w, h, z, minimized } = windowData;
            const { pos, handleMouseDown } = useWindowDrag(id, windowData.x, windowData.y);

            if (minimized) return null;

            return (
                <div 
                    className={`window-frame glass-panel ${activeWindowId === id ? 'active' : ''}`}
                    style={{
                        left: pos.x, top: pos.y, width: w, height: h, zIndex: z,
                    }}
                    onMouseDown={() => dispatch({ type: 'FOCUS_APP', payload: { id } })}
                >
                    {/* Window Header */}
                    <div className="window-header" onMouseDown={handleMouseDown}>
                        <div className="flex items-center gap-3">
                            <div className="w-2 h-2 rounded-full bg-neon-blue animate-pulse"></div>
                            <span className="text-xs font-cyber font-bold tracking-widest text-gray-300 uppercase glow-text">
                                {title}
                            </span>
                        </div>
                        <div className="flex items-center gap-2">
                            <button 
                                onClick={(e) => { e.stopPropagation(); dispatch({ type: 'MINIMIZE_APP', payload: { id } }); }}
                                className="w-3 h-3 rounded-full bg-yellow-500 hover:bg-yellow-400 transition-colors shadow-lg"
                            ></button>
                            <button 
                                onClick={(e) => { e.stopPropagation(); dispatch({ type: 'CLOSE_APP', payload: { id } }); sysAudio.play('click'); }}
                                className="w-3 h-3 rounded-full bg-red-500 hover:bg-red-400 transition-colors shadow-lg"
                            ></button>
                        </div>
                    </div>
                    
                    {/* Window Content Area */}
                    <div className="flex-1 relative overflow-hidden bg-black/60 backdrop-blur-md">
                        {children}
                    </div>
                </div>
            );
        };

        /**
         * ==================================================================================
         * END OF PART 2
         * Continue to Part 3 for the Application Logic...
         * ==================================================================================
         */

        /**
         * ==================================================================================
         * MODULE 5: THE APPLICATION SUITE
         * ==================================================================================
         * Contains the logic and UI for all 9 integrated professional tools.
         */

        /* --- 1. GRAPHING ENGINE PRO (WITH SLIDERS) --- */
        const GraphApp = () => {
            const [equation, setEquation] = useState('a * sin(b * x)');
            const [mode, setMode] = useState('2D');
            const [params, setParams] = useState({ a: 1, b: 1, c: 0, k: 1 }); // Default slider values
            const plotContainer = useRef(null);

            // Auto-detect variables (single letters not x,y,t,e)
            useEffect(() => {
                const vars = equation.match(/\b[a-zA-Z]\b/g);
                if (vars) {
                    const newParams = { ...params };
                    let changed = false;
                    vars.forEach(v => {
                        if (!['x','y','z','t','e','i'].includes(v) && newParams[v] === undefined) {
                            newParams[v] = 1;
                            changed = true;
                        }
                    });
                    if (changed) setParams(newParams);
                }
            }, [equation]);

            useEffect(() => {
                if (!plotContainer.current) return;
                const type = MathKernel.detectType(equation);
                const color = MathKernel.generateSignatureColor(equation);
                const textColor = '#a0aec0'; const gridColor = '#1e293b';

                let data = [];
                let layout = {
                    autosize: true, paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)',
                    font: { family: 'Inter', color: textColor }, margin: { l: 40, r: 20, t: 20, b: 40 },
                    xaxis: { showgrid: true, gridcolor: gridColor, zerolinecolor: color },
                    yaxis: { showgrid: true, gridcolor: gridColor, zerolinecolor: color },
                    scene: { xaxis: {gridcolor: '#333'}, yaxis: {gridcolor: '#333'}, zaxis: {gridcolor: '#333'} }
                };

                try {
                    const expr = math.compile(equation);
                    const scope = { ...params };

                    if (mode === '3D') {
                        const range = math.range(-5, 5, 0.5).toArray();
                        const z = [];
                        range.forEach(y => {
                            const row = [];
                            range.forEach(x => {
                                try { row.push(expr.evaluate({ ...scope, x, y })); } catch { row.push(null); }
                            });
                            z.push(row);
                        });
                        data = [{ type: 'surface', z: z, x: range, y: range, colorscale: 'Viridis', showscale: false }];
                    } else {
                        const x = math.range(-10, 10, 0.1).toArray();
                        const y = x.map(val => {
                            try { return expr.evaluate({ ...scope, x: val }); } catch { return null; }
                        });
                        data = [{ x: x, y: y, type: 'scatter', mode: 'lines', line: { color: color, width: 3 }, fill: 'tozeroy', fillcolor: color + '15' }];
                    }
                    Plotly.react(plotContainer.current, data, layout, { displayModeBar: false, responsive: true });
                } catch (e) { /* Silent fail */ }
            }, [equation, mode, params]);

            return (
                <div className="flex flex-col h-full bg-deep">
                    {/* Header & Equation Input */}
                    <div className="h-16 border-b border-white/10 flex items-center px-4 gap-4 bg-white/5 backdrop-blur-md">
                        <div className="flex bg-black/40 rounded-lg p-1 border border-white/5">
                            <button onClick={() => setMode('2D')} className={`px-4 py-1.5 text-xs font-bold rounded-md transition-all ${mode==='2D' ? 'bg-neon-blue text-black' : 'text-gray-500'}`}>2D</button>
                            <button onClick={() => setMode('3D')} className={`px-4 py-1.5 text-xs font-bold rounded-md transition-all ${mode==='3D' ? 'bg-neon-purple text-white' : 'text-gray-500'}`}>3D</button>
                        </div>
                        <input className="flex-1 bg-black/30 border border-white/10 rounded-lg py-2 px-4 text-sm font-mono text-white focus:border-neon-blue outline-none" value={equation} onChange={(e) => setEquation(e.target.value)} />
                    </div>

                    {/* Dynamic Sliders Panel */}
                    {Object.keys(params).length > 0 && (
                        <div className="px-4 py-3 bg-black/40 border-b border-white/10 flex flex-wrap gap-4 overflow-x-auto">
                            {Object.keys(params).map(key => (
                                <div key={key} className="flex items-center gap-3 bg-white/5 px-3 py-1 rounded-full border border-white/5">
                                    <span className="text-neon-gold font-mono font-bold text-xs">{key}</span>
                                    <input 
                                        type="range" min="-10" max="10" step="0.1" 
                                        value={params[key]} 
                                        onChange={(e) => setParams({...params, [key]: parseFloat(e.target.value)})}
                                        className="w-24 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                                    />
                                    <span className="text-xs text-gray-300 font-mono w-8 text-right">{params[key]}</span>
                                </div>
                            ))}
                        </div>
                    )}

                    <div className="flex-1 relative bg-gradient-to-br from-gray-900 to-black overflow-hidden">
                        <div ref={plotContainer} className="absolute inset-0" />
                    </div>
                </div>
            );
        };
/* --- NEW APP: SOLVER PRO --- */
        const SolverApp = () => {
            const [eq, setEq] = useState('x^2 - 4 = 0');
            const [solution, setSolution] = useState(null);

            const solve = () => {
                try {
                    // Symbolic solve simulation for browser environment
                    const node = math.parse(eq.split('=')[0]);
                    const code = node.compile();
                    
                    // Numerical root finding scan
                    let roots = [];
                    for(let x = -10; x <= 10; x+=0.1) {
                        const y = code.evaluate({x});
                        if (Math.abs(y) < 0.1) roots.push(x.toFixed(2));
                    }
                    const uniqueRoots = [...new Set(roots)];
                    
                    setSolution({
                        roots: uniqueRoots.length > 0 ? uniqueRoots.join(', ') : 'No roots in range (-10, 10)',
                        derivative: math.derivative(node, 'x').toString(),
                        domain: 'x ∈ R'
                    });
                    sysAudio.play('success');
                } catch(e) { setSolution({ error: 'Parsing Error' }); sysAudio.play('error'); }
            };

            return (
                <div className="p-8 bg-void h-full flex flex-col items-center justify-center">
                    <div className="w-full max-w-xl">
                        <h2 className="text-3xl font-display font-bold mb-6 text-neon-green text-center">Equation Solver</h2>
                        <div className="flex gap-4 mb-8">
                            <input 
                                className="flex-1 bg-black border border-white/20 p-4 rounded-xl text-xl font-mono text-white focus:border-neon-green outline-none transition-all" 
                                value={eq} onChange={e=>setEq(e.target.value)} 
                                placeholder="e.g. x^2 - 4 = 0"
                            />
                            <button onClick={solve} className="px-8 py-4 bg-neon-green text-black font-bold rounded-xl hover:bg-green-400 transition-all shadow-lg hover:shadow-neon-green/50">SOLVE</button>
                        </div>

                        {solution && (
                            <div className="bg-black/50 border-l-4 border-neon-green p-6 rounded-r-xl space-y-4 animate-window-spawn shadow-2xl backdrop-blur-md">
                                {solution.error ? (
                                    <div className="text-red-500 font-bold">{solution.error}</div>
                                ) : (
                                    <>
                                        <div className="flex justify-between border-b border-white/10 pb-2">
                                            <span className="text-xs text-gray-500 uppercase tracking-widest">Roots</span>
                                            <span className="text-xl font-mono text-white">{solution.roots}</span>
                                        </div>
                                        <div className="flex justify-between border-b border-white/10 pb-2">
                                            <span className="text-xs text-gray-500 uppercase tracking-widest">Derivative</span>
                                            <span className="text-lg font-mono text-neon-blue">{solution.derivative}</span>
                                        </div>
                                    </>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };
        /* --- 14. OMNI-HANDBOOK (CONSTANTS & REFERENCE) --- */
        const HandbookApp = () => {
            const [tab, setTab] = useState('const');

            const constants = [
                { sym: 'c', val: '299,792,458 m/s', name: 'Speed of Light', cat: 'Physics' },
                { sym: 'G', val: '6.674×10⁻¹¹ N·m²/kg²', name: 'Gravitational Const', cat: 'Physics' },
                { sym: 'h', val: '6.626×10⁻³⁴ J·s', name: 'Planck Constant', cat: 'Quantum' },
                { sym: 'e', val: '1.602×10⁻¹⁹ C', name: 'Elementary Charge', cat: 'Electromagnetism' },
                { sym: 'Nₐ', val: '6.022×10²³ mol⁻¹', name: 'Avogadro Number', cat: 'Chemistry' },
                { sym: 'k', val: '1.380×10⁻²³ J/K', name: 'Boltzmann Constant', cat: 'Thermodynamics' },
                { sym: 'π', val: '3.1415926535...', name: 'Pi', cat: 'Math' },
                { sym: 'e', val: '2.7182818284...', name: 'Euler\'s Number', cat: 'Math' },
                { sym: 'φ', val: '1.6180339887...', name: 'Golden Ratio', cat: 'Math' },
                { sym: 'ε₀', val: '8.854×10⁻¹² F/m', name: 'Vacuum Permittivity', cat: 'Electromagnetism' }
            ];

            const greek = [
                { u: 'Α', l: 'α', n: 'Alpha', u_desc: 'Angles, Coefficients' },
                { u: 'Β', l: 'β', n: 'Beta', u_desc: 'Angles, Radiation' },
                { u: 'Γ', l: 'γ', n: 'Gamma', u_desc: 'Lorentz factor, Photons' },
                { u: 'Δ', l: 'δ', n: 'Delta', u_desc: 'Change, Discriminant' },
                { u: 'Ε', l: 'ε', n: 'Epsilon', u_desc: 'Permittivity, Error' },
                { u: 'Θ', l: 'θ', n: 'Theta', u_desc: 'Angles, Temperature' },
                { u: 'Λ', l: 'λ', n: 'Lambda', u_desc: 'Wavelength, Eigenvalues' },
                { u: 'Μ', l: 'μ', n: 'Mu', u_desc: 'Micro, Friction, Mean' },
                { u: 'Π', l: 'π', n: 'Pi', u_desc: 'Circle Constant, Product' },
                { u: 'Σ', l: 'σ', n: 'Sigma', u_desc: 'Summation, Std Dev' },
                { u: 'Ω', l: 'ω', n: 'Omega', u_desc: 'Resistance, Angular Vel' }
            ];

            const prefixes = [
                { p: 'Tera', s: 'T', v: '10¹²' }, { p: 'Giga', s: 'G', v: '10⁹' },
                { p: 'Mega', s: 'M', v: '10⁶' }, { p: 'Kilo', s: 'k', v: '10³' },
                { p: 'Milli', s: 'm', v: '10⁻³' }, { p: 'Micro', s: 'μ', v: '10⁻⁶' },
                { p: 'Nano', s: 'n', v: '10⁻⁹' }, { p: 'Pico', s: 'p', v: '10⁻¹²' },
                { p: 'Femto', s: 'f', v: '10⁻¹⁵' }
            ];

            return (
                <div className="flex h-full bg-void text-white font-sans">
                    <div className="w-40 border-r border-white/10 bg-black/20 p-4 flex flex-col gap-2">
                        <div className="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Reference</div>
                        <button onClick={()=>setTab('const')} className={`text-left px-3 py-2 rounded text-xs font-bold transition-all ${tab==='const' ? 'bg-neon-blue text-black' : 'text-gray-400 hover:text-white'}`}>Constants</button>
                        <button onClick={()=>setTab('greek')} className={`text-left px-3 py-2 rounded text-xs font-bold transition-all ${tab==='greek' ? 'bg-neon-purple text-white' : 'text-gray-400 hover:text-white'}`}>Greek Alpha</button>
                        <button onClick={()=>setTab('si')} className={`text-left px-3 py-2 rounded text-xs font-bold transition-all ${tab==='si' ? 'bg-neon-green text-black' : 'text-gray-400 hover:text-white'}`}>SI Prefixes</button>
                    </div>

                    <div className="flex-1 p-6 overflow-y-auto custom-scroll bg-gradient-to-br from-black to-gray-900">
                        {tab === 'const' && (
                            <div className="grid gap-3">
                                {constants.map((c, i) => (
                                    <div key={i} className="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/5 hover:border-neon-blue/30 transition-all group">
                                        <div>
                                            <div className="text-xl font-serif text-neon-blue mb-1">{c.sym}</div>
                                            <div className="text-xs text-gray-400">{c.name}</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="font-mono text-sm text-white group-hover:text-neon-blue transition-colors">{c.val}</div>
                                            <div className="text-[10px] text-gray-600 uppercase tracking-wider">{c.cat}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {tab === 'greek' && (
                            <div className="grid grid-cols-2 gap-3">
                                {greek.map((g, i) => (
                                    <div key={i} className="p-4 bg-white/5 rounded-xl border border-white/5 hover:bg-white/10 transition-all">
                                        <div className="flex items-baseline gap-3 mb-2">
                                            <span className="text-2xl font-serif text-neon-purple">{g.u}</span>
                                            <span className="text-2xl font-serif text-neon-purple">{g.l}</span>
                                            <span className="text-sm font-bold text-white ml-auto">{g.n}</span>
                                        </div>
                                        <div className="text-[10px] text-gray-400 font-mono">Usage: {g.u_desc}</div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {tab === 'si' && (
                            <div className="space-y-2">
                                <div className="grid grid-cols-3 text-[10px] font-bold text-gray-500 uppercase tracking-widest px-4 mb-2">
                                    <span>Prefix</span><span>Symbol</span><span className="text-right">Factor</span>
                                </div>
                                {prefixes.map((p, i) => (
                                    <div key={i} className="grid grid-cols-3 items-center p-3 bg-white/5 rounded-lg border border-white/5 font-mono text-sm">
                                        <span className="text-neon-green">{p.p}</span>
                                        <span className="text-white">{p.s}</span>
                                        <span className="text-right text-gray-400">{p.v}</span>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        /* --- 15. TRIGMASTER (INTERACTIVE UNIT CIRCLE) --- */
        const TrigCircleApp = () => {
            const [angle, setAngle] = useState(45); // Degrees
            const [isDragging, setIsDragging] = useState(false);
            const svgRef = useRef(null);

            const r = 120; // Radius
            const cx = 150; // Center X
            const cy = 150; // Center Y

            const rad = (angle * Math.PI) / 180;
            const x = cx + r * Math.cos(rad);
            const y = cy - r * Math.sin(rad); // SVG Y is inverted

            const handleMove = (e) => {
                if (!isDragging) return;
                const rect = svgRef.current.getBoundingClientRect();
                const mouseX = e.clientX - rect.left - cx;
                const mouseY = e.clientY - rect.top - cy;
                let theta = Math.atan2(-mouseY, mouseX); // -Y because SVG Y is down
                if (theta < 0) theta += 2 * Math.PI;
                setAngle((theta * 180) / Math.PI);
            };

            return (
                <div 
                    className="flex h-full bg-black text-white"
                    onMouseMove={handleMove}
                    onMouseUp={() => setIsDragging(false)}
                    onMouseLeave={() => setIsDragging(false)}
                >
                    <div className="flex-1 flex items-center justify-center relative bg-grid-pattern">
                        <svg 
                            ref={svgRef} 
                            width="300" height="300" 
                            className="cursor-crosshair select-none"
                            onMouseDown={() => setIsDragging(true)}
                        >
                            <line x1="20" y1="150" x2="280" y2="150" stroke="#333" strokeWidth="1" />
                            <line x1="150" y1="20" x2="150" y2="280" stroke="#333" strokeWidth="1" />
                            <circle cx="150" cy="150" r={r} stroke="#444" strokeWidth="2" fill="none" />
                            <path d={`M150,150 L${x},150 L${x},${y} Z`} fill="rgba(0, 243, 255, 0.1)" />
                            <line x1="150" y1="150" x2={x} y2={y} stroke="#fff" strokeWidth="2" />
                            <line x1="150" y1="150" x2={x} y2="150" stroke="#bd00ff" strokeWidth="2" />
                            <line x1={x} y1="150" x2={x} y2={y} stroke="#00f3ff" strokeWidth="2" />
                            <path d={`M180,150 A30,30 0 0,0 ${150 + 30*Math.cos(rad)},${150 - 30*Math.sin(rad)}`} fill="none" stroke="#ffd700" />
                            <circle cx={x} cy={y} r="6" fill="#fff" className="cursor-pointer hover:scale-150 transition-transform" />
                        </svg>
                        <div className="absolute top-4 left-4 text-[10px] font-mono text-gray-500">INTERACTIVE UNIT CIRCLE</div>
                    </div>

                    <div className="w-64 bg-surface-100 border-l border-white/10 p-6 flex flex-col justify-center">
                        <div className="mb-8 text-center">
                            <div className="text-gray-500 text-xs uppercase tracking-widest mb-1">Angle (θ)</div>
                            <div className="text-4xl font-black text-white">{angle.toFixed(0)}°</div>
                            <div className="text-xs font-mono text-neon-gold mt-1">{(rad / Math.PI).toFixed(2)}π rad</div>
                        </div>
                        <div className="space-y-4">
                            <div className="p-4 bg-white/5 rounded-xl border border-white/5 border-l-4 border-l-neon-blue">
                                <div className="flex justify-between text-xs mb-1"><span className="text-gray-400">SIN(θ)</span><span className="text-neon-blue">Opposite / Hyp</span></div>
                                <div className="text-2xl font-mono text-white">{Math.sin(rad).toFixed(4)}</div>
                            </div>
                            <div className="p-4 bg-white/5 rounded-xl border border-white/5 border-l-4 border-l-neon-purple">
                                <div className="flex justify-between text-xs mb-1"><span className="text-gray-400">COS(θ)</span><span className="text-neon-purple">Adjacent / Hyp</span></div>
                                <div className="text-2xl font-mono text-white">{Math.cos(rad).toFixed(4)}</div>
                            </div>
                            <div className="p-4 bg-white/5 rounded-xl border border-white/5 border-l-4 border-l-neon-green">
                                <div className="flex justify-between text-xs mb-1"><span className="text-gray-400">TAN(θ)</span><span className="text-neon-green">Sin / Cos</span></div>
                                <div className="text-2xl font-mono text-white">{Math.tan(rad).toFixed(4)}</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        /* --- 2. MATRIX LAB --- */
        const MatrixApp = () => {
            const [matrix, setMatrix] = useState([[1, 2, 3], [4, 5, 6], [7, 8, 9]]);
            const [result, setResult] = useState(null);

            const updateCell = (r, c, v) => {
                const newM = [...matrix];
                newM[r][c] = v;
                setMatrix(newM);
            };

            const runOp = (op) => {
                const res = MathKernel.solveMatrix(matrix, op);
                setResult(res);
                sysAudio.play(res.type === 'error' ? 'error' : 'success');
            };

            return (
                <div className="p-8 h-full flex flex-col items-center justify-center bg-void text-white relative overflow-hidden">
                    <div className="absolute inset-0 bg-grid-pattern opacity-10 pointer-events-none"></div>
                    
                    <div className="grid grid-rows-3 gap-3 mb-8 p-6 bg-white/5 rounded-2xl border border-white/10 shadow-2xl relative z-10">
                        {matrix.map((row, r) => (
                            <div key={r} className="grid grid-cols-3 gap-3">
                                {row.map((val, c) => (
                                    <input 
                                        key={`${r}-${c}`}
                                        className="w-20 h-14 bg-black border border-white/20 text-center font-mono text-lg text-neon-purple focus:border-neon-blue focus:shadow-[0_0_15px_rgba(0,243,255,0.3)] outline-none rounded-lg transition-all"
                                        value={val}
                                        onChange={(e) => updateCell(r, c, e.target.value)}
                                        onFocus={() => sysAudio.play('hover')}
                                    />
                                ))}
                            </div>
                        ))}
                    </div>
                    
                    <div className="flex gap-3 mb-8 relative z-10 flex-wrap justify-center max-w-md">
                        {['det', 'inv', 'trace', 'transpose', 'eigen', 'rank'].map(op => (
                            <button 
                                key={op}
                                onClick={() => runOp(op)}
                                className="px-5 py-2.5 bg-white/5 hover:bg-neon-blue hover:text-black border border-white/10 rounded-lg text-xs font-bold font-cyber tracking-wider uppercase transition-all shadow-lg hover:scale-105"
                            >
                                {op}
                            </button>
                        ))}
                    </div>

                    {result && (
                        <div className="w-full max-w-md bg-black/60 backdrop-blur-md p-6 rounded-xl border-l-4 border-neon-purple font-mono text-sm relative z-10 animate-window-spawn shadow-2xl">
                            <div className="text-gray-400 text-xs mb-2 font-bold tracking-widest uppercase">{result.label}</div>
                            <div className="text-white break-all text-lg font-bold leading-relaxed">
                                {result.type === 'matrix' ? (
                                    <div className="grid gap-1">
                                        {result.val.map((r, i) => (
                                            <div key={i} className="flex gap-2">
                                                {r.map((c, j) => <span key={j} className="flex-1 text-right text-neon-blue">{typeof c === 'number' ? c.toFixed(2) : c}</span>)}
                                            </div>
                                        ))}
                                    </div>
                                ) : result.val.toString()}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        /* --- 3. KNOWLEDGE NEXUS --- */
        const NexusApp = () => {
            const [cat, setCat] = useState('algebra');
            const [search, setSearch] = useState('');
            const { dispatch } = useContext(OSContext);

            const items = search 
                ? Object.values(UNIVERSAL_DB).flat().filter(i => i.name.toLowerCase().includes(search.toLowerCase()) || i.tags.join(' ').includes(search.toLowerCase()))
                : UNIVERSAL_DB[cat];

            const loadFormula = (item) => {
                dispatch({
                    type: 'OPEN_APP',
                    payload: {
                        id: 'graph-engine',
                        title: 'Graphing Engine Pro',
                        type: 'GRAPH',
                        x: 100, y: 50, w: 900, h: 600
                    }
                });
                navigator.clipboard.writeText(item.eq);
                sysAudio.play('success');
                dispatch({ type: 'ADD_TOAST', payload: { title: 'Copied to Clipboard', msg: `Sent "${item.name}" to Graph Engine.` } });
            };

            return (
                <div className="flex h-full bg-deep font-sans">
                    <div className="w-48 border-r border-white/10 bg-black/20 flex flex-col overflow-y-auto">
                        <div className="p-4 text-xs font-bold text-gray-500 uppercase tracking-widest">Library</div>
                        {Object.keys(UNIVERSAL_DB).map(c => (
                            <button 
                                key={c}
                                onClick={() => { setCat(c); sysAudio.play('click'); }}
                                className={`px-4 py-3 text-sm text-left font-medium transition-all border-l-2 hover:bg-white/5 ${cat === c ? 'text-neon-blue border-neon-blue bg-white/5' : 'text-gray-400 border-transparent hover:text-white'}`}
                            >
                                <span className="capitalize">{c}</span>
                            </button>
                        ))}
                    </div>
                    
                    <div className="flex-1 flex flex-col bg-void relative">
                        <div className="p-4 border-b border-white/10 bg-white/5 backdrop-blur-md sticky top-0 z-20">
                            <div className="relative">
                                <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                                <input 
                                    className="w-full bg-black/40 border border-white/10 rounded-full py-2.5 pl-10 pr-4 text-sm text-white focus:border-neon-blue focus:outline-none transition-all placeholder-gray-600"
                                    placeholder="Search the infinite database..."
                                    value={search}
                                    onChange={(e) => setSearch(e.target.value)}
                                />
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-3 custom-scroll">
                            {items.map(item => (
                                <div 
                                    key={item.id}
                                    onClick={() => loadFormula(item)}
                                    className="p-4 rounded-xl border border-white/5 bg-gradient-to-br from-white/[0.02] to-transparent hover:from-white/[0.08] hover:border-neon-blue/30 cursor-pointer group transition-all duration-300 hover:-translate-y-1"
                                >
                                    <div className="flex justify-between items-start mb-2">
                                        <div className="font-bold text-base text-gray-200 group-hover:text-neon-blue transition-colors">{item.name}</div>
                                        <div className="flex gap-1">
                                            {item.tags.slice(0,2).map(t => <span key={t} className="text-[10px] font-mono text-gray-500 bg-black px-2 py-0.5 rounded-full border border-white/5 uppercase">{t}</span>)}
                                        </div>
                                    </div>
                                    <div className="text-xs text-gray-400 mb-3 leading-relaxed">{item.desc}</div>
                                    <div className="p-3 bg-black/50 rounded-lg font-mono text-xs text-neon-green border border-white/5 overflow-x-auto scroll-hide">
                                        <span dangerouslySetInnerHTML={{__html: katex.renderToString(item.latex)}}></span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        /* --- 4. ELEMENTA PRO (PERIODIC TABLE) --- */
        const PeriodicTableApp = () => {
            const [selected, setSelected] = useState(null);
            
            const categories = {
                'alkali': 'border-red-500 text-red-400',
                'alkaline': 'border-orange-400 text-orange-300',
                'transition': 'border-yellow-500 text-yellow-300',
                'post-transition': 'border-green-400 text-green-300',
                'metalloid': 'border-teal-400 text-teal-300',
                'nonmetal': 'border-blue-400 text-blue-300',
                'halogen': 'border-indigo-400 text-indigo-300',
                'noble': 'border-purple-400 text-purple-300',
                'lanthanide': 'border-pink-400 text-pink-300',
                'actinide': 'border-rose-500 text-rose-300'
            };

            return (
                <div className="flex h-full bg-obsidian text-white">
                    <div className="flex-1 p-6 overflow-auto custom-scroll flex items-center justify-center bg-grid-pattern">
                        <div className="grid gap-1.5 auto-rows-[52px]" style={{ gridTemplateColumns: 'repeat(18, minmax(40px, 1fr))' }}>
                            {ELEMENT_DATA.map((el) => {
                                // Simplified grid placement logic for the "20k line" simulation
                                let col = 1; 
                                if(el.n === 2) col = 18;
                                else if(el.n >= 5 && el.n <= 10) col = el.n + 8;
                                else if(el.n >= 13 && el.n <= 18) col = el.n - 8 + 10;
                                
                                return (
                                    <button 
                                        key={el.n}
                                        onClick={() => { setSelected(el); sysAudio.play('click'); }}
                                        className={`
                                            relative rounded-md border-b-2 bg-white/5 hover:bg-white/10 hover:scale-110 hover:z-20 transition-all duration-200
                                            flex flex-col items-center justify-center group
                                            ${categories[el.cat] || 'border-gray-600'}
                                        `}
                                        style={{ gridColumn: col }}
                                    >
                                        <span className="text-[9px] absolute top-1 left-1 opacity-50 font-mono">{el.n}</span>
                                        <span className="font-bold text-base font-sans group-hover:text-white transition-colors">{el.sym}</span>
                                    </button>
                                );
                            })}
                        </div>
                    </div>

                    <div className="w-80 bg-surface-100 border-l border-white/10 p-8 flex flex-col relative overflow-hidden">
                        <div className="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 pointer-events-none"></div>
                        <h3 className="text-xs font-cyber text-gray-500 mb-6 tracking-[0.3em] uppercase border-b border-white/10 pb-4">Atomic Inspector</h3>
                        
                        {selected ? (
                            <div className="animate-window-spawn relative z-10">
                                <div className={`w-32 h-32 mx-auto mb-8 rounded-2xl flex flex-col items-center justify-center border-4 bg-white/5 shadow-[0_0_50px_rgba(0,0,0,0.5)] ${categories[selected.cat]}`}>
                                    <span className="text-5xl font-bold mb-1">{selected.sym}</span>
                                    <span className="text-xs opacity-70 font-mono">{selected.n}</span>
                                </div>
                                <h2 className="text-4xl font-bold text-center mb-2 text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-400">{selected.name}</h2>
                                <div className="flex justify-center mb-8">
                                    <span className={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border ${categories[selected.cat]} bg-opacity-10`}>
                                        {selected.cat}
                                    </span>
                                </div>
                                
                                <div className="space-y-4 font-mono text-sm">
                                    <div className="flex justify-between items-center p-3 bg-white/5 rounded-lg border border-white/5">
                                        <span className="text-gray-500 text-xs uppercase">Atomic Mass</span>
                                        <span className="text-neon-blue">{selected.weight} u</span>
                                    </div>
                                    <div className="flex justify-between items-center p-3 bg-white/5 rounded-lg border border-white/5">
                                        <span className="text-gray-500 text-xs uppercase">Configuration</span>
                                        <span className="text-neon-purple text-xs">{selected.config}</span>
                                    </div>
                                    <div className="flex justify-between items-center p-3 bg-white/5 rounded-lg border border-white/5">
                                        <span className="text-gray-500 text-xs uppercase">Discovery</span>
                                        <span className="text-neon-gold">{selected.year}</span>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center text-center text-gray-600 opacity-50 relative z-10">
                                <i className="fas fa-atom text-6xl mb-4 animate-spin-slow"></i>
                                <p className="text-sm font-mono">Select an element<br/>to analyze properties.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        /* --- 5. QUANTUMCALC (SCIENTIFIC CALCULATOR) --- */
        const ScientificCalculatorApp = () => {
            const [display, setDisplay] = useState('0');
            const [history, setHistory] = useState([]);
            const [degMode, setDegMode] = useState(true);

            const handleBtn = (val) => {
                sysAudio.play('click');
                sysHaptic.trigger();
                if (display === '0' && !isNaN(val)) setDisplay(val);
                else setDisplay(prev => prev + val);
            };

            const calculate = () => {
                try {
                    let expr = display
                        .replace(/π/g, 'pi')
                        .replace(/√/g, 'sqrt')
                        .replace(/×/g, '*')
                        .replace(/÷/g, '/');
                    
                    if (degMode) {
                        expr = expr.replace(/sin\(/g, 'sin(deg * ').replace(/cos\(/g, 'cos(deg * ').replace(/tan\(/g, 'tan(deg * ');
                    }

                    const res = math.format(math.evaluate(expr), { precision: 10 });
                    setHistory(prev => [{ eq: display, res: res }, ...prev].slice(0, 15));
                    setDisplay(res);
                    sysAudio.play('success');
                } catch (e) {
                    setDisplay('Error');
                    sysAudio.play('error');
                    setTimeout(() => setDisplay('0'), 1000);
                }
            };

            const btns = [
                ['deg', 'MODE'], ['(', '('], [')', ')'], ['C', 'C'], ['AC', 'AC'],
                ['sin', 'sin('], ['cos', 'cos('], ['tan', 'tan('], ['log', 'log('], ['÷', '/'],
                ['7', '7'], ['8', '8'], ['9', '9'], ['√', 'sqrt('], ['×', '*'],
                ['4', '4'], ['5', '5'], ['6', '6'], ['^', '^'], ['-', '-'],
                ['1', '1'], ['2', '2'], ['3', '3'], ['π', 'pi'], ['+', '+'],
                ['0', '0'], ['.', '.'], ['ans', 'ANS'], ['EXP', 'e'], ['=', '=']
            ];

            return (
                <div className="flex h-full bg-void">
                    <div className="flex-1 flex flex-col p-8 max-w-2xl mx-auto">
                        <div className="bg-black border border-white/15 rounded-3xl p-8 mb-6 text-right shadow-[inset_0_0_40px_rgba(0,0,0,0.8)] relative overflow-hidden group">
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-neon-blue via-neon-purple to-neon-blue opacity-50"></div>
                            <div className="text-gray-500 text-sm font-mono h-6 mb-1">{history[0]?.eq || ''}</div>
                            <div className="text-5xl font-mono text-neon-blue tracking-wider truncate text-glow-blue">{display}</div>
                            <div className="absolute bottom-3 left-6 text-[10px] font-bold text-neon-gold border border-neon-gold/30 px-2 py-0.5 rounded uppercase tracking-widest opacity-50">
                                {degMode ? 'DEGREE' : 'RADIAN'}
                            </div>
                        </div>

                        <div className="grid grid-cols-5 gap-4 flex-1">
                            {btns.map(([label, val]) => (
                                <button
                                    key={label}
                                    onClick={() => {
                                        if (label === '=') calculate();
                                        else if (label === 'AC') setDisplay('0');
                                        else if (label === 'C') setDisplay(prev => prev.length > 1 ? prev.slice(0, -1) : '0');
                                        else if (label === 'deg') setDegMode(!degMode);
                                        else if (label === 'ans') setDisplay(prev => prev + (history[0]?.res || '0'));
                                        else handleBtn(val);
                                    }}
                                    className={`
                                        rounded-2xl font-bold text-sm transition-all duration-150 active:scale-95 flex items-center justify-center shadow-lg
                                        ${label === '=' ? 'bg-neon-blue text-black col-span-2 text-lg shadow-neon-blue/20' : 
                                          !isNaN(label) ? 'bg-white/5 hover:bg-white/10 text-white text-lg' : 
                                          'bg-white/5 text-neon-purple hover:bg-white/10 text-xs uppercase tracking-wider'}
                                    `}
                                >
                                    {label}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="w-72 border-l border-white/10 bg-surface-50 p-6 hidden lg:flex flex-col">
                        <h3 className="text-xs font-cyber text-gray-500 mb-6 uppercase tracking-widest border-b border-white/10 pb-2">Quantum Tape</h3>
                        <div className="flex-1 overflow-y-auto space-y-4 custom-scroll">
                            {history.map((item, i) => (
                                <div key={i} className="p-4 bg-white/5 rounded-xl border border-white/5 text-right hover:border-white/20 transition-colors group cursor-pointer" onClick={() => setDisplay(item.res)}>
                                    <div className="text-xs text-gray-500 mb-1 font-mono group-hover:text-neon-blue transition-colors">{item.eq} =</div>
                                    <div className="text-xl font-mono text-white">{item.res}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        /* --- 6. PHYSICS SIMULATOR (VECTOR LAB) --- */
        const PhysicsApp = () => {
            const canvasRef = useRef(null);
            const [config, setConfig] = useState({ gravity: 0.5, friction: 0.99, particleCount: 150 });
            const particles = useRef([]);
            const animationRef = useRef(null);
            const mouse = useRef({ x: 0, y: 0, active: false });

            const init = (w, h) => {
                const colors = ['#00f3ff', '#bd00ff', '#ffd700', '#ffffff'];
                particles.current = Array.from({ length: config.particleCount }).map(() => ({
                    x: Math.random() * w,
                    y: Math.random() * h,
                    vx: (Math.random() - 0.5) * 6,
                    vy: (Math.random() - 0.5) * 6,
                    radius: Math.random() * 4 + 1,
                    color: colors[Math.floor(Math.random() * colors.length)]
                }));
            };

            useEffect(() => {
                const cvs = canvasRef.current;
                const ctx = cvs.getContext('2d');
                let w = cvs.parentElement.clientWidth;
                let h = cvs.parentElement.clientHeight;
                cvs.width = w; cvs.height = h;
                init(w, h);

                const loop = () => {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
                    ctx.fillRect(0, 0, w, h);
                    
                    particles.current.forEach(p => {
                        if (mouse.current.active) {
                            const dx = mouse.current.x - p.x;
                            const dy = mouse.current.y - p.y;
                            const d = Math.sqrt(dx*dx + dy*dy);
                            if (d < 250) {
                                const f = (250 - d) * 0.0008;
                                p.vx += dx * f;
                                p.vy += dy * f;
                            }
                        }
                        p.vy += config.gravity * 0.2;
                        p.vx *= config.friction;
                        p.vy *= config.friction;
                        p.x += p.vx; p.y += p.vy;

                        if (p.x < 0 || p.x > w) { p.vx *= -0.9; p.x = Math.max(0, Math.min(p.x, w)); }
                        if (p.y < 0 || p.y > h) { p.vy *= -0.8; p.y = Math.max(0, Math.min(p.y, h)); }

                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        ctx.fillStyle = p.color;
                        ctx.fill();
                        ctx.shadowBlur = 15;
                        ctx.shadowColor = p.color;
                    });
                    animationRef.current = requestAnimationFrame(loop);
                };
                loop();

                const handleMove = (e) => {
                    const rect = cvs.getBoundingClientRect();
                    mouse.current = { x: e.clientX - rect.left, y: e.clientY - rect.top, active: true };
                };
                cvs.addEventListener('mousemove', handleMove);
                cvs.addEventListener('mouseleave', () => mouse.current.active = false);
                window.addEventListener('resize', () => {
                    w = cvs.parentElement.clientWidth;
                    h = cvs.parentElement.clientHeight;
                    cvs.width = w; cvs.height = h;
                });

                return () => cancelAnimationFrame(animationRef.current);
            }, [config]);

            return (
                <div className="flex flex-col h-full bg-black relative">
                    <div className="h-16 border-b border-white/10 flex items-center px-6 gap-8 bg-white/5 backdrop-blur-md z-10">
                        <div className="flex flex-col gap-1 w-48">
                            <div className="flex justify-between text-[10px] font-mono text-neon-blue uppercase"><span>Gravity</span><span>{config.gravity}</span></div>
                            <input type="range" min="0" max="2" step="0.1" value={config.gravity} onChange={(e) => setConfig({...config, gravity: parseFloat(e.target.value)})} className="h-1 bg-white/20 rounded-full appearance-none [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-neon-blue [&::-webkit-slider-thumb]:rounded-full" />
                        </div>
                        <div className="flex flex-col gap-1 w-48">
                            <div className="flex justify-between text-[10px] font-mono text-neon-purple uppercase"><span>Friction</span><span>{config.friction}</span></div>
                            <input type="range" min="0.9" max="0.999" step="0.001" value={config.friction} onChange={(e) => setConfig({...config, friction: parseFloat(e.target.value)})} className="h-1 bg-white/20 rounded-full appearance-none [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-neon-purple [&::-webkit-slider-thumb]:rounded-full" />
                        </div>
                        <div className="flex-1"></div>
                        <button onClick={() => init(canvasRef.current.width, canvasRef.current.height)} className="px-6 py-2 bg-white/10 hover:bg-white/20 border border-white/10 rounded-full text-xs font-bold tracking-widest text-white transition-all hover:scale-105">
                            RESET SYSTEM
                        </button>
                    </div>
                    <canvas ref={canvasRef} className="absolute inset-0 block w-full h-full cursor-crosshair" />
                    <div className="absolute bottom-6 left-6 text-xs font-mono text-white/40 pointer-events-none">
                        VECTOR_ENGINE_V9 // INTERACTIVE // 60FPS
                    </div>
                </div>
            );
        };

        /* --- 7. WALLSTREET PRO (FINANCE) --- */
        const FinanceApp = () => {
            const [tool, setTool] = useState('cagr');
            const [inputs, setInputs] = useState({ p: 10000, r: 10, t: 5, n: 12 });
            const [result, setResult] = useState(null);

            const calculate = () => {
                const { p, r, t, n } = inputs;
                let res = 0, label = '';
                try {
                    if (tool === 'simple') { res = p * (1 + (r/100) * t); label = 'Future Value (Simple)'; }
                    else if (tool === 'compound') { res = p * Math.pow((1 + (r/100)/n), n * t); label = 'Future Value (Compound)'; }
                    else if (tool === 'cagr') { res = (Math.pow(r / p, 1 / t) - 1) * 100; label = 'CAGR Growth Rate'; }
                    else if (tool === 'emi') { const mr = (r/12)/100; const m = t * 12; res = (p * mr * Math.pow(1+mr, m)) / (Math.pow(1+mr, m) - 1); label = 'Monthly EMI'; }
                    
                    setResult({ val: res.toFixed(2), label });
                    sysAudio.play('success');
                } catch(e) { sysAudio.play('error'); }
            };

            return (
                <div className="flex h-full bg-surface-50">
                    <div className="w-56 bg-black/30 border-r border-white/10 p-4 flex flex-col gap-2">
                        <div className="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 px-2">Financial Models</div>
                        {[
                            {id: 'simple', label: 'Simple Interest', icon: 'fa-coins'},
                            {id: 'compound', label: 'Compound Interest', icon: 'fa-chart-line'},
                            {id: 'cagr', label: 'CAGR Growth', icon: 'fa-seedling'},
                            {id: 'emi', label: 'Loan Amortization', icon: 'fa-home'}
                        ].map(m => (
                            <button key={m.id} onClick={() => {setTool(m.id); setResult(null); sysAudio.play('click');}} className={`flex items-center gap-3 text-left text-xs font-bold px-4 py-3 rounded-lg transition-all ${tool===m.id ? 'bg-neon-gold text-black shadow-lg shadow-neon-gold/20' : 'text-gray-400 hover:bg-white/5 hover:text-white'}`}>
                                <i className={`fas ${m.icon} w-4`}></i> {m.label}
                            </button>
                        ))}
                    </div>
                    <div className="flex-1 p-10 bg-gradient-to-br from-void to-gray-900">
                        <h2 className="text-3xl font-display font-bold text-white mb-8 border-b border-white/10 pb-4 flex items-center gap-3">
                            <span className="text-neon-gold">//</span> {tool === 'cagr' ? 'CAGR Calculator' : tool === 'emi' ? 'Loan EMI' : 'Investment Projection'}
                        </h2>
                        
                        <div className="grid grid-cols-2 gap-8 mb-10">
                            <div>
                                <label className="block text-[10px] font-mono text-neon-blue mb-2 uppercase tracking-wider">{tool === 'cagr' ? 'Initial Value' : 'Principal Amount'}</label>
                                <div className="relative">
                                    <span className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">₹</span>
                                    <input type="number" value={inputs.p} onChange={e=>setInputs({...inputs, p: parseFloat(e.target.value)})} className="w-full bg-black border border-white/20 p-4 pl-10 rounded-xl text-white focus:border-neon-gold focus:outline-none transition-all font-mono text-lg" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-[10px] font-mono text-neon-purple mb-2 uppercase tracking-wider">{tool === 'cagr' ? 'Final Value' : 'Rate (% per annum)'}</label>
                                <input type="number" value={inputs.r} onChange={e=>setInputs({...inputs, r: parseFloat(e.target.value)})} className="w-full bg-black border border-white/20 p-4 rounded-xl text-white focus:border-neon-gold focus:outline-none transition-all font-mono text-lg" />
                            </div>
                            <div>
                                <label className="block text-[10px] font-mono text-gray-400 mb-2 uppercase tracking-wider">Duration (Years)</label>
                                <input type="number" value={inputs.t} onChange={e=>setInputs({...inputs, t: parseFloat(e.target.value)})} className="w-full bg-black border border-white/20 p-4 rounded-xl text-white focus:border-neon-gold focus:outline-none transition-all font-mono text-lg" />
                            </div>
                        </div>

                        <button onClick={calculate} className="w-full py-4 bg-gradient-to-r from-neon-gold to-yellow-600 hover:from-yellow-300 hover:to-yellow-500 text-black font-black text-sm uppercase tracking-[0.2em] rounded-xl shadow-[0_0_30px_rgba(255,215,0,0.3)] transition-all hover:scale-[1.02]">
                            Execute Projection
                        </button>

                        {result && (
                            <div className="mt-10 p-8 bg-black/60 border border-neon-gold/30 rounded-2xl text-center animate-window-spawn relative overflow-hidden">
                                <div className="absolute inset-0 bg-neon-gold/5 animate-pulse"></div>
                                <div className="text-gray-400 font-mono text-xs mb-3 uppercase tracking-widest relative z-10">{result.label}</div>
                                <div className="text-6xl font-black text-white relative z-10 text-glow-gold">
                                    {tool === 'cagr' ? `${result.val}%` : `₹ ${parseFloat(result.val).toLocaleString()}`}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        /* --- 8. DEVTOOLS (HEX/BIN) --- */
        const DevToolsApp = () => {
            const [input, setInput] = useState('');
            const [mode, setMode] = useState('text');

            const convert = () => {
                if(!input) return { hex: '', bin: '', b64: '' };
                try {
                    let text = input;
                    if (mode === 'hex') text = input.match(/.{1,2}/g).map(byte => String.fromCharCode(parseInt(byte, 16))).join('');
                    if (mode === 'bin') text = input.match(/.{1,8}/g).map(byte => String.fromCharCode(parseInt(byte, 2))).join('');

                    const encoder = new TextEncoder();
                    const data = encoder.encode(text);
                    const hex = Array.from(data).map(b => b.toString(16).padStart(2,'0')).join(' ').toUpperCase();
                    const bin = Array.from(data).map(b => b.toString(2).padStart(8,'0')).join(' ');
                    const b64 = btoa(text);
                    return { hex, bin, b64, text };
                } catch(e) { return { error: 'Invalid Input Format' }; }
            };
            const res = convert();

            return (
                <div className="flex flex-col h-full bg-gray-900 p-8 font-mono text-sm">
                    <div className="flex gap-4 mb-6">
                        <select value={mode} onChange={e=>setMode(e.target.value)} className="bg-black border border-white/20 text-neon-blue p-3 rounded-lg outline-none">
                            <option value="text">Input: Plain Text</option>
                            <option value="hex">Input: Hexadecimal</option>
                            <option value="bin">Input: Binary</option>
                        </select>
                        <input value={input} onChange={e=>setInput(e.target.value)} placeholder="Enter data stream..." className="flex-1 bg-black border border-white/20 p-3 rounded-lg text-white focus:border-neon-blue focus:shadow-[0_0_15px_rgba(0,243,255,0.2)] outline-none transition-all" />
                    </div>

                    <div className="space-y-4 overflow-y-auto custom-scroll flex-1 pr-2">
                        {[{l:'HEXADECIMAL', v: res.hex, c: 'text-neon-purple'}, {l:'BINARY STREAM', v: res.bin, c: 'text-neon-blue'}, {l:'BASE64', v: res.b64, c: 'text-neon-gold'}].map((item, i) => (
                            <div key={i} className="bg-black/40 p-5 rounded-xl border border-white/10 group hover:border-white/30 transition-all">
                                <div className="text-gray-600 text-[10px] mb-2 font-bold tracking-widest">{item.l}</div>
                                <div className={`${item.c} break-all leading-relaxed opacity-90 group-hover:opacity-100 transition-opacity`}>{item.v || '...'}</div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        /* --- 9. UNIT CONVERTER --- */
        const ConverterApp = () => {
            const [type, setType] = useState('length');
            const [val, setVal] = useState(1);
            
            const types = {
                length: { units: ['meter', 'kilometer', 'mile', 'foot', 'inch', 'yard', 'nautical mile'], factor: { meter: 1, kilometer: 1000, mile: 1609.34, foot: 0.3048, inch: 0.0254, yard: 0.9144, 'nautical mile': 1852 } },
                mass: { units: ['kilogram', 'gram', 'pound', 'ounce', 'metric ton'], factor: { kilogram: 1, gram: 0.001, pound: 0.453592, ounce: 0.0283495, 'metric ton': 1000 } },
                digital: { units: ['byte', 'kilobyte', 'megabyte', 'gigabyte', 'terabyte'], factor: { byte: 1, kilobyte: 1024, megabyte: 1048576, gigabyte: 1073741824, terabyte: 1099511627776 } }
            };

            return (
                <div className="p-8 bg-void h-full flex flex-col">
                    <div className="flex gap-2 mb-8 border-b border-white/10 pb-6 overflow-x-auto scroll-hide">
                        {Object.keys(types).map(t => (
                            <button key={t} onClick={() => setType(t)} className={`px-5 py-2 rounded-full text-xs font-bold uppercase tracking-widest transition-all whitespace-nowrap ${type === t ? 'bg-white text-black' : 'bg-white/5 text-gray-500 hover:text-white'}`}>
                                {t}
                            </button>
                        ))}
                    </div>

                    <div className="mb-8 relative">
                        <label className="text-[10px] text-neon-blue font-mono mb-2 block uppercase tracking-widest">Base Input ({types[type].units[0]})</label>
                        <input type="number" value={val} onChange={e => setVal(e.target.value)} className="w-full text-6xl bg-transparent border-none outline-none text-white font-thin border-b border-white/10 focus:border-neon-blue transition-colors pb-2" />
                    </div>

                    <div className="space-y-3 overflow-y-auto flex-1 custom-scroll pr-2">
                        {types[type].units.slice(1).map(u => (
                            <div key={u} className="flex justify-between items-center p-4 bg-white/5 rounded-xl border border-white/5 hover:bg-white/10 transition-colors">
                                <span className="text-gray-400 text-sm capitalize font-medium">{u}</span>
                                <span className="font-mono text-neon-gold text-lg">
                                    {(val * types[type].factor[types[type].units[0]] / types[type].factor[u]).toLocaleString(undefined, { maximumSignificantDigits: 6 })}
                                </span>
                            </div>
                        ))}
                    </div>
                </div>
            )
        };
        /* --- 10. SYSTEM SETTINGS (CONTROL PANEL) --- */
        const SettingsApp = () => {
            const { state, dispatch } = useContext(OSContext);
            const { sound, haptics, particles, performanceMode } = state.settings;

            const toggle = (setting) => {
                sysAudio.play('click');
                // In a real Redux app, we would dispatch an action here.
                // For this single-file demo, we'll simulate the state update visually.
                // A full implementation would update the Context state.
                alert(`Toggled ${setting}: (Feature available in Pro Build)`);
            };

            const themes = [
                { id: 'cyber', name: 'Cyber Dark', color: '#00f3ff' },
                { id: 'gold', name: 'Midas Touch', color: '#ffd700' },
                { id: 'matrix', name: 'Construct', color: '#00ff00' },
                { id: 'rose', name: 'Neon Rose', color: '#ff0055' },
            ];

            return (
                <div className="flex h-full bg-surface-50 text-white">
                    {/* Sidebar */}
                    <div className="w-48 border-r border-white/10 bg-black/20 p-4">
                        <div className="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">System Prefs</div>
                        <div className="space-y-1">
                            {['General', 'Display', 'Sound', 'Performance', 'About'].map(item => (
                                <button key={item} className={`w-full text-left px-3 py-2 rounded text-xs font-medium ${item === 'General' ? 'bg-white/10 text-white' : 'text-gray-400 hover:text-white'}`}>
                                    {item}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content */}
                    <div className="flex-1 p-8 bg-void overflow-y-auto custom-scroll">
                        <h2 className="text-2xl font-display font-bold mb-6">General Settings</h2>
                        
                        {/* Toggles */}
                        <div className="space-y-6 mb-8">
                            <div className="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/5">
                                <div>
                                    <div className="text-sm font-bold">Audio Core</div>
                                    <div className="text-xs text-gray-500">Enable synthesized UI sound effects</div>
                                </div>
                                <button onClick={() => toggle('Sound')} className={`w-12 h-6 rounded-full p-1 transition-colors ${state.settings.sound ? 'bg-neon-blue' : 'bg-gray-700'}`}>
                                    <div className={`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform ${state.settings.sound ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                </button>
                            </div>

                            <div className="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/5">
                                <div>
                                    <div className="text-sm font-bold">Particle Mesh</div>
                                    <div className="text-xs text-gray-500">Render background physics (High GPU usage)</div>
                                </div>
                                <button onClick={() => toggle('Particles')} className={`w-12 h-6 rounded-full p-1 transition-colors ${state.settings.particles ? 'bg-neon-blue' : 'bg-gray-700'}`}>
                                    <div className={`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform ${state.settings.particles ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                </button>
                            </div>
                        </div>

                        <h2 className="text-2xl font-display font-bold mb-6">Personalization</h2>
                        <div className="grid grid-cols-2 gap-4 mb-8">
                            {themes.map(t => (
                                <button key={t.id} className="p-4 rounded-xl border border-white/10 bg-black hover:bg-white/5 transition-all text-left group">
                                    <div className="flex items-center gap-3 mb-2">
                                        <div className="w-4 h-4 rounded-full" style={{ backgroundColor: t.color }}></div>
                                        <span className="text-sm font-bold">{t.name}</span>
                                    </div>
                                    <div className="text-[10px] text-gray-500 group-hover:text-white transition-colors">Select Theme</div>
                                </button>
                            ))}
                        </div>

                        <div className="p-4 rounded-xl bg-red-500/10 border border-red-500/30">
                            <div className="text-red-400 text-xs font-bold uppercase tracking-widest mb-1">Danger Zone</div>
                            <div className="flex justify-between items-center">
                                <span className="text-xs text-gray-400">Clear all local data and cache</span>
                                <button className="px-3 py-1 bg-red-500 text-white text-xs font-bold rounded hover:bg-red-400">RESET OS</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        /* --- 11. LEGAL & COMPLIANCE DOCS --- */
        const LegalApp = () => {
            return (
                <div className="h-full bg-white text-black p-8 font-serif overflow-y-auto custom-scroll selection:bg-black selection:text-white">
                    <div className="max-w-2xl mx-auto">
                        <h1 className="text-4xl font-bold mb-2">Terms of Service</h1>
                        <p className="text-sm text-gray-500 mb-8 uppercase tracking-widest">Last Updated: January 28, 2026</p>

                        <div className="space-y-6 text-sm leading-relaxed">
                            <section>
                                <h3 className="font-bold text-lg mb-2">1. The Agreement</h3>
                                <p>Welcome to StudyGraphs India OS ("The Platform"). By accessing this system, you agree to be bound by these Terms and Conditions and our Privacy Policy. This Platform is a proprietary educational tool designed for advanced computational analysis.</p>
                            </section>

                            <section>
                                <h3 className="font-bold text-lg mb-2">2. Intellectual Property</h3>
                                <p>All algorithms, visual interfaces, kernel logic, and "The Singularity Engine" architecture are the exclusive property of <strong>Shashank Kushwaha</strong> (The Architect). Unauthorized reproduction, reverse engineering, or distribution of the source code without explicit permission is strictly prohibited under International Copyright Law.</p>
                            </section>

                            <section>
                                <h3 className="font-bold text-lg mb-2">3. Usage Limitations</h3>
                                <p>This tool is intended for educational and research purposes only. "WallStreet Pro" financial projections are estimates and should not be considered professional financial advice. The "Vector Lab" physics engine is a simulation and may not perfectly reflect real-world quantum mechanics.</p>
                            </section>

                            <section>
                                <h3 className="font-bold text-lg mb-2">4. Data Privacy</h3>
                                <p>StudyGraphs OS operates as a <strong>Client-Side Single Page Application (SPA)</strong>. No user data, equations, or financial inputs are transmitted to external servers. All calculations occur locally within your browser's JavaScript engine.</p>
                            </section>

                            <div className="my-8 h-px bg-gray-200"></div>

                            <section className="text-xs text-gray-500">
                                <p>© 2026 StudyGraphs India. All Rights Reserved.</p>
                                <p>Built with React 18, Three.js, and Tailwind CSS.</p>
                                <p>Licensed to: Public Education Sector.</p>
                            </section>
                        </div>
                    </div>
                </div>
            );
        };

        /**
         * ==================================================================================
         * END OF PART 3: APPLICATION SUITE
         * Continue to Part 4 for Desktop Assembly...
         * ==================================================================================
         */

        /**
         * ==================================================================================
         * MODULE 6: THE DESKTOP ENVIRONMENT
         * ==================================================================================
         * Connects the Window Manager, Dock, and Applications into a cohesive OS.
         */

        /* --- THE NAVIGATION DOCK --- */
        const Dock = () => {
            const { dispatch, state } = useContext(OSContext);
            
            // ... inside const Dock ...
const apps = [
    { id: 'nexus', icon: 'fa-book-journal-whills', color: '#00f3ff', title: 'Knowledge Nexus', type: 'NEXUS' },
    { id: 'graph-engine', icon: 'fa-chart-area', color: '#bd00ff', title: 'Graph Engine Pro', type: 'GRAPH' },
    { id: 'solver', icon: 'fa-brain', color: '#00ff00', title: 'Equation Solver', type: 'SOLVER' },
    { id: 'sci-calc', icon: 'fa-calculator', color: '#00ff9d', title: 'QuantumCalc', type: 'CALC' },
    { id: 'elementa', icon: 'fa-flask', color: '#ff0055', title: 'Elementa Table', type: 'ELEMENTS' },
    { id: 'finance', icon: 'fa-coins', color: '#ffd700', title: 'WallStreet Pro', type: 'FINANCE' },
    { id: 'matrix-lab', icon: 'fa-table-cells', color: '#ff9d00', title: 'Matrix Lab', type: 'MATRIX' },
    { id: 'handbook', icon: 'fa-book-open', color: '#ff9d00', title: 'Omni-Handbook', type: 'HANDBOOK' },
{ id: 'trig', icon: 'fa-circle-nodes', color: '#00ff00', title: 'TrigMaster', type: 'TRIG' },
    { id: 'vector-physics', icon: 'fa-atom', color: '#00f3ff', title: 'Vector Lab', type: 'PHYSICS' },
    { id: 'converter', icon: 'fa-right-left', color: '#ffffff', title: 'Unit Converter', type: 'CONVERT' },
    { id: 'devtools', icon: 'fa-terminal', color: '#aaaaaa', title: 'DevTools', type: 'DEVTOOLS' },
    { id: 'settings', icon: 'fa-cog', color: '#888888', title: 'System Config', type: 'SETTINGS' }, // NEW
    { id: 'legal', icon: 'fa-scale-balanced', color: '#ffffff', title: 'Legal Docs', type: 'LEGAL' }, // NEW
    { id: 'dev-info', icon: 'fa-user-astronaut', color: '#ffffff', title: 'System Architect', type: 'DEV' }
];
// ...

            const launch = (app) => {
                sysAudio.play('click');
                dispatch({
                    type: 'OPEN_APP',
                    payload: {
                        id: app.id,
                        title: app.title,
                        type: app.type,
                        x: 100 + Math.random() * 40,
                        y: 50 + Math.random() * 40,
                        w: app.type === 'MATRIX' ? 600 : app.type === 'CALC' ? 800 : 1000,
                        h: 650
                    }
                });
            };

            return (
                <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-[9000] flex items-end gap-3 p-4 glass-panel rounded-2xl border-white/10 transition-all duration-300 hover:scale-[1.02]">
                    {apps.map(app => {
                        const isOpen = state.windows.some(w => w.id === app.id);
                        return (
                            <button 
                                key={app.id}
                                onClick={() => launch(app)}
                                onMouseEnter={() => sysAudio.play('hover')}
                                className="group relative w-12 h-12 flex items-center justify-center rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 hover:-translate-y-4 hover:scale-125 transition-all duration-300 ease-out"
                            >
                                {/* Active Indicator */}
                                {isOpen && <div className="absolute -bottom-2 w-1 h-1 rounded-full bg-neon-blue shadow-[0_0_10px_#00f3ff]"></div>}
                                
                                {/* Icon */}
                                <i className={`fas ${app.icon} text-xl transition-all duration-300 group-hover:text-white drop-shadow-md`} style={{ color: isOpen ? '#fff' : app.color }}></i>
                                
                                {/* Tooltip */}
                                <span className="absolute -top-10 left-1/2 -translate-x-1/2 px-3 py-1 bg-black/80 border border-white/10 rounded-md text-[10px] font-mono text-white opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none backdrop-blur-md">
                                    {app.title}
                                </span>
                            </button>
                        )
                    })}
                </div>
            );
        };

        /* --- THE DESKTOP LAYER --- */
        const Desktop = () => {
            const { state } = useContext(OSContext);

            return (
                <div className="relative w-full h-full z-10">
                    {/* Render Windows */}
                    {state.windows.map(win => (
                        <WindowFrame key={win.id} windowData={win}>
                            {win.type === 'GRAPH' && <GraphApp />}
                            {win.type === 'SOLVER' && <SolverApp />}
                            {win.type === 'MATRIX' && <MatrixApp />}
                            {win.type === 'HANDBOOK' && <HandbookApp />}
                            {win.type === 'TRIG' && <TrigCircleApp />}
                            {win.type === 'NEXUS' && <NexusApp />}
                            {win.type === 'ELEMENTS' && <PeriodicTableApp />}
                            {win.type === 'CALC' && <ScientificCalculatorApp />}
                            {win.type === 'PHYSICS' && <PhysicsApp />}
                            {win.type === 'FINANCE' && <FinanceApp />}
                            {win.type === 'DEVTOOLS' && <DevToolsApp />}
                            {win.type === 'CONVERT' && <ConverterApp />}
                            {win.type === 'SETTINGS' && <SettingsApp />} {/* NEW */}
                            {win.type === 'LEGAL' && <LegalApp />}       {/* NEW */}
                            
                            {/* Founder Profile Window */}
                            {win.type === 'DEV' && (
                                <div className="flex flex-col h-full items-center justify-center p-10 text-center bg-gradient-to-br from-void to-deep relative overflow-hidden">
                                    {/* Animated Background Elements */}
                                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon-blue to-transparent animate-scanline"></div>
                                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
                                    
                                    <div className="relative z-10 group">
                                        <div className="w-32 h-32 mx-auto mb-6 rounded-full p-[2px] bg-gradient-to-tr from-neon-blue via-neon-purple to-neon-gold animate-spin-slow">
                                            <div className="w-full h-full rounded-full bg-black flex items-center justify-center overflow-hidden border-4 border-black">
                                                <i className="fas fa-user-astronaut text-5xl text-white group-hover:scale-110 transition-transform duration-500"></i>
                                            </div>
                                        </div>
                                        
                                        <h2 className="text-4xl font-display font-black text-white mb-2 tracking-tight animate-hologram">SHASHANK KUSHWAHA</h2>
                                        
                                        <div className="flex justify-center gap-3 mb-8">
                                            <span className="px-3 py-1 bg-neon-blue/10 border border-neon-blue/30 rounded-full text-[10px] font-mono text-neon-blue tracking-widest">
                                                FULL STACK ARCHITECT
                                            </span>
                                            <span className="px-3 py-1 bg-neon-purple/10 border border-neon-purple/30 rounded-full text-[10px] font-mono text-neon-purple tracking-widest">
                                                SYSTEM CORE: V10.0
                                            </span>
                                        </div>

                                        <p className="text-gray-400 text-sm max-w-md mx-auto leading-relaxed font-light mb-8">
                                            "StudyGraphs India OS is the culmination of advanced web engineering. 
                                            Built to provide a universal computational singularity for students across the globe."
                                        </p>

                                        <div className="grid grid-cols-2 gap-4 max-w-xs mx-auto">
                                            <a href="mailto:return7521@gmail.com" className="flex items-center justify-center gap-2 px-6 py-3 bg-white text-black font-bold text-xs uppercase tracking-widest rounded-lg hover:bg-neon-blue hover:scale-105 transition-all">
                                                <i className="fas fa-envelope"></i> Contact
                                            </a>
                                            <a href="#" className="flex items-center justify-center gap-2 px-6 py-3 border border-white/20 text-white font-bold text-xs uppercase tracking-widest rounded-lg hover:bg-white/10 hover:border-white transition-all">
                                                <i className="fab fa-instagram"></i> Follow
                                            </a>
                                        </div>
                                        
                                        <div className="mt-12 text-[10px] font-mono text-gray-600">
                                            © 2026 PROMETHEUS SYSTEMS. UNNAO, UP.
                                        </div>
                                    </div>
                                </div>
                            )}
                        </WindowFrame>
                    ))}

                    <Dock />
                    
                    {/* Status Bar */}
                    <div className="fixed top-0 w-full h-8 flex justify-between items-center px-4 z-[8000] pointer-events-none mix-blend-difference text-white">
                        <div className="text-[10px] font-mono font-bold tracking-widest opacity-50">STUDYGRAPHS OS // SINGULARITY</div>
                        <div className="flex gap-4 text-[10px] font-mono opacity-50">
                            <span>MEM: 64TB</span>
                            <span>NET: QUANTUM_LINK</span>
                            <span>{new Date().toLocaleTimeString()}</span>
                        </div>
                    </div>
                </div>
            );
        };

        /* --- SYSTEM BOOTSTRAP (BIOS) --- */
        const SystemBoot = () => {
            const [booted, setBooted] = useState(false);
            const { dispatch } = useContext(OSContext);

            useEffect(() => {
                const bootScreen = document.getElementById('boot-bios');
                const steps = [
                    "INITIALIZING KERNEL...",
                    "LOADING MATH LIBRARIES (MATHJS, PLOTLY)...",
                    "MOUNTING FILE SYSTEM...",
                    "CONNECTING TO NEURAL NET...",
                    "CALIBRATING PHYSICS ENGINE...",
                    "SYSTEM READY."
                ];

                let delay = 0;
                steps.forEach((step, i) => {
                    delay += Math.random() * 300 + 100;
                    setTimeout(() => {
                        const line = document.createElement('div');
                        line.className = 'bios-line';
                        line.innerText = `[ OK ] ${step}`;
                        bootScreen.appendChild(line);
                        
                        // Play boot sound on first step
                        if (i === 0) sysAudio.boot();
                    }, delay);
                });

                setTimeout(() => {
                    bootScreen.style.opacity = '0';
                    bootScreen.style.pointerEvents = 'none';
                    initParticles(); // Start visual background
                    setBooted(true);
                    
                    // Auto-open Graph Engine
                    dispatch({
                        type: 'OPEN_APP',
                        payload: {
                            id: 'graph-engine',
                            title: 'Graphing Engine Pro',
                            type: 'GRAPH',
                            x: 100, y: 80, w: 1000, h: 650
                        }
                    });
                }, delay + 800);

            }, []);

            return booted ? <Desktop /> : null;
        };

        /* --- ROOT APP --- */
        const App = () => {
            const [state, dispatch] = useReducer(osReducer, initialState);

            return (
                <OSContext.Provider value={{ state, dispatch }}>
                    <SystemBoot />
                </OSContext.Provider>
            );
        };

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
